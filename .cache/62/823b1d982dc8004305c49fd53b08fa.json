{"id":"lBbe","dependencies":[{"name":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\package.json","includedInParent":true,"mtime":1650205093207},{"name":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\node_modules\\@firebase\\firestore\\package.json","includedInParent":true,"mtime":1650205416002},{"name":"@firebase/app","loc":{"line":1,"column":111,"index":111},"parent":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\node_modules\\@firebase\\firestore\\dist\\index.esm2017.js","resolved":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\node_modules\\@firebase\\app\\dist\\esm\\index.esm2017.js"},{"name":"@firebase/component","loc":{"line":2,"column":26,"index":154},"parent":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\node_modules\\@firebase\\firestore\\dist\\index.esm2017.js","resolved":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\node_modules\\@firebase\\component\\dist\\esm\\index.esm2017.js"},{"name":"@firebase/logger","loc":{"line":3,"column":33,"index":210},"parent":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\node_modules\\@firebase\\firestore\\dist\\index.esm2017.js","resolved":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\node_modules\\@firebase\\logger\\dist\\esm\\index.esm2017.js"},{"name":"@firebase/util","loc":{"line":4,"column":198,"index":428},"parent":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\node_modules\\@firebase\\firestore\\dist\\index.esm2017.js","resolved":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\node_modules\\@firebase\\util\\dist\\index.esm2017.js"},{"name":"@firebase/webchannel-wrapper","loc":{"line":5,"column":137,"index":583},"parent":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\node_modules\\@firebase\\firestore\\dist\\index.esm2017.js","resolved":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\node_modules\\@firebase\\webchannel-wrapper\\dist\\index.esm2017.js"},{"name":"process","parent":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\node_modules\\@firebase\\firestore\\dist\\index.esm2017.js","resolved":"C:\\Users\\LENOVO\\OneDrive\\Desktop\\botz-widget\\BotZ-Widget\\node_modules\\process\\browser.js"}],"generated":{"js":"var process = require(\"process\");\nvar e=require(\"process\");Object.defineProperty(exports,\"__esModule\",{value:!0}),exports._FieldPath=exports._EmptyAuthCredentialsProvider=exports._EmptyAppCheckTokenProvider=exports._DocumentKey=exports._DatabaseId=exports.WriteBatch=exports.Transaction=exports.Timestamp=exports.SnapshotMetadata=exports.QuerySnapshot=exports.QueryDocumentSnapshot=exports.QueryConstraint=exports.Query=exports.LoadBundleTask=exports.GeoPoint=exports.FirestoreError=exports.Firestore=exports.FieldValue=exports.FieldPath=exports.DocumentSnapshot=exports.DocumentReference=exports.CollectionReference=exports.CACHE_SIZE_UNLIMITED=exports.Bytes=exports.AbstractUserDataWriter=void 0,exports._cast=rl,exports._debugAssert=z,exports._isBase64Available=be,exports._logWarn=B,exports._setIndexConfiguration=mh,exports._validateIsNotUsedTogether=Zc,exports.addDoc=ih,exports.arrayRemove=vh,exports.arrayUnion=dh,exports.clearIndexedDbPersistence=Al,exports.collection=fl,exports.collectionGroup=hl,exports.connectFirestoreEmulator=ol,exports.deleteDoc=rh,exports.deleteField=fh,exports.disableNetwork=Rl,exports.doc=dl,exports.documentId=Pl,exports.enableIndexedDbPersistence=Tl,exports.enableMultiTabIndexedDbPersistence=Sl,exports.enableNetwork=Nl,exports.endAt=Of,exports.endBefore=Pf,exports.ensureFirestoreConfigured=Il,exports.executeWrite=oh,exports.getDoc=Hf,exports.getDocFromCache=Xf,exports.getDocFromServer=Jf,exports.getDocs=$f,exports.getDocsFromCache=Zf,exports.getDocsFromServer=eh,exports.getFirestore=xl,exports.increment=yh,exports.initializeFirestore=bl,exports.limit=Rf,exports.limitToLast=Cf,exports.loadBundle=Ml,exports.namedQuery=Ll,exports.onSnapshot=ah,exports.onSnapshotsInSync=uh,exports.orderBy=Df,exports.query=Tf,exports.queryEqual=yl,exports.refEqual=vl,exports.runTransaction=lh,exports.serverTimestamp=hh,exports.setDoc=th,exports.setLogLevel=O,exports.snapshotEqual=xf,exports.startAfter=Vf,exports.startAt=Lf,exports.terminate=Cl,exports.updateDoc=nh,exports.waitForPendingWrites=Dl,exports.where=_f,exports.writeBatch=ph;var t=require(\"@firebase/app\"),n=require(\"@firebase/component\"),r=require(\"@firebase/logger\"),i=require(\"@firebase/util\"),a=require(\"@firebase/webchannel-wrapper\");function u(e,t,n){return(u=x()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&g(i,n.prototype),i}).apply(null,arguments)}function o(){return(o=\"undefined\"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=s(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}}).apply(this,arguments)}function s(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=I(e)););return e}function c(e,t){return h(e)||f(e,t)||S(e,t)||l()}function l(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function f(e,t){var n=null==e?null:\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(null!=n){var r,i,a=[],u=!0,o=!1;try{for(n=n.call(e);!(u=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);u=!0);}catch(s){o=!0,i=s}finally{try{u||null==n.return||n.return()}finally{if(o)throw i}}return a}}function h(e){if(Array.isArray(e))return e}function d(e){return(d=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}function v(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(!n){if(Array.isArray(e)||(n=S(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}var a,u=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){o=!0,a=e},f:function(){try{u||null==n.return||n.return()}finally{if(o)throw a}}}}function y(e,t,n,r,i,a,u){try{var o=e[a](u),s=o.value}catch(c){return void n(c)}o.done?t(s):Promise.resolve(s).then(r,i)}function p(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function u(e){y(a,r,i,u,o,\"next\",e)}function o(e){y(a,r,i,u,o,\"throw\",e)}u(void 0)})}}function m(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function\");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,\"prototype\",{writable:!1}),t&&g(e,t)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){var t=x();return function(){var n,r=I(e);if(t){var i=I(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w(this,n)}}function w(e,t){if(t&&(\"object\"===d(t)||\"function\"==typeof t))return t;if(void 0!==t)throw new TypeError(\"Derived constructors may only return object or undefined\");return b(e)}function b(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}function x(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function E(e){return A(e)||_(e)||S(e)||T()}function T(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function S(e,t){if(e){if(\"string\"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return\"Object\"===n&&e.constructor&&(n=e.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(e):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}function _(e){if(\"undefined\"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e[\"@@iterator\"])return Array.from(e)}function A(e){if(Array.isArray(e))return D(e)}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function N(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t,n){return t&&R(e.prototype,t),n&&R(e,n),Object.defineProperty(e,\"prototype\",{writable:!1}),e}var M=\"@firebase/firestore\",L=function(){function e(t){N(this,e),this.uid=t}return C(e,[{key:\"isAuthenticated\",value:function(){return null!=this.uid}},{key:\"toKey\",value:function(){return this.isAuthenticated()?\"uid:\"+this.uid:\"anonymous-user\"}},{key:\"isEqual\",value:function(e){return e.uid===this.uid}}]),e}();L.UNAUTHENTICATED=new L(null),L.GOOGLE_CREDENTIALS=new L(\"google-credentials-uid\"),L.FIRST_PARTY=new L(\"first-party-uid\"),L.MOCK_USER=new L(\"mock-user\");var V=\"9.6.11\",F=new r.Logger(\"@firebase/firestore\");function P(){return F.logLevel}function O(e){F.setLogLevel(e)}function q(e){if(F.logLevel<=r.LogLevel.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var a=n.map(K);F.debug.apply(F,[\"Firestore (\".concat(V,\"): \").concat(e)].concat(E(a)))}}function U(e){if(F.logLevel<=r.LogLevel.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var a=n.map(K);F.error.apply(F,[\"Firestore (\".concat(V,\"): \").concat(e)].concat(E(a)))}}function B(e){if(F.logLevel<=r.LogLevel.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var a=n.map(K);F.warn.apply(F,[\"Firestore (\".concat(V,\"): \").concat(e)].concat(E(a)))}}function K(e){if(\"string\"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function G(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"Unexpected state\",t=\"FIRESTORE (\".concat(V,\") INTERNAL ASSERTION FAILED: \")+e;throw U(t),new Error(t)}function j(e,t){e||G()}function z(e,t){e||G()}function Q(e,t){return e}var W={OK:\"ok\",CANCELLED:\"cancelled\",UNKNOWN:\"unknown\",INVALID_ARGUMENT:\"invalid-argument\",DEADLINE_EXCEEDED:\"deadline-exceeded\",NOT_FOUND:\"not-found\",ALREADY_EXISTS:\"already-exists\",PERMISSION_DENIED:\"permission-denied\",UNAUTHENTICATED:\"unauthenticated\",RESOURCE_EXHAUSTED:\"resource-exhausted\",FAILED_PRECONDITION:\"failed-precondition\",ABORTED:\"aborted\",OUT_OF_RANGE:\"out-of-range\",UNIMPLEMENTED:\"unimplemented\",INTERNAL:\"internal\",UNAVAILABLE:\"unavailable\",DATA_LOSS:\"data-loss\"},H=function(e){m(n,i.FirebaseError);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this,e,r)).code=e,i.message=r,i.toString=function(){return\"\".concat(i.name,\": [code=\").concat(i.code,\"]: \").concat(i.message)},i}return C(n)}();exports.FirestoreError=H;var Y=C(function e(){var t=this;N(this,e),this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}),X=C(function e(t,n){N(this,e),this.user=n,this.type=\"OAuth\",this.headers=new Map,this.headers.set(\"Authorization\",\"Bearer \".concat(t))}),J=function(){function e(){N(this,e)}return C(e,[{key:\"getToken\",value:function(){return Promise.resolve(null)}},{key:\"invalidateToken\",value:function(){}},{key:\"start\",value:function(e,t){e.enqueueRetryable(function(){return t(L.UNAUTHENTICATED)})}},{key:\"shutdown\",value:function(){}}]),e}();exports._EmptyAuthCredentialsProvider=J;var $=function(){function e(t){N(this,e),this.token=t,this.changeListener=null}return C(e,[{key:\"getToken\",value:function(){return Promise.resolve(this.token)}},{key:\"invalidateToken\",value:function(){}},{key:\"start\",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable(function(){return t(n.token.user)})}},{key:\"shutdown\",value:function(){this.changeListener=null}}]),e}(),Z=function(){function e(t){N(this,e),this.t=t,this.currentUser=L.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return C(e,[{key:\"start\",value:function(e,t){var n=this,r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new Y;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new Y,e.enqueueRetryable(function(){return i(n.currentUser)})};var u=function(){var t=a;e.enqueueRetryable(p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case\"end\":return e.stop()}},e)})))},o=function(e){q(\"FirebaseAuthCredentialsProvider\",\"Auth detected\"),n.auth=e,n.auth.addAuthTokenListener(n.o),u()};this.t.onInit(function(e){return o(e)}),setTimeout(function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?o(e):(q(\"FirebaseAuthCredentialsProvider\",\"Auth not yet detected\"),a.resolve(),a=new Y)}},0),u()}},{key:\"getToken\",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return e.i!==t?(q(\"FirebaseAuthCredentialsProvider\",\"getToken aborted due to token change.\"),e.getToken()):n?(j(\"string\"==typeof n.accessToken),new X(n.accessToken,e.currentUser)):null}):Promise.resolve(null)}},{key:\"invalidateToken\",value:function(){this.forceRefresh=!0}},{key:\"shutdown\",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:\"u\",value:function(){var e=this.auth&&this.auth.getUid();return j(null===e||\"string\"==typeof e),new L(e)}}]),e}(),ee=C(function e(t,n,r){N(this,e),this.type=\"FirstParty\",this.user=L.FIRST_PARTY,this.headers=new Map,this.headers.set(\"X-Goog-AuthUser\",n);var i=t.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set(\"Authorization\",i),r&&this.headers.set(\"X-Goog-Iam-Authorization-Token\",r)}),te=function(){function e(t,n,r){N(this,e),this.h=t,this.l=n,this.m=r}return C(e,[{key:\"getToken\",value:function(){return Promise.resolve(new ee(this.h,this.l,this.m))}},{key:\"start\",value:function(e,t){e.enqueueRetryable(function(){return t(L.FIRST_PARTY)})}},{key:\"shutdown\",value:function(){}},{key:\"invalidateToken\",value:function(){}}]),e}(),ne=C(function e(t){N(this,e),this.value=t,this.type=\"AppCheck\",this.headers=new Map,t&&t.length>0&&this.headers.set(\"x-firebase-appcheck\",this.value)}),re=function(){function e(t){N(this,e),this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}return C(e,[{key:\"start\",value:function(e,t){var n=this,r=function(e){null!=e.error&&q(\"FirebaseAppCheckTokenProvider\",\"Error getting App Check token; using placeholder token instead. Error: \".concat(e.error.message));var r=e.token!==n.p;return n.p=e.token,q(\"FirebaseAppCheckTokenProvider\",\"Received \".concat(r?\"new\":\"existing\",\" token.\")),r?t(e.token):Promise.resolve()};this.o=function(t){e.enqueueRetryable(function(){return r(t)})};var i=function(e){q(\"FirebaseAppCheckTokenProvider\",\"AppCheck detected\"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.g.onInit(function(e){return i(e)}),setTimeout(function(){if(!n.appCheck){var e=n.g.getImmediate({optional:!0});e?i(e):q(\"FirebaseAppCheckTokenProvider\",\"AppCheck not yet detected\")}},0)}},{key:\"getToken\",value:function(){var e=this,t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(function(t){return t?(j(\"string\"==typeof t.token),e.p=t.token,new ne(t.token)):null}):Promise.resolve(null)}},{key:\"invalidateToken\",value:function(){this.forceRefresh=!0}},{key:\"shutdown\",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}(),ie=function(){function e(){N(this,e)}return C(e,[{key:\"getToken\",value:function(){return Promise.resolve(new ne(\"\"))}},{key:\"invalidateToken\",value:function(){}},{key:\"start\",value:function(e,t){}},{key:\"shutdown\",value:function(){}}]),e}();exports._EmptyAppCheckTokenProvider=ie;var ae=function(){function e(t,n){var r=this;N(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.I(e)},this.T=function(e){return n.writeSequenceNumber(e)})}return C(e,[{key:\"I\",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:\"next\",value:function(){var e=++this.previousValue;return this.T&&this.T(e),e}}]),e}();function ue(e){var t=\"undefined\"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&\"function\"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}ae.A=-1;var oe=function(){function e(){N(this,e)}return C(e,null,[{key:\"R\",value:function(){for(var e=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\",t=Math.floor(256/e.length)*e.length,n=\"\";n.length<20;)for(var r=ue(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function se(e,t){return e<t?-1:e>t?1:0}function ce(e,t,n){return e.length===t.length&&e.every(function(e,r){return n(e,t[r])})}function le(e){return e+\"\\0\"}var fe=function(){function e(t,n){if(N(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new H(W.INVALID_ARGUMENT,\"Timestamp nanoseconds out of range: \"+n);if(n>=1e9)throw new H(W.INVALID_ARGUMENT,\"Timestamp nanoseconds out of range: \"+n);if(t<-62135596800)throw new H(W.INVALID_ARGUMENT,\"Timestamp seconds out of range: \"+t);if(t>=253402300800)throw new H(W.INVALID_ARGUMENT,\"Timestamp seconds out of range: \"+t)}return C(e,[{key:\"toDate\",value:function(){return new Date(this.toMillis())}},{key:\"toMillis\",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:\"_compareTo\",value:function(e){return this.seconds===e.seconds?se(this.nanoseconds,e.nanoseconds):se(this.seconds,e.seconds)}},{key:\"isEqual\",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:\"toString\",value:function(){return\"Timestamp(seconds=\"+this.seconds+\", nanoseconds=\"+this.nanoseconds+\")\"}},{key:\"toJSON\",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:\"valueOf\",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,\"0\")+\".\"+String(this.nanoseconds).padStart(9,\"0\")}}],[{key:\"now\",value:function(){return e.fromMillis(Date.now())}},{key:\"fromDate\",value:function(t){return e.fromMillis(t.getTime())}},{key:\"fromMillis\",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}();exports.Timestamp=fe;var he=function(){function e(t){N(this,e),this.timestamp=t}return C(e,[{key:\"compareTo\",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:\"isEqual\",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:\"toMicroseconds\",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:\"toString\",value:function(){return\"SnapshotVersion(\"+this.timestamp.toString()+\")\"}},{key:\"toTimestamp\",value:function(){return this.timestamp}}],[{key:\"fromTimestamp\",value:function(t){return new e(t)}},{key:\"min\",value:function(){return new e(new fe(0,0))}},{key:\"max\",value:function(){return new e(new fe(253402300799,999999999))}}]),e}();function de(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ve(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ye(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var pe=function(){function e(t,n,r){N(this,e),void 0===n?n=0:n>t.length&&G(),void 0===r?r=t.length-n:r>t.length-n&&G(),this.segments=t,this.offset=n,this.len=r}return C(e,[{key:\"length\",get:function(){return this.len}},{key:\"isEqual\",value:function(t){return 0===e.comparator(this,t)}},{key:\"child\",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(function(e){n.push(e)}):n.push(t),this.construct(n)}},{key:\"limit\",value:function(){return this.offset+this.length}},{key:\"popFirst\",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:\"popLast\",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:\"firstSegment\",value:function(){return this.segments[this.offset]}},{key:\"lastSegment\",value:function(){return this.get(this.length-1)}},{key:\"get\",value:function(e){return this.segments[this.offset+e]}},{key:\"isEmpty\",value:function(){return 0===this.length}},{key:\"isPrefixOf\",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:\"isImmediateParentOf\",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:\"forEach\",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:\"toArray\",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:\"comparator\",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),me=function(e){m(n,pe);var t=k(n);function n(){return N(this,n),t.apply(this,arguments)}return C(n,[{key:\"construct\",value:function(e,t,r){return new n(e,t,r)}},{key:\"canonicalString\",value:function(){return this.toArray().join(\"/\")}},{key:\"toString\",value:function(){return this.canonicalString()}}],[{key:\"fromString\",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,u=r;a<u.length;a++){var o=u[a];if(o.indexOf(\"//\")>=0)throw new H(W.INVALID_ARGUMENT,\"Invalid segment (\".concat(o,\"). Paths must not contain // in them.\"));e.push.apply(e,E(o.split(\"/\").filter(function(e){return e.length>0})))}return new n(e)}},{key:\"emptyPath\",value:function(){return new n([])}}]),n}(),ge=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ke=function(e){m(n,pe);var t=k(n);function n(){return N(this,n),t.apply(this,arguments)}return C(n,[{key:\"construct\",value:function(e,t,r){return new n(e,t,r)}},{key:\"canonicalString\",value:function(){return this.toArray().map(function(e){return e=e.replace(/\\\\/g,\"\\\\\\\\\").replace(/`/g,\"\\\\`\"),n.isValidIdentifier(e)||(e=\"`\"+e+\"`\"),e}).join(\".\")}},{key:\"toString\",value:function(){return this.canonicalString()}},{key:\"isKeyField\",value:function(){return 1===this.length&&\"__name__\"===this.get(0)}}],[{key:\"isValidIdentifier\",value:function(e){return ge.test(e)}},{key:\"keyField\",value:function(){return new n([\"__name__\"])}},{key:\"fromServerFormat\",value:function(e){for(var t=[],r=\"\",i=0,a=function(){if(0===r.length)throw new H(W.INVALID_ARGUMENT,\"Invalid field path (\".concat(e,\"). Paths must not be empty, begin with '.', end with '.', or contain '..'\"));t.push(r),r=\"\"},u=!1;i<e.length;){var o=e[i];if(\"\\\\\"===o){if(i+1===e.length)throw new H(W.INVALID_ARGUMENT,\"Path has trailing escape character: \"+e);var s=e[i+1];if(\"\\\\\"!==s&&\".\"!==s&&\"`\"!==s)throw new H(W.INVALID_ARGUMENT,\"Path has invalid escape sequence: \"+e);r+=s,i+=2}else\"`\"===o?(u=!u,i++):\".\"!==o||u?(r+=o,i++):(a(),i++)}if(a(),u)throw new H(W.INVALID_ARGUMENT,\"Unterminated ` in path: \"+e);return new n(t)}},{key:\"emptyPath\",value:function(){return new n([])}}]),n}();exports._FieldPath=ke;var we=function(){function e(t){N(this,e),this.fields=t,t.sort(ke.comparator)}return C(e,[{key:\"covers\",value:function(e){var t,n=v(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:\"isEqual\",value:function(e){return ce(this.fields,e.fields,function(e,t){return e.isEqual(t)})}}]),e}();function be(){return\"undefined\"!=typeof atob}var xe=function(e){function t(e){N(this,t),this.binaryString=e}return C(t,[{key:Symbol.iterator,value:function(){var e=this,t=0;return{next:function(){return t<e.binaryString.length?{value:e.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}}},{key:\"toBase64\",value:function(){return e=this.binaryString,btoa(e);var e}},{key:\"toUint8Array\",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:\"approximateByteSize\",value:function(){return 2*this.binaryString.length}},{key:\"compareTo\",value:function(e){return se(this.binaryString,e.binaryString)}},{key:\"isEqual\",value:function(e){return this.binaryString===e.binaryString}}],[{key:\"fromBase64String\",value:function(e){return new t(atob(e))}},{key:\"fromUint8Array\",value:function(e){return new t(function(e){for(var t=\"\",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}}]),t}();xe.EMPTY_BYTE_STRING=new xe(\"\");var Ie=new RegExp(/^\\d{4}-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(?:\\.(\\d+))?Z$/);function Ee(e){if(j(!!e),\"string\"==typeof e){var t=0,n=Ie.exec(e);if(j(!!n),n[1]){var r=n[1];r=(r+\"000000000\").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:Te(e.seconds),nanos:Te(e.nanos)}}function Te(e){return\"number\"==typeof e?e:\"string\"==typeof e?Number(e):0}function Se(e){return\"string\"==typeof e?xe.fromBase64String(e):xe.fromUint8Array(e)}function _e(e){var t,n;return\"server_timestamp\"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ae(e){var t=e.mapValue.fields.__previous_value__;return _e(t)?Ae(t):t}function De(e){var t=Ee(e.mapValue.fields.__local_write_time__.timestampValue);return new fe(t.seconds,t.nanos)}var Ne=C(function e(t,n,r,i,a,u,o,s){N(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=u,this.autoDetectLongPolling=o,this.useFetchStreams=s}),Re=function(){function e(t,n){N(this,e),this.projectId=t,this.database=n||\"(default)\"}return C(e,[{key:\"isDefaultDatabase\",get:function(){return\"(default)\"===this.database}},{key:\"isEqual\",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}],[{key:\"empty\",value:function(){return new e(\"\",\"\")}}]),e}();function Ce(e){return null==e}function Me(e){return 0===e&&1/e==-1/0}function Le(e){return\"number\"==typeof e&&Number.isInteger(e)&&!Me(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}exports._DatabaseId=Re;var Ve=function(){function e(t){N(this,e),this.path=t}return C(e,[{key:\"collectionGroup\",get:function(){return this.path.popLast().lastSegment()}},{key:\"hasCollectionId\",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:\"getCollectionGroup\",value:function(){return this.path.get(this.path.length-2)}},{key:\"getCollectionPath\",value:function(){return this.path.popLast()}},{key:\"isEqual\",value:function(e){return null!==e&&0===me.comparator(this.path,e.path)}},{key:\"toString\",value:function(){return this.path.toString()}}],[{key:\"fromPath\",value:function(t){return new e(me.fromString(t))}},{key:\"fromName\",value:function(t){return new e(me.fromString(t).popFirst(5))}},{key:\"empty\",value:function(){return new e(me.emptyPath())}},{key:\"comparator\",value:function(e,t){return me.comparator(e.path,t.path)}},{key:\"isDocumentKey\",value:function(e){return e.length%2==0}},{key:\"fromSegments\",value:function(t){return new e(new me(t.slice()))}}]),e}();exports._DocumentKey=Ve;var Fe={mapValue:{fields:{__type__:{stringValue:\"__max__\"}}}},Pe={nullValue:\"NULL_VALUE\"};function Oe(e){return\"nullValue\"in e?0:\"booleanValue\"in e?1:\"integerValue\"in e||\"doubleValue\"in e?2:\"timestampValue\"in e?3:\"stringValue\"in e?5:\"bytesValue\"in e?6:\"referenceValue\"in e?7:\"geoPointValue\"in e?8:\"arrayValue\"in e?9:\"mapValue\"in e?_e(e)?4:$e(e)?9:10:G()}function qe(e,t){if(e===t)return!0;var n=Oe(e);if(n!==Oe(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return De(e).isEqual(De(t));case 3:return function(e,t){if(\"string\"==typeof e.timestampValue&&\"string\"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=Ee(e.timestampValue),r=Ee(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Se(e.bytesValue).isEqual(Se(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Te(e.geoPointValue.latitude)===Te(t.geoPointValue.latitude)&&Te(e.geoPointValue.longitude)===Te(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if(\"integerValue\"in e&&\"integerValue\"in t)return Te(e.integerValue)===Te(t.integerValue);if(\"doubleValue\"in e&&\"doubleValue\"in t){var n=Te(e.doubleValue),r=Te(t.doubleValue);return n===r?Me(n)===Me(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ce(e.arrayValue.values||[],t.arrayValue.values||[],qe);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(de(n)!==de(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!qe(n[i],r[i])))return!1;return!0}(e,t);default:return G()}}function Ue(e,t){return void 0!==(e.values||[]).find(function(e){return qe(e,t)})}function Be(e,t){if(e===t)return 0;var n=Oe(e),r=Oe(t);if(n!==r)return se(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return se(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=Te(e.integerValue||e.doubleValue),r=Te(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Ke(e.timestampValue,t.timestampValue);case 4:return Ke(De(e),De(t));case 5:return se(e.stringValue,t.stringValue);case 6:return function(e,t){var n=Se(e),r=Se(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split(\"/\"),r=t.split(\"/\"),i=0;i<n.length&&i<r.length;i++){var a=se(n[i],r[i]);if(0!==a)return a}return se(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=se(Te(e.latitude),Te(t.latitude));return 0!==n?n:se(Te(e.longitude),Te(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=Be(n[i],r[i]);if(a)return a}return se(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var u=0;u<r.length&&u<a.length;++u){var o=se(r[u],a[u]);if(0!==o)return o;var s=Be(n[r[u]],i[a[u]]);if(0!==s)return s}return se(r.length,a.length)}(e.mapValue,t.mapValue);default:throw G()}}function Ke(e,t){if(\"string\"==typeof e&&\"string\"==typeof t&&e.length===t.length)return se(e,t);var n=Ee(e),r=Ee(t),i=se(n.seconds,r.seconds);return 0!==i?i:se(n.nanos,r.nanos)}function Ge(e){return je(e)}function je(e){return\"nullValue\"in e?\"null\":\"booleanValue\"in e?\"\"+e.booleanValue:\"integerValue\"in e?\"\"+e.integerValue:\"doubleValue\"in e?\"\"+e.doubleValue:\"timestampValue\"in e?function(e){var t=Ee(e);return\"time(\".concat(t.seconds,\",\").concat(t.nanos,\")\")}(e.timestampValue):\"stringValue\"in e?e.stringValue:\"bytesValue\"in e?Se(e.bytesValue).toBase64():\"referenceValue\"in e?(n=e.referenceValue,Ve.fromName(n).toString()):\"geoPointValue\"in e?\"geo(\".concat((t=e.geoPointValue).latitude,\",\").concat(t.longitude,\")\"):\"arrayValue\"in e?function(e){var t,n=\"[\",r=!0,i=v(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=\",\",n+=je(a)}}catch(u){i.e(u)}finally{i.f()}return n+\"]\"}(e.arrayValue):\"mapValue\"in e?function(e){var t,n=\"{\",r=!0,i=v(Object.keys(e.fields||{}).sort());try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=\",\",n+=\"\".concat(a,\":\").concat(je(e.fields[a]))}}catch(u){i.e(u)}finally{i.f()}return n+\"}\"}(e.mapValue):G();var t,n}function ze(e,t){return{referenceValue:\"projects/\".concat(e.projectId,\"/databases/\").concat(e.database,\"/documents/\").concat(t.path.canonicalString())}}function Qe(e){return!!e&&\"integerValue\"in e}function We(e){return!!e&&\"arrayValue\"in e}function He(e){return!!e&&\"nullValue\"in e}function Ye(e){return!!e&&\"doubleValue\"in e&&isNaN(Number(e.doubleValue))}function Xe(e){return!!e&&\"mapValue\"in e}function Je(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&\"object\"==d(e.timestampValue))return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return ve(e.mapValue.fields,function(e,n){return t.mapValue.fields[e]=Je(n)}),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Je(e.arrayValue.values[r]);return n}return Object.assign({},e)}function $e(e){return\"__max__\"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Ze(e){return\"nullValue\"in e?Pe:\"booleanValue\"in e?{booleanValue:!1}:\"integerValue\"in e||\"doubleValue\"in e?{doubleValue:NaN}:\"timestampValue\"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:\"stringValue\"in e?{stringValue:\"\"}:\"bytesValue\"in e?{bytesValue:\"\"}:\"referenceValue\"in e?ze(Re.empty(),Ve.empty()):\"geoPointValue\"in e?{geoPointValue:{latitude:-90,longitude:-180}}:\"arrayValue\"in e?{arrayValue:{}}:\"mapValue\"in e?{mapValue:{}}:G()}function et(e){return\"nullValue\"in e?{booleanValue:!1}:\"booleanValue\"in e?{doubleValue:NaN}:\"integerValue\"in e||\"doubleValue\"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:\"timestampValue\"in e?{stringValue:\"\"}:\"stringValue\"in e?{bytesValue:\"\"}:\"bytesValue\"in e?ze(Re.empty(),Ve.empty()):\"referenceValue\"in e?{geoPointValue:{latitude:-90,longitude:-180}}:\"geoPointValue\"in e?{arrayValue:{}}:\"arrayValue\"in e?{mapValue:{}}:\"mapValue\"in e?Fe:G()}function tt(e,t){return void 0===e?t:void 0===t||Be(e,t)>0?e:t}function nt(e,t){return void 0===e?t:void 0===t||Be(e,t)<0?e:t}var rt=function(){function e(t){N(this,e),this.value=t}return C(e,[{key:\"field\",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!Xe(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:\"set\",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Je(t)}},{key:\"setAll\",value:function(e){var t=this,n=ke.emptyPath(),r={},i=[];e.forEach(function(e,a){if(!n.isImmediateParentOf(a)){var u=t.getFieldsMap(n);t.applyChanges(u,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=Je(e):i.push(a.lastSegment())});var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:\"delete\",value:function(e){var t=this.field(e.popLast());Xe(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:\"isEqual\",value:function(e){return qe(this.value,e.value)}},{key:\"getFieldsMap\",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];Xe(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:\"applyChanges\",value:function(e,t,n){ve(t,function(t,n){return e[t]=n});var r,i=v(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(u){i.e(u)}finally{i.f()}}},{key:\"clone\",value:function(){return new e(Je(this.value))}}],[{key:\"empty\",value:function(){return new e({mapValue:{}})}}]),e}();function it(e){var t=[];return ve(e.fields,function(e,n){var r=new ke([e]);if(Xe(n)){var i=it(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,u=v(i);try{for(u.s();!(a=u.n()).done;){var o=a.value;t.push(r.child(o))}}catch(s){u.e(s)}finally{u.f()}}}else t.push(r)}),new we(t)}var at=function(){function e(t,n,r,i,a,u){N(this,e),this.key=t,this.documentType=n,this.version=r,this.readTime=i,this.data=a,this.documentState=u}return C(e,[{key:\"convertToFoundDocument\",value:function(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:\"convertToNoDocument\",value:function(e){return this.version=e,this.documentType=2,this.data=rt.empty(),this.documentState=0,this}},{key:\"convertToUnknownDocument\",value:function(e){return this.version=e,this.documentType=3,this.data=rt.empty(),this.documentState=2,this}},{key:\"setHasCommittedMutations\",value:function(){return this.documentState=2,this}},{key:\"setHasLocalMutations\",value:function(){return this.documentState=1,this}},{key:\"setReadTime\",value:function(e){return this.readTime=e,this}},{key:\"hasLocalMutations\",get:function(){return 1===this.documentState}},{key:\"hasCommittedMutations\",get:function(){return 2===this.documentState}},{key:\"hasPendingWrites\",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:\"isValidDocument\",value:function(){return 0!==this.documentType}},{key:\"isFoundDocument\",value:function(){return 1===this.documentType}},{key:\"isNoDocument\",value:function(){return 2===this.documentType}},{key:\"isUnknownDocument\",value:function(){return 3===this.documentType}},{key:\"isEqual\",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:\"mutableCopy\",value:function(){return new e(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}},{key:\"toString\",value:function(){return\"Document(\".concat(this.key,\", \").concat(this.version,\", \").concat(JSON.stringify(this.data.value),\", {documentType: \").concat(this.documentType,\"}), {documentState: \").concat(this.documentState,\"})\")}}],[{key:\"newInvalidDocument\",value:function(t){return new e(t,0,he.min(),he.min(),rt.empty(),0)}},{key:\"newFoundDocument\",value:function(t,n,r){return new e(t,1,n,he.min(),r,0)}},{key:\"newNoDocument\",value:function(t,n){return new e(t,2,n,he.min(),rt.empty(),0)}},{key:\"newUnknownDocument\",value:function(t,n){return new e(t,3,n,he.min(),rt.empty(),2)}}]),e}(),ut=C(function e(t,n,r,i){N(this,e),this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=i});function ot(e){return e.fields.find(function(e){return 2===e.kind})}function st(e){return e.fields.filter(function(e){return 2!==e.kind})}ut.UNKNOWN_ID=-1;var ct=C(function e(t,n){N(this,e),this.fieldPath=t,this.kind=n}),lt=function(){function e(t,n){N(this,e),this.sequenceNumber=t,this.offset=n}return C(e,null,[{key:\"empty\",value:function(){return new e(0,dt.min())}}]),e}();function ft(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=he.fromTimestamp(1e9===r?new fe(n+1,0):new fe(n,r));return new dt(i,Ve.empty(),t)}function ht(e){return new dt(e.readTime,e.key,-1)}var dt=function(){function e(t,n,r){N(this,e),this.readTime=t,this.documentKey=n,this.largestBatchId=r}return C(e,null,[{key:\"min\",value:function(){return new e(he.min(),Ve.empty(),-1)}},{key:\"max\",value:function(){return new e(he.max(),Ve.empty(),-1)}}]),e}();function vt(e,t){var n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=Ve.comparator(e.documentKey,t.documentKey))?n:se(e.largestBatchId,t.largestBatchId)}var yt=C(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;N(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=u,this.endAt=o,this.P=null});function pt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new yt(e,t,n,r,i,a,u)}function mt(e){var t=Q(e);if(null===t.P){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+=\"|cg:\"+t.collectionGroup),n+=\"|f:\",n+=t.filters.map(function(e){return(t=e).field.canonicalString()+t.op.toString()+Ge(t.value);var t}).join(\",\"),n+=\"|ob:\",n+=t.orderBy.map(function(e){return function(e){return e.field.canonicalString()+e.dir}(e)}).join(\",\"),Ce(t.limit)||(n+=\"|l:\",n+=t.limit),t.startAt&&(n+=\"|lb:\",n+=t.startAt.inclusive?\"b:\":\"a:\",n+=t.startAt.position.map(function(e){return Ge(e)}).join(\",\")),t.endAt&&(n+=\"|ub:\",n+=t.endAt.inclusive?\"a:\":\"b:\",n+=t.endAt.position.map(function(e){return Ge(e)}).join(\",\")),t.P=n}return t.P}function gt(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=\" collectionGroup=\"+e.collectionGroup),e.filters.length>0&&(t+=\", filters: [\".concat(e.filters.map(function(e){return\"\".concat((t=e).field.canonicalString(),\" \").concat(t.op,\" \").concat(Ge(t.value));var t}).join(\", \"),\"]\")),Ce(e.limit)||(t+=\", limit: \"+e.limit),e.orderBy.length>0&&(t+=\", orderBy: [\".concat(e.orderBy.map(function(e){return function(e){return\"\".concat(e.field.canonicalString(),\" (\").concat(e.dir,\")\")}(e)}).join(\", \"),\"]\")),e.startAt&&(t+=\", startAt: \",t+=e.startAt.inclusive?\"b:\":\"a:\",t+=e.startAt.position.map(function(e){return Ge(e)}).join(\",\")),e.endAt&&(t+=\", endAt: \",t+=e.endAt.inclusive?\"a:\":\"b:\",t+=e.endAt.position.map(function(e){return Ge(e)}).join(\",\")),\"Target(\".concat(t,\")\")}function kt(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!Vt(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],a=t.filters[r],i.op!==a.op||!i.field.isEqual(a.field)||!qe(i.value,a.value))return!1;var i,a;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Pt(e.startAt,t.startAt)&&Pt(e.endAt,t.endAt)}function wt(e){return Ve.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function bt(e,t){return e.filters.filter(function(e){return e instanceof Et&&e.field.isEqual(t)})}function xt(e,t,n){var r,i,a=!0,u=v(bt(e,t));try{for(u.s();!(i=u.n()).done;){var o=i.value,s=void 0,c=!0;switch(o.op){case\"<\":case\"<=\":s=Ze(o.value);break;case\"==\":case\"in\":case\">=\":s=o.value;break;case\">\":s=o.value,c=!1;break;case\"!=\":case\"not-in\":s=Pe}tt(r,s)===s&&(r=s,a=c)}}catch(h){u.e(h)}finally{u.f()}if(null!==n)for(var l=0;l<e.orderBy.length;++l)if(e.orderBy[l].field.isEqual(t)){var f=n.position[l];tt(r,f)===f&&(r=f,a=n.inclusive);break}return{value:r,inclusive:a}}function It(e,t,n){var r,i,a=!0,u=v(bt(e,t));try{for(u.s();!(i=u.n()).done;){var o=i.value,s=void 0,c=!0;switch(o.op){case\">=\":case\">\":s=et(o.value),c=!1;break;case\"==\":case\"in\":case\"<=\":s=o.value;break;case\"<\":s=o.value,c=!1;break;case\"!=\":case\"not-in\":s=Fe}nt(r,s)===s&&(r=s,a=c)}}catch(h){u.e(h)}finally{u.f()}if(null!==n)for(var l=0;l<e.orderBy.length;++l)if(e.orderBy[l].field.isEqual(t)){var f=n.position[l];nt(r,f)===f&&(r=f,a=n.inclusive);break}return{value:r,inclusive:a}}var Et=function(e){m(n,function(){function e(){N(this,e)}return C(e)}());var t=k(n);function n(e,r,i){var a;return N(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return C(n,[{key:\"matches\",value:function(e){var t=e.data.field(this.field);return\"!=\"===this.op?null!==t&&this.v(Be(t,this.value)):null!==t&&Oe(this.value)===Oe(t)&&this.v(Be(t,this.value))}},{key:\"v\",value:function(e){switch(this.op){case\"<\":return e<0;case\"<=\":return e<=0;case\"==\":return 0===e;case\"!=\":return 0!==e;case\">\":return e>0;case\">=\":return e>=0;default:return G()}}},{key:\"S\",value:function(){return[\"<\",\"<=\",\">\",\">=\",\"!=\",\"not-in\"].indexOf(this.op)>=0}}],[{key:\"create\",value:function(e,t,r){return e.isKeyField()?\"in\"===t||\"not-in\"===t?this.V(e,t,r):new Tt(e,t,r):\"array-contains\"===t?new Dt(e,r):\"in\"===t?new Nt(e,r):\"not-in\"===t?new Rt(e,r):\"array-contains-any\"===t?new Ct(e,r):new n(e,t,r)}},{key:\"V\",value:function(e,t,n){return\"in\"===t?new St(e,n):new _t(e,n)}}]),n}(),Tt=function(e){m(n,Et);var t=k(n);function n(e,r,i){var a;return N(this,n),(a=t.call(this,e,r,i)).key=Ve.fromName(i.referenceValue),a}return C(n,[{key:\"matches\",value:function(e){var t=Ve.comparator(e.key,this.key);return this.v(t)}}]),n}(),St=function(e){m(n,Et);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this,e,\"in\",r)).keys=At(\"in\",r),i}return C(n,[{key:\"matches\",value:function(e){return this.keys.some(function(t){return t.isEqual(e.key)})}}]),n}(),_t=function(e){m(n,Et);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this,e,\"not-in\",r)).keys=At(\"not-in\",r),i}return C(n,[{key:\"matches\",value:function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})}}]),n}();function At(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(e){return Ve.fromName(e.referenceValue)})}var Dt=function(e){m(n,Et);var t=k(n);function n(e,r){return N(this,n),t.call(this,e,\"array-contains\",r)}return C(n,[{key:\"matches\",value:function(e){var t=e.data.field(this.field);return We(t)&&Ue(t.arrayValue,this.value)}}]),n}(),Nt=function(e){m(n,Et);var t=k(n);function n(e,r){return N(this,n),t.call(this,e,\"in\",r)}return C(n,[{key:\"matches\",value:function(e){var t=e.data.field(this.field);return null!==t&&Ue(this.value.arrayValue,t)}}]),n}(),Rt=function(e){m(n,Et);var t=k(n);function n(e,r){return N(this,n),t.call(this,e,\"not-in\",r)}return C(n,[{key:\"matches\",value:function(e){if(Ue(this.value.arrayValue,{nullValue:\"NULL_VALUE\"}))return!1;var t=e.data.field(this.field);return null!==t&&!Ue(this.value.arrayValue,t)}}]),n}(),Ct=function(e){m(n,Et);var t=k(n);function n(e,r){return N(this,n),t.call(this,e,\"array-contains-any\",r)}return C(n,[{key:\"matches\",value:function(e){var t=this,n=e.data.field(this.field);return!(!We(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(e){return Ue(t.value.arrayValue,e)})}}]),n}(),Mt=C(function e(t,n){N(this,e),this.position=t,this.inclusive=n}),Lt=C(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"asc\";N(this,e),this.field=t,this.dir=n});function Vt(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function Ft(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],u=e.position[i];if(r=a.field.isKeyField()?Ve.comparator(Ve.fromName(u.referenceValue),n.key):Be(u,n.data.field(a.field)),\"desc\"===a.dir&&(r*=-1),0!==r)break}return r}function Pt(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!qe(e.position[n],t.position[n]))return!1;return!0}var Ot=C(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:\"F\",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;N(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=u,this.startAt=o,this.endAt=s,this.D=null,this.C=null,this.startAt,this.endAt});function qt(e,t,n,r,i,a,u,o){return new Ot(e,t,n,r,i,a,u,o)}function Ut(e){return new Ot(e)}function Bt(e){return!Ce(e.limit)&&\"F\"===e.limitType}function Kt(e){return!Ce(e.limit)&&\"L\"===e.limitType}function Gt(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function jt(e){var t,n=v(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.S())return r.field}}catch(i){n.e(i)}finally{n.f()}return null}function zt(e){return null!==e.collectionGroup}function Qt(e){var t=Q(e);if(null===t.D){t.D=[];var n=jt(t),r=Gt(t);if(null!==n&&null===r)n.isKeyField()||t.D.push(new Lt(n)),t.D.push(new Lt(ke.keyField(),\"asc\"));else{var i,a=!1,u=v(t.explicitOrderBy);try{for(u.s();!(i=u.n()).done;){var o=i.value;t.D.push(o),o.field.isKeyField()&&(a=!0)}}catch(c){u.e(c)}finally{u.f()}if(!a){var s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:\"asc\";t.D.push(new Lt(ke.keyField(),s))}}}return t.D}function Wt(e){var t=Q(e);if(!t.C)if(\"F\"===t.limitType)t.C=pt(t.path,t.collectionGroup,Qt(t),t.filters,t.limit,t.startAt,t.endAt);else{var n,r=[],i=v(Qt(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,u=\"desc\"===a.dir?\"asc\":\"desc\";r.push(new Lt(a.field,u))}}catch(c){i.e(c)}finally{i.f()}var o=t.endAt?new Mt(t.endAt.position,!t.endAt.inclusive):null,s=t.startAt?new Mt(t.startAt.position,!t.startAt.inclusive):null;t.C=pt(t.path,t.collectionGroup,r,t.filters,t.limit,o,s)}return t.C}function Ht(e,t,n){return new Ot(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Yt(e,t){return kt(Wt(e),Wt(t))&&e.limitType===t.limitType}function Xt(e){return\"\".concat(mt(Wt(e)),\"|lt:\").concat(e.limitType)}function Jt(e){return\"Query(target=\".concat(gt(Wt(e)),\"; limitType=\").concat(e.limitType,\")\")}function $t(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Ve.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=v(e.explicitOrderBy);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=v(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){var r=Ft(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,Qt(e),t))&&!(e.endAt&&!function(e,t,n){var r=Ft(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,Qt(e),t))}(e,t)}function Zt(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function en(e){return function(t,n){var r,i=!1,a=v(Qt(e));try{for(a.s();!(r=a.n()).done;){var u=r.value,o=tn(u,t,n);if(0!==o)return o;i=i||u.field.isKeyField()}}catch(s){a.e(s)}finally{a.f()}return 0}}function tn(e,t,n){var r=e.field.isKeyField()?Ve.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Be(r,i):G()}(e.field,t,n);switch(e.dir){case\"asc\":return r;case\"desc\":return-1*r;default:return G()}}function nn(e,t){if(e.N){if(isNaN(t))return{doubleValue:\"NaN\"};if(t===1/0)return{doubleValue:\"Infinity\"};if(t===-1/0)return{doubleValue:\"-Infinity\"}}return{doubleValue:Me(t)?\"-0\":t}}function rn(e){return{integerValue:\"\"+e}}function an(e,t){return Le(t)?rn(t):nn(e,t)}var un=C(function e(){N(this,e),this._=void 0});function on(e,t,n){return e instanceof ln?function(e,t){var n={fields:{__type__:{stringValue:\"server_timestamp\"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof fn?hn(e,t):e instanceof dn?vn(e,t):function(e,t){var n=cn(e,t),r=pn(n)+pn(e.k);return Qe(n)&&Qe(e.k)?rn(r):nn(e.M,r)}(e,t)}function sn(e,t,n){return e instanceof fn?hn(e,t):e instanceof dn?vn(e,t):n}function cn(e,t){return e instanceof yn?Qe(n=t)||n&&\"doubleValue\"in n?t:{integerValue:0}:null;var n}var ln=function(e){m(n,un);var t=k(n);function n(){return N(this,n),t.apply(this,arguments)}return C(n)}(),fn=function(e){m(n,un);var t=k(n);function n(e){var r;return N(this,n),(r=t.call(this)).elements=e,r}return C(n)}();function hn(e,t){var n,r=mn(t),i=v(e.elements);try{var a=function(){var e=n.value;r.some(function(t){return qe(t,e)})||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var dn=function(e){m(n,un);var t=k(n);function n(e){var r;return N(this,n),(r=t.call(this)).elements=e,r}return C(n)}();function vn(e,t){var n,r=mn(t),i=v(e.elements);try{var a=function(){var e=n.value;r=r.filter(function(t){return!qe(t,e)})};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var yn=function(e){m(n,un);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this)).M=e,i.k=r,i}return C(n)}();function pn(e){return Te(e.integerValue||e.doubleValue)}function mn(e){return We(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var gn=C(function e(t,n){N(this,e),this.field=t,this.transform=n});function kn(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof fn&&t instanceof fn||e instanceof dn&&t instanceof dn?ce(e.elements,t.elements,qe):e instanceof yn&&t instanceof yn?qe(e.k,t.k):e instanceof ln&&t instanceof ln}(e.transform,t.transform)}var wn=C(function e(t,n){N(this,e),this.version=t,this.transformResults=n}),bn=function(){function e(t,n){N(this,e),this.updateTime=t,this.exists=n}return C(e,[{key:\"isNone\",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:\"isEqual\",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:\"none\",value:function(){return new e}},{key:\"exists\",value:function(t){return new e(void 0,t)}},{key:\"updateTime\",value:function(t){return new e(t)}}]),e}();function xn(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var In=C(function e(){N(this,e)});function En(e,t,n){e instanceof Dn?function(e,t,n){var r=e.value.clone(),i=Cn(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Nn?function(e,t,n){if(xn(e.precondition,t)){var r=Cn(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Rn(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Tn(e,t,n){e instanceof Dn?function(e,t,n){if(xn(e.precondition,t)){var r=e.value.clone(),i=Mn(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(An(t),r).setHasLocalMutations()}}(e,t,n):e instanceof Nn?function(e,t,n){if(xn(e.precondition,t)){var r=Mn(e.fieldTransforms,n,t),i=t.data;i.setAll(Rn(e)),i.setAll(r),t.convertToFoundDocument(An(t),i).setHasLocalMutations()}}(e,t,n):function(e,t){xn(e.precondition,t)&&t.convertToNoDocument(he.min())}(e,t)}function Sn(e,t){var n,r=null,i=v(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.field),o=cn(a.transform,u||null);null!=o&&(null==r&&(r=rt.empty()),r.set(a.field,o))}}catch(s){i.e(s)}finally{i.f()}return r||null}function _n(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ce(e,t,function(e,t){return kn(e,t)})}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function An(e){return e.isFoundDocument()?e.version:he.min()}var Dn=function(e){m(n,In);var t=k(n);function n(e,r,i){var a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return N(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=u,a.type=0,a}return C(n)}(),Nn=function(e){m(n,In);var t=k(n);function n(e,r,i,a){var u,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return N(this,n),(u=t.call(this)).key=e,u.data=r,u.fieldMask=i,u.precondition=a,u.fieldTransforms=o,u.type=1,u}return C(n)}();function Rn(e){var t=new Map;return e.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}}),t}function Cn(e,t,n){var r=new Map;j(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],u=a.transform,o=t.data.field(a.field);r.set(a.field,sn(u,o,n[i]))}return r}function Mn(e,t,n){var r,i=new Map,a=v(e);try{for(a.s();!(r=a.n()).done;){var u=r.value,o=u.transform,s=n.data.field(u.field);i.set(u.field,on(o,s,t))}}catch(c){a.e(c)}finally{a.f()}return i}var Ln,Vn,Fn=function(e){m(n,In);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return C(n)}(),Pn=function(e){m(n,In);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return C(n)}(),On=C(function e(t){N(this,e),this.count=t});function qn(e){switch(e){default:return G();case W.CANCELLED:case W.UNKNOWN:case W.DEADLINE_EXCEEDED:case W.RESOURCE_EXHAUSTED:case W.INTERNAL:case W.UNAVAILABLE:case W.UNAUTHENTICATED:return!1;case W.INVALID_ARGUMENT:case W.NOT_FOUND:case W.ALREADY_EXISTS:case W.PERMISSION_DENIED:case W.FAILED_PRECONDITION:case W.ABORTED:case W.OUT_OF_RANGE:case W.UNIMPLEMENTED:case W.DATA_LOSS:return!0}}function Un(e){if(void 0===e)return U(\"GRPC error has no .code\"),W.UNKNOWN;switch(e){case Ln.OK:return W.OK;case Ln.CANCELLED:return W.CANCELLED;case Ln.UNKNOWN:return W.UNKNOWN;case Ln.DEADLINE_EXCEEDED:return W.DEADLINE_EXCEEDED;case Ln.RESOURCE_EXHAUSTED:return W.RESOURCE_EXHAUSTED;case Ln.INTERNAL:return W.INTERNAL;case Ln.UNAVAILABLE:return W.UNAVAILABLE;case Ln.UNAUTHENTICATED:return W.UNAUTHENTICATED;case Ln.INVALID_ARGUMENT:return W.INVALID_ARGUMENT;case Ln.NOT_FOUND:return W.NOT_FOUND;case Ln.ALREADY_EXISTS:return W.ALREADY_EXISTS;case Ln.PERMISSION_DENIED:return W.PERMISSION_DENIED;case Ln.FAILED_PRECONDITION:return W.FAILED_PRECONDITION;case Ln.ABORTED:return W.ABORTED;case Ln.OUT_OF_RANGE:return W.OUT_OF_RANGE;case Ln.UNIMPLEMENTED:return W.UNIMPLEMENTED;case Ln.DATA_LOSS:return W.DATA_LOSS;default:return G()}}(Vn=Ln||(Ln={}))[Vn.OK=0]=\"OK\",Vn[Vn.CANCELLED=1]=\"CANCELLED\",Vn[Vn.UNKNOWN=2]=\"UNKNOWN\",Vn[Vn.INVALID_ARGUMENT=3]=\"INVALID_ARGUMENT\",Vn[Vn.DEADLINE_EXCEEDED=4]=\"DEADLINE_EXCEEDED\",Vn[Vn.NOT_FOUND=5]=\"NOT_FOUND\",Vn[Vn.ALREADY_EXISTS=6]=\"ALREADY_EXISTS\",Vn[Vn.PERMISSION_DENIED=7]=\"PERMISSION_DENIED\",Vn[Vn.UNAUTHENTICATED=16]=\"UNAUTHENTICATED\",Vn[Vn.RESOURCE_EXHAUSTED=8]=\"RESOURCE_EXHAUSTED\",Vn[Vn.FAILED_PRECONDITION=9]=\"FAILED_PRECONDITION\",Vn[Vn.ABORTED=10]=\"ABORTED\",Vn[Vn.OUT_OF_RANGE=11]=\"OUT_OF_RANGE\",Vn[Vn.UNIMPLEMENTED=12]=\"UNIMPLEMENTED\",Vn[Vn.INTERNAL=13]=\"INTERNAL\",Vn[Vn.UNAVAILABLE=14]=\"UNAVAILABLE\",Vn[Vn.DATA_LOSS=15]=\"DATA_LOSS\";var Bn=function(){function e(t,n){N(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}return C(e,[{key:\"get\",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=v(n);try{for(i.s();!(r=i.n()).done;){var a=c(r.value,2),u=a[0],o=a[1];if(this.equalsFn(u,e))return o}}catch(s){i.e(s)}finally{i.f()}}}},{key:\"has\",value:function(e){return void 0!==this.get(e)}},{key:\"set\",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}},{key:\"delete\",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}},{key:\"forEach\",value:function(e){ve(this.inner,function(t,n){var r,i=v(n);try{for(i.s();!(r=i.n()).done;){var a=c(r.value,2),u=a[0],o=a[1];e(u,o)}}catch(s){i.e(s)}finally{i.f()}})}},{key:\"isEmpty\",value:function(){return ye(this.inner)}},{key:\"size\",value:function(){return this.innerSize}}]),e}(),Kn=function(){function e(t,n){N(this,e),this.comparator=t,this.root=n||jn.EMPTY}return C(e,[{key:\"insert\",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,jn.BLACK,null,null))}},{key:\"remove\",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,jn.BLACK,null,null))}},{key:\"get\",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:\"indexOf\",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:\"isEmpty\",value:function(){return this.root.isEmpty()}},{key:\"size\",get:function(){return this.root.size}},{key:\"minKey\",value:function(){return this.root.minKey()}},{key:\"maxKey\",value:function(){return this.root.maxKey()}},{key:\"inorderTraversal\",value:function(e){return this.root.inorderTraversal(e)}},{key:\"forEach\",value:function(e){this.inorderTraversal(function(t,n){return e(t,n),!1})}},{key:\"toString\",value:function(){var e=[];return this.inorderTraversal(function(t,n){return e.push(\"\".concat(t,\":\").concat(n)),!1}),\"{\".concat(e.join(\", \"),\"}\")}},{key:\"reverseTraversal\",value:function(e){return this.root.reverseTraversal(e)}},{key:\"getIterator\",value:function(){return new Gn(this.root,null,this.comparator,!1)}},{key:\"getIteratorFrom\",value:function(e){return new Gn(this.root,e,this.comparator,!1)}},{key:\"getReverseIterator\",value:function(){return new Gn(this.root,null,this.comparator,!0)}},{key:\"getReverseIteratorFrom\",value:function(e){return new Gn(this.root,e,this.comparator,!0)}}]),e}(),Gn=function(){function e(t,n,r,i){N(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,n&&i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return C(e,[{key:\"getNext\",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:\"hasNext\",value:function(){return this.nodeStack.length>0}},{key:\"peek\",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),jn=function(){function e(t,n,r,i,a){N(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return C(e,[{key:\"copy\",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:\"isEmpty\",value:function(){return!1}},{key:\"inorderTraversal\",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:\"reverseTraversal\",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:\"min\",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:\"minKey\",value:function(){return this.min().key}},{key:\"maxKey\",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:\"insert\",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:\"removeMin\",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:\"remove\",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:\"isRed\",value:function(){return this.color}},{key:\"fixUp\",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:\"moveRedLeft\",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:\"moveRedRight\",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:\"rotateLeft\",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:\"rotateRight\",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:\"colorFlip\",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:\"checkMaxDepth\",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:\"check\",value:function(){if(this.isRed()&&this.left.isRed())throw G();if(this.right.isRed())throw G();var e=this.left.check();if(e!==this.right.check())throw G();return e+(this.isRed()?0:1)}}]),e}();jn.EMPTY=null,jn.RED=!0,jn.BLACK=!1,jn.EMPTY=new(function(){function e(){N(this,e),this.size=0}return C(e,[{key:\"key\",get:function(){throw G()}},{key:\"value\",get:function(){throw G()}},{key:\"color\",get:function(){throw G()}},{key:\"left\",get:function(){throw G()}},{key:\"right\",get:function(){throw G()}},{key:\"copy\",value:function(e,t,n,r,i){return this}},{key:\"insert\",value:function(e,t,n){return new jn(e,t)}},{key:\"remove\",value:function(e,t){return this}},{key:\"isEmpty\",value:function(){return!0}},{key:\"inorderTraversal\",value:function(e){return!1}},{key:\"reverseTraversal\",value:function(e){return!1}},{key:\"minKey\",value:function(){return null}},{key:\"maxKey\",value:function(){return null}},{key:\"isRed\",value:function(){return!1}},{key:\"checkMaxDepth\",value:function(){return!0}},{key:\"check\",value:function(){return 0}}]),e}());var zn=function(){function e(t){N(this,e),this.comparator=t,this.data=new Kn(this.comparator)}return C(e,[{key:\"has\",value:function(e){return null!==this.data.get(e)}},{key:\"first\",value:function(){return this.data.minKey()}},{key:\"last\",value:function(){return this.data.maxKey()}},{key:\"size\",get:function(){return this.data.size}},{key:\"indexOf\",value:function(e){return this.data.indexOf(e)}},{key:\"forEach\",value:function(e){this.data.inorderTraversal(function(t,n){return e(t),!1})}},{key:\"forEachInRange\",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:\"forEachWhile\",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:\"firstAfterOrEqual\",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:\"getIterator\",value:function(){return new Qn(this.data.getIterator())}},{key:\"getIteratorFrom\",value:function(e){return new Qn(this.data.getIteratorFrom(e))}},{key:\"add\",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:\"delete\",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:\"isEmpty\",value:function(){return this.data.isEmpty()}},{key:\"unionWith\",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach(function(e){t=t.add(e)}),t}},{key:\"isEqual\",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:\"toArray\",value:function(){var e=[];return this.forEach(function(t){e.push(t)}),e}},{key:\"toString\",value:function(){var e=[];return this.forEach(function(t){return e.push(t)}),\"SortedSet(\"+e.toString()+\")\"}},{key:\"copy\",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),Qn=function(){function e(t){N(this,e),this.iter=t}return C(e,[{key:\"getNext\",value:function(){return this.iter.getNext().key}},{key:\"hasNext\",value:function(){return this.iter.hasNext()}}]),e}();function Wn(e){return e.hasNext()?e.getNext():void 0}var Hn=new Kn(Ve.comparator);function Yn(){return Hn}var Xn=new Kn(Ve.comparator);function Jn(){return Xn}function $n(){return new Bn(function(e){return e.toString()},function(e,t){return e.isEqual(t)})}var Zn=new Kn(Ve.comparator),er=new zn(Ve.comparator);function tr(){for(var e=er,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=e.add(u)}return e}var nr=new zn(se);function rr(){return nr}var ir=function(){function e(t,n,r,i,a){N(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return C(e,null,[{key:\"createSynthesizedRemoteEventForCurrentChange\",value:function(t,n){var r=new Map;return r.set(t,ar.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(he.min(),r,rr(),Yn(),tr())}}]),e}(),ar=function(){function e(t,n,r,i,a){N(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return C(e,null,[{key:\"createSynthesizedTargetChangeForCurrentChange\",value:function(t,n){return new e(xe.EMPTY_BYTE_STRING,n,tr(),tr(),tr())}}]),e}(),ur=C(function e(t,n,r,i){N(this,e),this.O=t,this.removedTargetIds=n,this.key=r,this.F=i}),or=C(function e(t,n){N(this,e),this.targetId=t,this.$=n}),sr=C(function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xe.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;N(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i}),cr=function(){function e(){N(this,e),this.B=0,this.L=hr(),this.U=xe.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}return C(e,[{key:\"current\",get:function(){return this.q}},{key:\"resumeToken\",get:function(){return this.U}},{key:\"G\",get:function(){return 0!==this.B}},{key:\"j\",get:function(){return this.K}},{key:\"W\",value:function(e){e.approximateByteSize()>0&&(this.K=!0,this.U=e)}},{key:\"H\",value:function(){var e=tr(),t=tr(),n=tr();return this.L.forEach(function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:G()}}),new ar(this.U,this.q,e,t,n)}},{key:\"J\",value:function(){this.K=!1,this.L=hr()}},{key:\"Y\",value:function(e,t){this.K=!0,this.L=this.L.insert(e,t)}},{key:\"X\",value:function(e){this.K=!0,this.L=this.L.remove(e)}},{key:\"Z\",value:function(){this.B+=1}},{key:\"tt\",value:function(){this.B-=1}},{key:\"et\",value:function(){this.K=!0,this.q=!0}}]),e}(),lr=function(){function e(t){N(this,e),this.nt=t,this.st=new Map,this.it=Yn(),this.rt=fr(),this.ot=new zn(se)}return C(e,[{key:\"ut\",value:function(e){var t,n=v(e.O);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.F&&e.F.isFoundDocument()?this.at(r,e.F):this.ct(r,e.key,e.F)}}catch(o){n.e(o)}finally{n.f()}var i,a=v(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var u=i.value;this.ct(u,e.key,e.F)}}catch(o){a.e(o)}finally{a.f()}}},{key:\"ht\",value:function(e){var t=this;this.forEachTarget(e,function(n){var r=t.lt(n);switch(e.state){case 0:t.ft(n)&&r.W(e.resumeToken);break;case 1:r.tt(),r.G||r.J(),r.W(e.resumeToken);break;case 2:r.tt(),r.G||t.removeTarget(n);break;case 3:t.ft(n)&&(r.et(),r.W(e.resumeToken));break;case 4:t.ft(n)&&(t.dt(n),r.W(e.resumeToken));break;default:G()}})}},{key:\"forEachTarget\",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.st.forEach(function(e,r){n.ft(r)&&t(r)})}},{key:\"_t\",value:function(e){var t=e.targetId,n=e.$.count,r=this.wt(t);if(r){var i=r.target;if(wt(i))if(0===n){var a=new Ve(i.path);this.ct(t,a,at.newNoDocument(a,he.min()))}else j(1===n);else this.gt(t)!==n&&(this.dt(t),this.ot=this.ot.add(t))}}},{key:\"yt\",value:function(e){var t=this,n=new Map;this.st.forEach(function(r,i){var a=t.wt(i);if(a){if(r.current&&wt(a.target)){var u=new Ve(a.target.path);null!==t.it.get(u)||t.It(i,u)||t.ct(i,u,at.newNoDocument(u,e))}r.j&&(n.set(i,r.H()),r.J())}});var r=tr();this.rt.forEach(function(e,n){var i=!0;n.forEachWhile(function(e){var n=t.wt(e);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(e))}),this.it.forEach(function(t,n){return n.setReadTime(e)});var i=new ir(e,n,this.ot,this.it,r);return this.it=Yn(),this.rt=fr(),this.ot=new zn(se),i}},{key:\"at\",value:function(e,t){if(this.ft(e)){var n=this.It(e,t.key)?2:0;this.lt(e).Y(t.key,n),this.it=this.it.insert(t.key,t),this.rt=this.rt.insert(t.key,this.Tt(t.key).add(e))}}},{key:\"ct\",value:function(e,t,n){if(this.ft(e)){var r=this.lt(e);this.It(e,t)?r.Y(t,1):r.X(t),this.rt=this.rt.insert(t,this.Tt(t).delete(e)),n&&(this.it=this.it.insert(t,n))}}},{key:\"removeTarget\",value:function(e){this.st.delete(e)}},{key:\"gt\",value:function(e){var t=this.lt(e).H();return this.nt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:\"Z\",value:function(e){this.lt(e).Z()}},{key:\"lt\",value:function(e){var t=this.st.get(e);return t||(t=new cr,this.st.set(e,t)),t}},{key:\"Tt\",value:function(e){var t=this.rt.get(e);return t||(t=new zn(se),this.rt=this.rt.insert(e,t)),t}},{key:\"ft\",value:function(e){var t=null!==this.wt(e);return t||q(\"WatchChangeAggregator\",\"Detected inactive target\",e),t}},{key:\"wt\",value:function(e){var t=this.st.get(e);return t&&t.G?null:this.nt.Et(e)}},{key:\"dt\",value:function(e){var t=this;this.st.set(e,new cr),this.nt.getRemoteKeysForTarget(e).forEach(function(n){t.ct(e,n,null)})}},{key:\"It\",value:function(e,t){return this.nt.getRemoteKeysForTarget(e).has(t)}}]),e}();function fr(){return new Kn(Ve.comparator)}function hr(){return new Kn(Ve.comparator)}var dr={asc:\"ASCENDING\",desc:\"DESCENDING\"},vr={\"<\":\"LESS_THAN\",\"<=\":\"LESS_THAN_OR_EQUAL\",\">\":\"GREATER_THAN\",\">=\":\"GREATER_THAN_OR_EQUAL\",\"==\":\"EQUAL\",\"!=\":\"NOT_EQUAL\",\"array-contains\":\"ARRAY_CONTAINS\",in:\"IN\",\"not-in\":\"NOT_IN\",\"array-contains-any\":\"ARRAY_CONTAINS_ANY\"},yr=C(function e(t,n){N(this,e),this.databaseId=t,this.N=n});function pr(e,t){return e.N?\"\".concat(new Date(1e3*t.seconds).toISOString().replace(/\\.\\d*/,\"\").replace(\"Z\",\"\"),\".\").concat((\"000000000\"+t.nanoseconds).slice(-9),\"Z\"):{seconds:\"\"+t.seconds,nanos:t.nanoseconds}}function mr(e,t){return e.N?t.toBase64():t.toUint8Array()}function gr(e,t){return pr(e,t.toTimestamp())}function kr(e){return j(!!e),he.fromTimestamp(function(e){var t=Ee(e);return new fe(t.seconds,t.nanos)}(e))}function wr(e,t){return function(e){return new me([\"projects\",e.projectId,\"databases\",e.database])}(e).child(\"documents\").child(t).canonicalString()}function br(e){var t=me.fromString(e);return j(Wr(t)),t}function xr(e,t){return wr(e.databaseId,t.path)}function Ir(e,t){var n=br(t);if(n.get(1)!==e.databaseId.projectId)throw new H(W.INVALID_ARGUMENT,\"Tried to deserialize key from different project: \"+n.get(1)+\" vs \"+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new H(W.INVALID_ARGUMENT,\"Tried to deserialize key from different database: \"+n.get(3)+\" vs \"+e.databaseId.database);return new Ve(_r(n))}function Er(e,t){return wr(e.databaseId,t)}function Tr(e){var t=br(e);return 4===t.length?me.emptyPath():_r(t)}function Sr(e){return new me([\"projects\",e.databaseId.projectId,\"databases\",e.databaseId.database]).canonicalString()}function _r(e){return j(e.length>4&&\"documents\"===e.get(4)),e.popFirst(5)}function Ar(e,t,n){return{name:xr(e,t),fields:n.value.mapValue.fields}}function Dr(e,t,n){var r=Ir(e,t.name),i=kr(t.updateTime),a=new rt({mapValue:{fields:t.fields}}),u=at.newFoundDocument(r,i,a);return n&&u.setHasCommittedMutations(),n?u.setHasCommittedMutations():u}function Nr(e,t){return\"found\"in t?function(e,t){j(!!t.found),t.found.name,t.found.updateTime;var n=Ir(e,t.found.name),r=kr(t.found.updateTime),i=new rt({mapValue:{fields:t.found.fields}});return at.newFoundDocument(n,r,i)}(e,t):\"missing\"in t?function(e,t){j(!!t.missing),j(!!t.readTime);var n=Ir(e,t.missing),r=kr(t.readTime);return at.newNoDocument(n,r)}(e,t):G()}function Rr(e,t){var n;if(\"targetChange\"in t){t.targetChange;var r=function(e){return\"NO_CHANGE\"===e?0:\"ADD\"===e?1:\"REMOVE\"===e?2:\"CURRENT\"===e?3:\"RESET\"===e?4:G()}(t.targetChange.targetChangeType||\"NO_CHANGE\"),i=t.targetChange.targetIds||[],a=function(e,t){return e.N?(j(void 0===t||\"string\"==typeof t),xe.fromBase64String(t||\"\")):(j(void 0===t||t instanceof Uint8Array),xe.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),u=t.targetChange.cause,o=u&&function(e){var t=void 0===e.code?W.UNKNOWN:Un(e.code);return new H(t,e.message||\"\")}(u);n=new sr(r,i,a,o||null)}else if(\"documentChange\"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var c=Ir(e,s.document.name),l=kr(s.document.updateTime),f=new rt({mapValue:{fields:s.document.fields}}),h=at.newFoundDocument(c,l,f),d=s.targetIds||[],v=s.removedTargetIds||[];n=new ur(d,v,h.key,h)}else if(\"documentDelete\"in t){t.documentDelete;var y=t.documentDelete;y.document;var p=Ir(e,y.document),m=y.readTime?kr(y.readTime):he.min(),g=at.newNoDocument(p,m),k=y.removedTargetIds||[];n=new ur([],k,g.key,g)}else if(\"documentRemove\"in t){t.documentRemove;var w=t.documentRemove;w.document;var b=Ir(e,w.document),x=w.removedTargetIds||[];n=new ur([],x,b,null)}else{if(!(\"filter\"in t))return G();t.filter;var I=t.filter;I.targetId;var E=I.count||0,T=new On(E),S=I.targetId;n=new or(S,T)}return n}function Cr(e,t){var n;if(t instanceof Dn)n={update:Ar(e,t.key,t.value)};else if(t instanceof Fn)n={delete:xr(e,t.key)};else if(t instanceof Nn)n={update:Ar(e,t.key,t.data),updateMask:Qr(t.fieldMask)};else{if(!(t instanceof Pn))return G();n={verify:xr(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(function(e){return function(e,t){var n=t.transform;if(n instanceof ln)return{fieldPath:t.field.canonicalString(),setToServerValue:\"REQUEST_TIME\"};if(n instanceof fn)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof dn)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof yn)return{fieldPath:t.field.canonicalString(),increment:n.k};throw G()}(0,e)})),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:gr(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:G()}(e,t.precondition)),n}function Mr(e,t){var n=t.currentDocument?function(e){return void 0!==e.updateTime?bn.updateTime(kr(e.updateTime)):void 0!==e.exists?bn.exists(e.exists):bn.none()}(t.currentDocument):bn.none(),r=t.updateTransforms?t.updateTransforms.map(function(t){return function(e,t){var n=null;if(\"setToServerValue\"in t)j(\"REQUEST_TIME\"===t.setToServerValue),n=new ln;else if(\"appendMissingElements\"in t){var r=t.appendMissingElements.values||[];n=new fn(r)}else if(\"removeAllFromArray\"in t){var i=t.removeAllFromArray.values||[];n=new dn(i)}else\"increment\"in t?n=new yn(e,t.increment):G();var a=ke.fromServerFormat(t.fieldPath);return new gn(a,n)}(e,t)}):[];if(t.update){t.update.name;var i=Ir(e,t.update.name),a=new rt({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=function(e){var t=e.fieldPaths||[];return new we(t.map(function(e){return ke.fromServerFormat(e)}))}(t.updateMask);return new Nn(i,a,u,n,r)}return new Dn(i,a,n,r)}if(t.delete){var o=Ir(e,t.delete);return new Fn(o,n)}if(t.verify){var s=Ir(e,t.verify);return new Pn(s,n)}return G()}function Lr(e,t){return e&&e.length>0?(j(void 0!==t),e.map(function(e){return function(e,t){var n=e.updateTime?kr(e.updateTime):kr(t);return n.isEqual(he.min())&&(n=kr(t)),new wn(n,e.transformResults||[])}(e,t)})):[]}function Vr(e,t){return{documents:[Er(e,t.path)]}}function Fr(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Er(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Er(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map(function(e){return function(e){if(\"==\"===e.op){if(Ye(e.value))return{unaryFilter:{field:Kr(e.field),op:\"IS_NAN\"}};if(He(e.value))return{unaryFilter:{field:Kr(e.field),op:\"IS_NULL\"}}}else if(\"!=\"===e.op){if(Ye(e.value))return{unaryFilter:{field:Kr(e.field),op:\"IS_NOT_NAN\"}};if(He(e.value))return{unaryFilter:{field:Kr(e.field),op:\"IS_NOT_NULL\"}}}return{fieldFilter:{field:Kr(e.field),op:Br(e.op),value:e.value}}}(e)});return 1===t.length?t[0]:{compositeFilter:{op:\"AND\",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);var a=function(e){if(0!==e.length)return e.map(function(e){return function(e){return{field:Kr(e.field),direction:Ur(e.dir)}}(e)})}(t.orderBy);a&&(n.structuredQuery.orderBy=a);var u,o=function(e,t){return e.N||Ce(t)?t:{value:t}}(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(u=t.startAt).inclusive,values:u.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Pr(e){var t=Tr(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){j(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var u=[];n.where&&(u=qr(n.where));var o=[];n.orderBy&&(o=n.orderBy.map(function(e){return function(e){return new Lt(Gr(e.field),function(e){switch(e){case\"ASCENDING\":return\"asc\";case\"DESCENDING\":return\"desc\";default:return}}(e.direction))}(e)}));var s=null;n.limit&&(s=function(e){var t;return Ce(t=\"object\"==d(e)?e.value:e)?null:t}(n.limit));var c=null;n.startAt&&(c=function(e){var t=!!e.before,n=e.values||[];return new Mt(n,t)}(n.startAt));var l=null;return n.endAt&&(l=function(e){var t=!e.before,n=e.values||[];return new Mt(n,t)}(n.endAt)),qt(t,i,o,u,s,\"F\",c,l)}function Or(e,t){var n=function(e,t){switch(t){case 0:return null;case 1:return\"existence-filter-mismatch\";case 2:return\"limbo-document\";default:return G()}}(0,t.purpose);return null==n?null:{\"goog-listen-tags\":n}}function qr(e){return e?void 0!==e.unaryFilter?[zr(e)]:void 0!==e.fieldFilter?[jr(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(function(e){return qr(e)}).reduce(function(e,t){return e.concat(t)}):G():[]}function Ur(e){return dr[e]}function Br(e){return vr[e]}function Kr(e){return{fieldPath:e.canonicalString()}}function Gr(e){return ke.fromServerFormat(e.fieldPath)}function jr(e){return Et.create(Gr(e.fieldFilter.field),function(e){switch(e){case\"EQUAL\":return\"==\";case\"NOT_EQUAL\":return\"!=\";case\"GREATER_THAN\":return\">\";case\"GREATER_THAN_OR_EQUAL\":return\">=\";case\"LESS_THAN\":return\"<\";case\"LESS_THAN_OR_EQUAL\":return\"<=\";case\"ARRAY_CONTAINS\":return\"array-contains\";case\"IN\":return\"in\";case\"NOT_IN\":return\"not-in\";case\"ARRAY_CONTAINS_ANY\":return\"array-contains-any\";default:return G()}}(e.fieldFilter.op),e.fieldFilter.value)}function zr(e){switch(e.unaryFilter.op){case\"IS_NAN\":var t=Gr(e.unaryFilter.field);return Et.create(t,\"==\",{doubleValue:NaN});case\"IS_NULL\":var n=Gr(e.unaryFilter.field);return Et.create(n,\"==\",{nullValue:\"NULL_VALUE\"});case\"IS_NOT_NAN\":var r=Gr(e.unaryFilter.field);return Et.create(r,\"!=\",{doubleValue:NaN});case\"IS_NOT_NULL\":var i=Gr(e.unaryFilter.field);return Et.create(i,\"!=\",{nullValue:\"NULL_VALUE\"});default:return G()}}function Qr(e){var t=[];return e.fields.forEach(function(e){return t.push(e.canonicalString())}),{fieldPaths:t}}function Wr(e){return e.length>=4&&\"projects\"===e.get(0)&&\"databases\"===e.get(2)}function Hr(e){for(var t=\"\",n=0;n<e.length;n++)t.length>0&&(t=Xr(t)),t=Yr(e.get(n),t);return Xr(t)}function Yr(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var a=e.charAt(i);switch(a){case\"\\0\":n+=\"\u0001\u0010\";break;case\"\u0001\":n+=\"\u0001\u0011\";break;default:n+=a}}return n}function Xr(e){return e+\"\u0001\u0001\"}function Jr(e){var t=e.length;if(j(t>=2),2===t)return j(\"\u0001\"===e.charAt(0)&&\"\u0001\"===e.charAt(1)),me.emptyPath();for(var n=t-2,r=[],i=\"\",a=0;a<t;){var u=e.indexOf(\"\u0001\",a);switch((u<0||u>n)&&G(),e.charAt(u+1)){case\"\u0001\":var o=e.substring(a,u),s=void 0;0===i.length?s=o:(s=i+=o,i=\"\"),r.push(s);break;case\"\u0010\":i+=e.substring(a,u),i+=\"\\0\";break;case\"\u0011\":i+=e.substring(a,u+1);break;default:G()}a=u+2}return new me(r)}var $r=[\"userId\",\"batchId\"];function Zr(e,t){return[e,Hr(t)]}function ei(e,t,n){return[e,Hr(t),n]}var ti={},ni=[\"prefixPath\",\"collectionGroup\",\"readTime\",\"documentId\"],ri=[\"prefixPath\",\"collectionGroup\",\"documentId\"],ii=[\"collectionGroup\",\"readTime\",\"prefixPath\",\"documentId\"],ai=[\"canonicalId\",\"targetId\"],ui=[\"targetId\",\"path\"],oi=[\"path\",\"targetId\"],si=[\"collectionId\",\"parent\"],ci=[\"indexId\",\"uid\"],li=[\"uid\",\"sequenceNumber\"],fi=[\"indexId\",\"uid\",\"arrayValue\",\"directionalValue\",\"orderedDocumentKey\",\"documentKey\"],hi=[\"indexId\",\"uid\",\"orderedDocumentKey\"],di=[\"userId\",\"collectionPath\",\"documentId\"],vi=[\"userId\",\"collectionPath\",\"largestBatchId\"],yi=[\"userId\",\"collectionGroup\",\"largestBatchId\"],pi=[\"mutationQueues\",\"mutations\",\"documentMutations\",\"remoteDocuments\",\"targets\",\"owner\",\"targetGlobal\",\"targetDocuments\"].concat([\"clientMetadata\"]).concat([\"remoteDocumentGlobal\"]).concat([\"collectionParents\"]).concat([\"bundles\",\"namedQueries\"]),mi=[].concat(E(pi),[\"documentOverlays\"]),gi=[\"mutationQueues\",\"mutations\",\"documentMutations\",\"remoteDocumentsV14\",\"targets\",\"owner\",\"targetGlobal\",\"targetDocuments\",\"clientMetadata\",\"remoteDocumentGlobal\",\"collectionParents\",\"bundles\",\"namedQueries\",\"documentOverlays\"],ki=[].concat(gi,[\"indexConfiguration\",\"indexState\",\"indexEntries\"]),wi=\"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.\",bi=function(){function e(){N(this,e),this.onCommittedListeners=[]}return C(e,[{key:\"addOnCommittedListener\",value:function(e){this.onCommittedListeners.push(e)}},{key:\"raiseOnCommittedEvent\",value:function(){this.onCommittedListeners.forEach(function(e){return e()})}}]),e}(),xi=function(){function e(t){var n=this;N(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)},function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)})}return C(e,[{key:\"catch\",value:function(e){return this.next(void 0,e)}},{key:\"next\",value:function(t,n){var r=this;return this.callbackAttached&&G(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e(function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}})}},{key:\"toPromise\",value:function(){var e=this;return new Promise(function(t,n){e.next(t,n)})}},{key:\"wrapUserFunction\",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:\"wrapSuccess\",value:function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.resolve(n)}},{key:\"wrapFailure\",value:function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.reject(n)}}],[{key:\"resolve\",value:function(t){return new e(function(e,n){e(t)})}},{key:\"reject\",value:function(t){return new e(function(e,n){n(t)})}},{key:\"waitFor\",value:function(t){return new e(function(e,n){var r=0,i=0,a=!1;t.forEach(function(t){++r,t.next(function(){++i,a&&i===r&&e()},function(e){return n(e)})}),a=!0,i===r&&e()})}},{key:\"or\",value:function(t){var n,r=e.resolve(!1),i=v(t);try{var a=function(){var t=n.value;r=r.next(function(n){return n?e.resolve(n):t()})};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return r}},{key:\"forEach\",value:function(e,t){var n=this,r=[];return e.forEach(function(e,i){r.push(t.call(n,e,i))}),this.waitFor(r)}}]),e}(),Ii=function(){function e(t,n){var r=this;N(this,e),this.action=t,this.transaction=n,this.aborted=!1,this.At=new Y,this.transaction.oncomplete=function(){r.At.resolve()},this.transaction.onabort=function(){n.error?r.At.reject(new Si(t,n.error)):r.At.resolve()},this.transaction.onerror=function(e){var n=Ri(e.target.error);r.At.reject(new Si(t,n))}}return C(e,[{key:\"Rt\",get:function(){return this.At.promise}},{key:\"abort\",value:function(e){e&&this.At.reject(e),this.aborted||(q(\"SimpleDb\",\"Aborting transaction:\",e?e.message:\"Client-initiated abort\"),this.aborted=!0,this.transaction.abort())}},{key:\"Pt\",value:function(){var e=this.transaction;this.aborted||\"function\"!=typeof e.commit||e.commit()}},{key:\"store\",value:function(e){var t=this.transaction.objectStore(e);return new Ai(t)}}],[{key:\"open\",value:function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(t){throw new Si(n,t)}}}]),e}(),Ei=function(){function t(e,n,r){N(this,t),this.name=e,this.version=n,this.bt=r,12.2===t.Vt((0,i.getUA)())&&U(\"Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.\")}return C(t,[{key:\"Nt\",value:function(){var e=p(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.db,e.t0){e.next=6;break}return q(\"SimpleDb\",\"Opening database:\",this.name),e.next=5,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new Si(t,\"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed.\"))},i.onerror=function(e){var n=e.target.error;\"VersionError\"===n.name?r(new H(W.FAILED_PRECONDITION,\"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.\")):\"InvalidStateError\"===n.name?r(new H(W.FAILED_PRECONDITION,\"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: \"+n)):r(new Si(t,n))},i.onupgradeneeded=function(e){q(\"SimpleDb\",'Database \"'+n.name+'\" requires upgrade from version:',e.oldVersion);var t=e.target.result;n.bt.kt(t,i.transaction,e.oldVersion,n.version).next(function(){q(\"SimpleDb\",\"Database upgrade to version \"+n.version+\" complete\")})}});case 5:this.db=e.sent;case 6:return this.Mt&&(this.db.onversionchange=function(e){return n.Mt(e)}),e.abrupt(\"return\",this.db);case 8:case\"end\":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:\"Ot\",value:function(e){this.Mt=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:\"runTransaction\",value:function(){var e=p(regeneratorRuntime.mark(function e(t,n,r,i){var a,u,o,s,c=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=\"readonly\"===n,u=0;case 2:return++u,e.prev=3,e.delegateYield(regeneratorRuntime.mark(function e(){var n,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.Nt(t);case 2:return c.db=e.sent,n=Ii.open(c.db,t,a?\"readonly\":\"readwrite\",r),(u=i(n).next(function(e){return n.Pt(),e}).catch(function(e){return n.abort(e),xi.reject(e)}).toPromise()).catch(function(){}),e.next=7,n.Rt;case 7:return e.t0=u,e.abrupt(\"return\",{v:e.t0});case 9:case\"end\":return e.stop()}},e)})(),\"t0\",5);case 5:if(\"object\"!==d(o=e.t0)){e.next=8;break}return e.abrupt(\"return\",o.v);case 8:e.next=15;break;case 10:if(e.prev=10,e.t1=e.catch(3),s=\"FirebaseError\"!==e.t1.name&&u<3,q(\"SimpleDb\",\"Transaction failed with error:\",e.t1.message,\"Retrying:\",s),this.close(),s){e.next=15;break}return e.abrupt(\"return\",Promise.reject(e.t1));case 15:e.next=2;break;case 17:case\"end\":return e.stop()}},e,this,[[3,10]])}));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:\"close\",value:function(){this.db&&this.db.close(),this.db=void 0}}],[{key:\"delete\",value:function(e){return q(\"SimpleDb\",\"Removing database:\",e),Di(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:\"vt\",value:function(){if(!(0,i.isIndexedDBAvailable)())return!1;if(t.St())return!0;var e=(0,i.getUA)(),n=t.Vt(e),r=0<n&&n<10,a=t.Dt(e),u=0<a&&a<4.5;return!(e.indexOf(\"MSIE \")>0||e.indexOf(\"Trident/\")>0||e.indexOf(\"Edge/\")>0||r||u)}},{key:\"St\",value:function(){var t;return void 0!==e&&\"YES\"===(null===(t=e.env)||void 0===t?void 0:t.Ct)}},{key:\"xt\",value:function(e,t){return e.store(t)}},{key:\"Vt\",value:function(e){var t=e.match(/i(?:phone|pad|pod) os ([\\d_]+)/i),n=t?t[1].split(\"_\").slice(0,2).join(\".\"):\"-1\";return Number(n)}},{key:\"Dt\",value:function(e){var t=e.match(/Android ([\\d.]+)/i),n=t?t[1].split(\".\").slice(0,2).join(\".\"):\"-1\";return Number(n)}}]),t}(),Ti=function(){function e(t){N(this,e),this.Ft=t,this.$t=!1,this.Bt=null}return C(e,[{key:\"isDone\",get:function(){return this.$t}},{key:\"Lt\",get:function(){return this.Bt}},{key:\"cursor\",set:function(e){this.Ft=e}},{key:\"done\",value:function(){this.$t=!0}},{key:\"Ut\",value:function(e){this.Bt=e}},{key:\"delete\",value:function(){return Di(this.Ft.delete())}}]),e}(),Si=function(e){m(n,H);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this,W.UNAVAILABLE,\"IndexedDB transaction '\".concat(e,\"' failed: \").concat(r))).name=\"IndexedDbTransactionError\",i}return C(n)}();function _i(e){return\"IndexedDbTransactionError\"===e.name}var Ai=function(){function e(t){N(this,e),this.store=t}return C(e,[{key:\"put\",value:function(e,t){var n;return void 0!==t?(q(\"SimpleDb\",\"PUT\",this.store.name,e,t),n=this.store.put(t,e)):(q(\"SimpleDb\",\"PUT\",this.store.name,\"<auto-key>\",e),n=this.store.put(e)),Di(n)}},{key:\"add\",value:function(e){return q(\"SimpleDb\",\"ADD\",this.store.name,e,e),Di(this.store.add(e))}},{key:\"get\",value:function(e){var t=this;return Di(this.store.get(e)).next(function(n){return void 0===n&&(n=null),q(\"SimpleDb\",\"GET\",t.store.name,e,n),n})}},{key:\"delete\",value:function(e){return q(\"SimpleDb\",\"DELETE\",this.store.name,e),Di(this.store.delete(e))}},{key:\"count\",value:function(){return q(\"SimpleDb\",\"COUNT\",this.store.name),Di(this.store.count())}},{key:\"qt\",value:function(e,t){var n=this.options(e,t);if(n.index||\"function\"!=typeof this.store.getAll){var r=this.cursor(n),i=[];return this.Kt(r,function(e,t){i.push(t)}).next(function(){return i})}var a=this.store.getAll(n.range);return new xi(function(e,t){a.onerror=function(e){t(e.target.error)},a.onsuccess=function(t){e(t.target.result)}})}},{key:\"Gt\",value:function(e,t){var n=this.store.getAll(e,null===t?void 0:t);return new xi(function(e,t){n.onerror=function(e){t(e.target.error)},n.onsuccess=function(t){e(t.target.result)}})}},{key:\"Qt\",value:function(e,t){q(\"SimpleDb\",\"DELETE ALL\",this.store.name);var n=this.options(e,t);n.jt=!1;var r=this.cursor(n);return this.Kt(r,function(e,t,n){return n.delete()})}},{key:\"Wt\",value:function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.Kt(r,t)}},{key:\"zt\",value:function(e){var t=this.cursor({});return new xi(function(n,r){t.onerror=function(e){var t=Ri(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next(function(e){e?r.continue():n()}):n()}})}},{key:\"Kt\",value:function(e,t){var n=[];return new xi(function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(i){var a=new Ti(i),u=t(i.primaryKey,i.value,a);if(u instanceof xi){var o=u.catch(function(e){return a.done(),xi.reject(e)});n.push(o)}a.isDone?r():null===a.Lt?i.continue():i.continue(a.Lt)}else r()}}).next(function(){return xi.waitFor(n)})}},{key:\"options\",value:function(e,t){var n;return void 0!==e&&(\"string\"==typeof e?n=e:t=e),{index:n,range:t}}},{key:\"cursor\",value:function(e){var t=\"next\";if(e.reverse&&(t=\"prev\"),e.index){var n=this.store.index(e.index);return e.jt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]),e}();function Di(e){return new xi(function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=Ri(e.target.error);n(t)}})}var Ni=!1;function Ri(e){var t=Ei.Vt((0,i.getUA)());if(t>=12.2&&t<13){var n=\"An internal error was encountered in the Indexed Database server\";if(e.message.indexOf(n)>=0){var r=new H(\"internal\",\"IOS_INDEXEDDB_BUG1: IndexedDb has thrown '\".concat(n,\"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.\"));return Ni||(Ni=!0,setTimeout(function(){throw r},0)),r}}return e}var Ci=function(e){m(n,bi);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this)).Ht=e,i.currentSequenceNumber=r,i}return C(n)}();function Mi(e,t){var n=Q(e);return Ei.xt(n.Ht,t)}var Li=function(){function e(t,n,r,i){N(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return C(e,[{key:\"applyToRemoteDocument\",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&En(i,e,n[r])}}},{key:\"applyToLocalView\",value:function(e){var t,n=v(this.baseMutations);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.key.isEqual(e.key)&&Tn(r,e,this.localWriteTime)}}catch(o){n.e(o)}finally{n.f()}var i,a=v(this.mutations);try{for(a.s();!(i=a.n()).done;){var u=i.value;u.key.isEqual(e.key)&&Tn(u,e,this.localWriteTime)}}catch(o){a.e(o)}finally{a.f()}}},{key:\"applyToLocalDocumentSet\",value:function(e){var t=this;this.mutations.forEach(function(n){var r=e.get(n.key),i=r;t.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(he.min())})}},{key:\"keys\",value:function(){return this.mutations.reduce(function(e,t){return e.add(t.key)},tr())}},{key:\"isEqual\",value:function(e){return this.batchId===e.batchId&&ce(this.mutations,e.mutations,function(e,t){return _n(e,t)})&&ce(this.baseMutations,e.baseMutations,function(e,t){return _n(e,t)})}}]),e}(),Vi=function(){function e(t,n,r,i){N(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return C(e,null,[{key:\"from\",value:function(t,n,r){j(t.mutations.length===r.length);for(var i=Zn,a=t.mutations,u=0;u<a.length;u++)i=i.insert(a[u].key,r[u].version);return new e(t,n,r,i)}}]),e}(),Fi=function(){function e(t,n){N(this,e),this.largestBatchId=t,this.mutation=n}return C(e,[{key:\"getKey\",value:function(){return this.mutation.key}},{key:\"isEqual\",value:function(e){return null!==e&&this.mutation===e.mutation}},{key:\"toString\",value:function(){return\"Overlay{\\n      largestBatchId: \".concat(this.largestBatchId,\",\\n      mutation: \").concat(this.mutation.toString(),\"\\n    }\")}}]),e}(),Pi=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:he.min(),u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:he.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:xe.EMPTY_BYTE_STRING;N(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=o}return C(e,[{key:\"withSequenceNumber\",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}},{key:\"withResumeToken\",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)}},{key:\"withLastLimboFreeSnapshotVersion\",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}]),e}(),Oi=C(function e(t){N(this,e),this.Jt=t});function qi(e,t){var n;if(t.document)n=Dr(e.Jt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){var r=Ve.fromSegments(t.noDocument.path),i=Gi(t.noDocument.readTime);n=at.newNoDocument(r,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return G();var a=Ve.fromSegments(t.unknownDocument.path),u=Gi(t.unknownDocument.version);n=at.newUnknownDocument(a,u)}return t.readTime&&n.setReadTime(function(e){var t=new fe(e[0],e[1]);return he.fromTimestamp(t)}(t.readTime)),n}function Ui(e,t){var n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Bi(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:xr(e,t.key),fields:t.data.value.mapValue.fields,updateTime:pr(e,t.version.toTimestamp())}}(e.Jt,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Ki(t.version)};else{if(!t.isUnknownDocument())return G();r.unknownDocument={path:n.path.toArray(),version:Ki(t.version)}}return r}function Bi(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Ki(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Gi(e){var t=new fe(e.seconds,e.nanoseconds);return he.fromTimestamp(t)}function ji(e,t){for(var n=(t.baseMutations||[]).map(function(t){return Mr(e.Jt,t)}),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform){var a=t.mutations[r+1];i.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var u=t.mutations.map(function(t){return Mr(e.Jt,t)}),o=fe.fromMillis(t.localWriteTimeMs);return new Li(t.batchId,o,n,u)}function zi(e){var t,n,r=Gi(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?Gi(e.lastLimboFreeSnapshotVersion):he.min();return void 0!==e.query.documents?(j(1===(n=e.query).documents.length),t=Wt(Ut(Tr(n.documents[0])))):t=function(e){return Wt(Pr(e))}(e.query),new Pi(t,e.targetId,0,e.lastListenSequenceNumber,r,i,xe.fromBase64String(e.resumeToken))}function Qi(e,t){var n,r=Ki(t.snapshotVersion),i=Ki(t.lastLimboFreeSnapshotVersion);n=wt(t.target)?Vr(e.Jt,t.target):Fr(e.Jt,t.target);var a=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:mt(t.target),readTime:r,resumeToken:a,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function Wi(e){var t=Pr({parent:e.parent,structuredQuery:e.structuredQuery});return\"LAST\"===e.limitType?Ht(t,t.limit,\"L\"):t}function Hi(e,t){return new Fi(t.largestBatchId,Mr(e.Jt,t.overlayMutation))}function Yi(e,t){var n=t.path.lastSegment();return[e,Hr(t.path.popLast()),n]}var Xi=function(){function e(){N(this,e)}return C(e,[{key:\"getBundleMetadata\",value:function(e,t){return Ji(e).get(t).next(function(e){if(e)return{id:(t=e).bundleId,createTime:Gi(t.createTime),version:t.version};var t})}},{key:\"saveBundleMetadata\",value:function(e,t){return Ji(e).put({bundleId:(n=t).id,createTime:Ki(kr(n.createTime)),version:n.version});var n}},{key:\"getNamedQuery\",value:function(e,t){return $i(e).get(t).next(function(e){if(e)return{name:(t=e).name,query:Wi(t.bundledQuery),readTime:Gi(t.readTime)};var t})}},{key:\"saveNamedQuery\",value:function(e,t){return $i(e).put(function(e){return{name:e.name,readTime:Ki(kr(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}]),e}();function Ji(e){return Mi(e,\"bundles\")}function $i(e){return Mi(e,\"namedQueries\")}var Zi=function(){function e(t,n){N(this,e),this.M=t,this.userId=n}return C(e,[{key:\"getOverlay\",value:function(e,t){var n=this;return ea(e).get(Yi(this.userId,t)).next(function(e){return e?Hi(n.M,e):null})}},{key:\"saveOverlays\",value:function(e,t,n){var r=this,i=[];return n.forEach(function(n,a){var u=new Fi(t,a);i.push(r.Xt(e,u))}),xi.waitFor(i)}},{key:\"removeOverlaysForBatchId\",value:function(e,t,n){var r=this,i=new Set;t.forEach(function(e){return i.add(Hr(e.getCollectionPath()))});var a=[];return i.forEach(function(t){var i=IDBKeyRange.bound([r.userId,t,n],[r.userId,t,n+1],!1,!0);a.push(ea(e).Qt(\"collectionPathOverlayIndex\",i))}),xi.waitFor(a)}},{key:\"getOverlaysForCollection\",value:function(e,t,n){var r=this,i=$n(),a=Hr(t),u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,Number.POSITIVE_INFINITY],!0);return ea(e).qt(\"collectionPathOverlayIndex\",u).next(function(e){var t,n=v(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,u=Hi(r.M,a);i.set(u.getKey(),u)}}catch(o){n.e(o)}finally{n.f()}return i})}},{key:\"getOverlaysForCollectionGroup\",value:function(e,t,n,r){var i,a=this,u=$n(),o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ea(e).Wt({index:\"collectionGroupOverlayIndex\",range:o},function(e,t,n){var o=Hi(a.M,t);u.size()<r||o.largestBatchId===i?(u.set(o.getKey(),o),i=o.largestBatchId):n.done()}).next(function(){return u})}},{key:\"Xt\",value:function(e,t){return ea(e).put(function(e,t,n){var r=c(Yi(t,n.mutation.key),3);r[0];return{userId:t,collectionPath:r[1],documentId:r[2],collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Cr(e.Jt,n.mutation)}}(this.M,this.userId,t))}}],[{key:\"Yt\",value:function(t,n){return new e(t,n.uid||\"\")}}]),e}();function ea(e){return Mi(e,\"documentOverlays\")}var ta=function(){function e(){N(this,e)}return C(e,[{key:\"Zt\",value:function(e,t){this.te(e,t),t.ee()}},{key:\"te\",value:function(e,t){if(\"nullValue\"in e)this.ne(t,5);else if(\"booleanValue\"in e)this.ne(t,10),t.se(e.booleanValue?1:0);else if(\"integerValue\"in e)this.ne(t,15),t.se(Te(e.integerValue));else if(\"doubleValue\"in e){var n=Te(e.doubleValue);isNaN(n)?this.ne(t,13):(this.ne(t,15),Me(n)?t.se(0):t.se(n))}else if(\"timestampValue\"in e){var r=e.timestampValue;this.ne(t,20),\"string\"==typeof r?t.ie(r):(t.ie(\"\".concat(r.seconds||\"\")),t.se(r.nanos||0))}else if(\"stringValue\"in e)this.re(e.stringValue,t),this.oe(t);else if(\"bytesValue\"in e)this.ne(t,30),t.ue(Se(e.bytesValue)),this.oe(t);else if(\"referenceValue\"in e)this.ae(e.referenceValue,t);else if(\"geoPointValue\"in e){var i=e.geoPointValue;this.ne(t,45),t.se(i.latitude||0),t.se(i.longitude||0)}else\"mapValue\"in e?$e(e)?this.ne(t,Number.MAX_SAFE_INTEGER):(this.ce(e.mapValue,t),this.oe(t)):\"arrayValue\"in e?(this.he(e.arrayValue,t),this.oe(t)):G()}},{key:\"re\",value:function(e,t){this.ne(t,25),this.le(e,t)}},{key:\"le\",value:function(e,t){t.ie(e)}},{key:\"ce\",value:function(e,t){var n=e.fields||{};this.ne(t,55);for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];this.re(a,t),this.te(n[a],t)}}},{key:\"he\",value:function(e,t){var n=e.values||[];this.ne(t,50);var r,i=v(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.te(a,t)}}catch(u){i.e(u)}finally{i.f()}}},{key:\"ae\",value:function(e,t){var n=this;this.ne(t,37),Ve.fromName(e).path.forEach(function(e){n.ne(t,60),n.le(e,t)})}},{key:\"ne\",value:function(e,t){e.se(t)}},{key:\"oe\",value:function(e){e.se(2)}}]),e}();function na(e){if(0===e)return 8;var t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function ra(e){var t=64-function(e){for(var t=0,n=0;n<8;++n){var r=na(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}ta.fe=new ta;var ia=function(){function e(){N(this,e),this.buffer=new Uint8Array(1024),this.position=0}return C(e,[{key:\"de\",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this._e(n.value),n=t.next();this.we()}},{key:\"me\",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.ge(n.value),n=t.next();this.ye()}},{key:\"pe\",value:function(e){var t,n=v(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this._e(i);else if(i<2048)this._e(960|i>>>6),this._e(128|63&i);else if(r<\"\\ud800\"||\"\\udbff\"<r)this._e(480|i>>>12),this._e(128|63&i>>>6),this._e(128|63&i);else{var a=r.codePointAt(0);this._e(240|a>>>18),this._e(128|63&a>>>12),this._e(128|63&a>>>6),this._e(128|63&a)}}}catch(u){n.e(u)}finally{n.f()}this.we()}},{key:\"Ie\",value:function(e){var t,n=v(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this.ge(i);else if(i<2048)this.ge(960|i>>>6),this.ge(128|63&i);else if(r<\"\\ud800\"||\"\\udbff\"<r)this.ge(480|i>>>12),this.ge(128|63&i>>>6),this.ge(128|63&i);else{var a=r.codePointAt(0);this.ge(240|a>>>18),this.ge(128|63&a>>>12),this.ge(128|63&a>>>6),this.ge(128|63&a)}}}catch(u){n.e(u)}finally{n.f()}this.ye()}},{key:\"Te\",value:function(e){var t=this.Ee(e),n=ra(t);this.Ae(1+n),this.buffer[this.position++]=255&n;for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}},{key:\"Re\",value:function(e){var t=this.Ee(e),n=ra(t);this.Ae(1+n),this.buffer[this.position++]=~(255&n);for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}},{key:\"Pe\",value:function(){this.be(255),this.be(255)}},{key:\"Ve\",value:function(){this.ve(255),this.ve(255)}},{key:\"reset\",value:function(){this.position=0}},{key:\"seed\",value:function(e){this.Ae(e.length),this.buffer.set(e,this.position),this.position+=e.length}},{key:\"Se\",value:function(){return this.buffer.slice(0,this.position)}},{key:\"Ee\",value:function(e){var t=function(e){var t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(var r=1;r<t.length;++r)t[r]^=n?255:0;return t}},{key:\"_e\",value:function(e){var t=255&e;0===t?(this.be(0),this.be(255)):255===t?(this.be(255),this.be(0)):this.be(t)}},{key:\"ge\",value:function(e){var t=255&e;0===t?(this.ve(0),this.ve(255)):255===t?(this.ve(255),this.ve(0)):this.ve(e)}},{key:\"we\",value:function(){this.be(0),this.be(1)}},{key:\"ye\",value:function(){this.ve(0),this.ve(1)}},{key:\"be\",value:function(e){this.Ae(1),this.buffer[this.position++]=e}},{key:\"ve\",value:function(e){this.Ae(1),this.buffer[this.position++]=~e}},{key:\"Ae\",value:function(e){var t=e+this.position;if(!(t<=this.buffer.length)){var n=2*this.buffer.length;n<t&&(n=t);var r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}}]),e}(),aa=function(){function e(t){N(this,e),this.De=t}return C(e,[{key:\"ue\",value:function(e){this.De.de(e)}},{key:\"ie\",value:function(e){this.De.pe(e)}},{key:\"se\",value:function(e){this.De.Te(e)}},{key:\"ee\",value:function(){this.De.Pe()}}]),e}(),ua=function(){function e(t){N(this,e),this.De=t}return C(e,[{key:\"ue\",value:function(e){this.De.me(e)}},{key:\"ie\",value:function(e){this.De.Ie(e)}},{key:\"se\",value:function(e){this.De.Re(e)}},{key:\"ee\",value:function(){this.De.Ve()}}]),e}(),oa=function(){function e(){N(this,e),this.De=new ia,this.Ce=new aa(this.De),this.xe=new ua(this.De)}return C(e,[{key:\"seed\",value:function(e){this.De.seed(e)}},{key:\"Ne\",value:function(e){return 0===e?this.Ce:this.xe}},{key:\"Se\",value:function(){return this.De.Se()}},{key:\"reset\",value:function(){this.De.reset()}}]),e}(),sa=function(){function e(t,n,r,i){N(this,e),this.indexId=t,this.documentKey=n,this.arrayValue=r,this.directionalValue=i}return C(e,[{key:\"ke\",value:function(){var t=this.directionalValue.length,n=0===t||255===this.directionalValue[t-1]?t+1:t,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new e(this.indexId,this.documentKey,this.arrayValue,r)}}]),e}();function ca(e,t){var n=e.indexId-t.indexId;return 0!==n?n:0!==(n=la(e.arrayValue,t.arrayValue))?n:0!==(n=la(e.directionalValue,t.directionalValue))?n:Ve.comparator(e.documentKey,t.documentKey)}function la(e,t){for(var n=0;n<e.length&&n<t.length;++n){var r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}var fa=function(){function e(t){N(this,e),this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Me=t.orderBy,this.Oe=[];var n,r=v(t.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.S()?this.Fe=i:this.Oe.push(i)}}catch(a){r.e(a)}finally{r.f()}}return C(e,[{key:\"$e\",value:function(e){var t=ot(e);if(void 0!==t&&!this.Be(t))return!1;for(var n=st(e),r=0,i=0;r<n.length&&this.Be(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Fe){var a=n[r];if(!this.Le(this.Fe,a)||!this.Ue(this.Me[i++],a))return!1;++r}for(;r<n.length;++r){var u=n[r];if(i>=this.Me.length||!this.Ue(this.Me[i++],u))return!1}return!0}},{key:\"Be\",value:function(e){var t,n=v(this.Oe);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(this.Le(r,e))return!0}}catch(i){n.e(i)}finally{n.f()}return!1}},{key:\"Le\",value:function(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n=\"array-contains\"===e.op||\"array-contains-any\"===e.op;return 2===t.kind===n}},{key:\"Ue\",value:function(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&\"asc\"===e.dir||1===t.kind&&\"desc\"===e.dir)}}]),e}(),ha=function(){function e(){N(this,e),this.qe=new da}return C(e,[{key:\"addToCollectionParentIndex\",value:function(e,t){return this.qe.add(t),xi.resolve()}},{key:\"getCollectionParents\",value:function(e,t){return xi.resolve(this.qe.getEntries(t))}},{key:\"addFieldIndex\",value:function(e,t){return xi.resolve()}},{key:\"deleteFieldIndex\",value:function(e,t){return xi.resolve()}},{key:\"getDocumentsMatchingTarget\",value:function(e,t){return xi.resolve(null)}},{key:\"getFieldIndex\",value:function(e,t){return xi.resolve(null)}},{key:\"getFieldIndexes\",value:function(e,t){return xi.resolve([])}},{key:\"getNextCollectionGroupToUpdate\",value:function(e){return xi.resolve(null)}},{key:\"updateCollectionGroup\",value:function(e,t,n){return xi.resolve()}},{key:\"updateIndexEntries\",value:function(e,t){return xi.resolve()}}]),e}(),da=function(){function e(){N(this,e),this.index={}}return C(e,[{key:\"add\",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new zn(me.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:\"has\",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:\"getEntries\",value:function(e){return(this.index[e]||new zn(me.comparator)).toArray()}}]),e}(),va=new Uint8Array(0),ya=function(){function e(t,n){N(this,e),this.user=t,this.databaseId=n,this.Ke=new da,this.Ge=new Bn(function(e){return mt(e)},function(e,t){return kt(e,t)}),this.uid=t.uid||\"\"}return C(e,[{key:\"addToCollectionParentIndex\",value:function(e,t){var n=this;if(!this.Ke.has(t)){var r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(function(){n.Ke.add(t)});var a={collectionId:r,parent:Hr(i)};return pa(e).put(a)}return xi.resolve()}},{key:\"getCollectionParents\",value:function(e,t){var n=[],r=IDBKeyRange.bound([t,\"\"],[le(t),\"\"],!1,!0);return pa(e).qt(r).next(function(e){var r,i=v(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.collectionId!==t)break;n.push(Jr(a.parent))}}catch(u){i.e(u)}finally{i.f()}return n})}},{key:\"addFieldIndex\",value:function(e,t){var n=ga(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(function(e){return[e.fieldPath.canonicalString(),e.kind]})}}(t);return delete r.indexId,n.add(r).next()}},{key:\"deleteFieldIndex\",value:function(e,t){var n=ga(e),r=ka(e),i=ma(e);return n.delete(t.indexId).next(function(){return r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))}).next(function(){return i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))})}},{key:\"getDocumentsMatchingTarget\",value:function(e,t){var n=this,r=ma(e),i=!0,a=new Map;return xi.forEach(this.Qe(t),function(t){return n.getFieldIndex(e,t).next(function(e){i&&(i=!!e),a.set(t,e)})}).next(function(){if(i){var e=tr(),u=[];return xi.forEach(a,function(i,a){var o;q(\"IndexedDbIndexManager\",\"Using index \".concat((o=i,\"id=\".concat(o.indexId,\"|cg=\").concat(o.collectionGroup,\"|f=\").concat(o.fields.map(function(e){return\"\".concat(e.fieldPath,\":\").concat(e.kind)}).join(\",\"))),\" to execute \").concat(mt(t)));var s=function(e,t){var n=ot(i);if(void 0===n)return null;var r,a=v(bt(e,n.fieldPath));try{for(a.s();!(r=a.n()).done;){var u=r.value;switch(u.op){case\"array-contains-any\":return u.value.arrayValue.values||[];case\"array-contains\":return[u.value]}}}catch(o){a.e(o)}finally{a.f()}return null}(a),c=function(e,t){var n,r=new Map,i=v(st(t));try{for(i.s();!(n=i.n()).done;){var a,u=n.value,o=v(bt(e,u.fieldPath));try{for(o.s();!(a=o.n()).done;){var s=a.value;switch(s.op){case\"==\":case\"in\":r.set(u.fieldPath.canonicalString(),s.value);break;case\"not-in\":case\"!=\":return r.set(u.fieldPath.canonicalString(),s.value),Array.from(r.values())}}}catch(c){o.e(c)}finally{o.f()}}}catch(c){i.e(c)}finally{i.f()}return null}(a,i),l=function(e,t){var n,r=[],a=!0,u=v(st(i));try{for(u.s();!(n=u.n()).done;){var o=n.value,s=0===o.kind?xt(e,o.fieldPath,e.startAt):It(e,o.fieldPath,e.startAt);if(!s.value)return null;r.push(s.value),a&&(a=s.inclusive)}}catch(c){u.e(c)}finally{u.f()}return new Mt(r,a)}(a),f=function(e,t){var n,r=[],a=!0,u=v(st(i));try{for(u.s();!(n=u.n()).done;){var o=n.value,s=0===o.kind?It(e,o.fieldPath,e.endAt):xt(e,o.fieldPath,e.endAt);if(!s.value)return null;r.push(s.value),a&&(a=s.inclusive)}}catch(c){u.e(c)}finally{u.f()}return new Mt(r,a)}(a),h=n.je(i,a,l),d=n.je(i,a,f),y=n.We(i,a,c),p=n.ze(i.indexId,s,h,!!l&&l.inclusive,d,!!f&&f.inclusive,y);return xi.forEach(p,function(n){return r.Gt(n,t.limit).next(function(t){t.forEach(function(t){var n=Ve.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),u.push(n))})})})}).next(function(){return u})}return xi.resolve(null)})}},{key:\"Qe\",value:function(e){var t=this.Ge.get(e);return t||(t=[e],this.Ge.set(e,t),t)}},{key:\"ze\",value:function(e,t,n,r,i,a,u){for(var o=this,s=(null!=t?t.length:1)*Math.max(null!=n?n.length:1,null!=i?i.length:1),c=s/(null!=t?t.length:1),l=[],f=function(s){var f=t?o.He(t[s/c]):va,h=n?o.Je(e,f,n[s%c],r):o.Ye(e),d=i?o.Xe(e,f,i[s%c],a):o.Ye(e+1);l.push.apply(l,E(o.createRange(h,d,u.map(function(t){return o.Je(e,f,t,!0)}))))},h=0;h<s;++h)f(h);return l}},{key:\"Je\",value:function(e,t,n,r){var i=new sa(e,Ve.empty(),t,n);return r?i:i.ke()}},{key:\"Xe\",value:function(e,t,n,r){var i=new sa(e,Ve.empty(),t,n);return r?i.ke():i}},{key:\"Ye\",value:function(e){return new sa(e,Ve.empty(),va,va)}},{key:\"getFieldIndex\",value:function(e,t){var n=new fa(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(function(e){var t=e.filter(function(e){return n.$e(e)});return t.sort(function(e,t){return t.fields.length-e.fields.length}),t.length>0?t[0]:null})}},{key:\"Ze\",value:function(e,t){var n,r=new oa,i=v(st(e));try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.fieldPath);if(null==u)return null;var o=r.Ne(a.kind);ta.fe.Zt(u,o)}}catch(s){i.e(s)}finally{i.f()}return r.Se()}},{key:\"He\",value:function(e){var t=new oa;return ta.fe.Zt(e,t.Ne(0)),t.Se()}},{key:\"tn\",value:function(e,t){var n=new oa;return ta.fe.Zt(ze(this.databaseId,t),n.Ne(function(e){var t=st(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Se()}},{key:\"We\",value:function(e,t,n){if(null===n)return[];var r=[];r.push(new oa);var i,a=0,u=v(st(e));try{for(u.s();!(i=u.n()).done;){var o,s=i.value,c=n[a++],l=v(r);try{for(l.s();!(o=l.n()).done;){var f=o.value;if(this.en(t,s.fieldPath)&&We(c))r=this.nn(r,s,c);else{var h=f.Ne(s.kind);ta.fe.Zt(c,h)}}}catch(d){l.e(d)}finally{l.f()}}}catch(d){u.e(d)}finally{u.f()}return this.sn(r)}},{key:\"je\",value:function(e,t,n){return null==n?null:this.We(e,t,n.position)}},{key:\"sn\",value:function(e){for(var t=[],n=0;n<e.length;++n)t[n]=e[n].Se();return t}},{key:\"nn\",value:function(e,t,n){var r,i=E(e),a=[],u=v(n.arrayValue.values||[]);try{for(u.s();!(r=u.n()).done;){var o,s=r.value,c=v(i);try{for(c.s();!(o=c.n()).done;){var l=o.value,f=new oa;f.seed(l.Se()),ta.fe.Zt(s,f.Ne(t.kind)),a.push(f)}}catch(h){c.e(h)}finally{c.f()}}}catch(h){u.e(h)}finally{u.f()}return a}},{key:\"en\",value:function(e,t){return!!e.filters.find(function(e){return e instanceof Et&&e.field.isEqual(t)&&(\"in\"===e.op||\"not-in\"===e.op)})}},{key:\"getFieldIndexes\",value:function(e,t){var n=this,r=ga(e),i=ka(e);return(t?r.qt(\"collectionGroupIndex\",IDBKeyRange.bound(t,t)):r.qt()).next(function(e){var t=[];return xi.forEach(e,function(e){return i.get([e.indexId,n.uid]).next(function(n){t.push(function(e,t){var n=t?new lt(t.sequenceNumber,new dt(Gi(t.readTime),new Ve(Jr(t.documentKey)),t.largestBatchId)):lt.empty(),r=e.fields.map(function(e){var t=c(e,2),n=t[0],r=t[1];return new ct(ke.fromServerFormat(n),r)});return new ut(e.indexId,e.collectionGroup,r,n)}(e,n))})}).next(function(){return t})})}},{key:\"getNextCollectionGroupToUpdate\",value:function(e){return this.getFieldIndexes(e).next(function(e){return 0===e.length?null:(e.sort(function(e,t){var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:se(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup)})}},{key:\"updateCollectionGroup\",value:function(e,t,n){var r=this,i=ga(e),a=ka(e);return this.rn(e).next(function(e){return i.qt(\"collectionGroupIndex\",IDBKeyRange.bound(t,t)).next(function(t){return xi.forEach(t,function(t){return a.put(function(e,t,n,r){return{indexId:e,uid:t.uid||\"\",sequenceNumber:n,readTime:Ki(r.readTime),documentKey:Hr(r.documentKey.path),largestBatchId:r.largestBatchId}}(t.indexId,r.user,e,n))})})})}},{key:\"updateIndexEntries\",value:function(e,t){var n=this,r=new Map;return xi.forEach(t,function(t,i){var a=r.get(t.collectionGroup);return(a?xi.resolve(a):n.getFieldIndexes(e,t.collectionGroup)).next(function(a){return r.set(t.collectionGroup,a),xi.forEach(a,function(r){return n.on(e,t,r).next(function(t){var a=n.un(i,r);return t.isEqual(a)?xi.resolve():n.an(e,i,r,t,a)})})})})}},{key:\"cn\",value:function(e,t,n,r){return ma(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.tn(n,t.key),documentKey:t.key.path.toArray()})}},{key:\"hn\",value:function(e,t,n,r){return ma(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.tn(n,t.key),t.key.path.toArray()])}},{key:\"on\",value:function(e,t,n){var r=ma(e),i=new zn(ca);return r.Wt({index:\"documentKeyIndex\",range:IDBKeyRange.only([n.indexId,this.uid,this.tn(n,t)])},function(e,r){i=i.add(new sa(n.indexId,t,r.arrayValue,r.directionalValue))}).next(function(){return i})}},{key:\"un\",value:function(e,t){var n=new zn(ca),r=this.Ze(t,e);if(null==r)return n;var i=ot(t);if(null!=i){var a=e.data.field(i.fieldPath);if(We(a)){var u,o=v(a.arrayValue.values||[]);try{for(o.s();!(u=o.n()).done;){var s=u.value;n=n.add(new sa(t.indexId,e.key,this.He(s),r))}}catch(c){o.e(c)}finally{o.f()}}}else n=n.add(new sa(t.indexId,e.key,va,r));return n}},{key:\"an\",value:function(e,t,n,r,i){var a=this;q(\"IndexedDbIndexManager\",\"Updating index entries for document '%s'\",t.key);var u=[];return function(e,t,n,r,i){for(var a=e.getIterator(),u=t.getIterator(),o=Wn(a),s=Wn(u);o||s;){var c=!1,l=!1;if(o&&s){var f=n(o,s);f<0?l=!0:f>0&&(c=!0)}else null!=o?l=!0:c=!0;c?(r(s),s=Wn(u)):l?(i(o),o=Wn(a)):(o=Wn(a),s=Wn(u))}}(r,i,ca,function(r){u.push(a.cn(e,t,n,r))},function(r){u.push(a.hn(e,t,n,r))}),xi.waitFor(u)}},{key:\"rn\",value:function(e){var t=1;return ka(e).Wt({index:\"sequenceNumberIndex\",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},function(e,n,r){r.done(),t=n.sequenceNumber+1}).next(function(){return t})}},{key:\"createRange\",value:function(e,t,n){n=n.sort(function(e,t){return ca(e,t)}).filter(function(e,t,n){return!t||0!==ca(e,n[t-1])});var r=[];r.push(e);var i,a=v(n);try{for(a.s();!(i=a.n()).done;){var u=i.value,o=ca(u,e),s=ca(u,t);if(0===o)r[0]=e.ke();else if(o>0&&s<0)r.push(u),r.push(u.ke());else if(s>0)break}}catch(f){a.e(f)}finally{a.f()}r.push(t);for(var c=[],l=0;l<r.length;l+=2)c.push(IDBKeyRange.bound([r[l].indexId,this.uid,r[l].arrayValue,r[l].directionalValue,va,[]],[r[l+1].indexId,this.uid,r[l+1].arrayValue,r[l+1].directionalValue,va,[]]));return c}}]),e}();function pa(e){return Mi(e,\"collectionParents\")}function ma(e){return Mi(e,\"indexEntries\")}function ga(e){return Mi(e,\"indexConfiguration\")}function ka(e){return Mi(e,\"indexState\")}var wa={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ba=function(){function e(t,n,r){N(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return C(e,null,[{key:\"withCacheSize\",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();function xa(e,t,n){var r=e.store(\"mutations\"),i=e.store(\"documentMutations\"),a=[],u=IDBKeyRange.only(n.batchId),o=0,s=r.Wt({range:u},function(e,t,n){return o++,n.delete()});a.push(s.next(function(){j(1===o)}));var c,l=[],f=v(n.mutations);try{for(f.s();!(c=f.n()).done;){var h=c.value,d=ei(t,h.key.path,n.batchId);a.push(i.delete(d)),l.push(h.key)}}catch(y){f.e(y)}finally{f.f()}return xi.waitFor(a).next(function(){return l})}function Ia(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw G();t=e.noDocument}return JSON.stringify(t).length}ba.DEFAULT_COLLECTION_PERCENTILE=10,ba.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ba.DEFAULT=new ba(41943040,ba.DEFAULT_COLLECTION_PERCENTILE,ba.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ba.DISABLED=new ba(-1,0,0);var Ea=function(){function e(t,n,r,i){N(this,e),this.userId=t,this.M=n,this.indexManager=r,this.referenceDelegate=i,this.ln={}}return C(e,[{key:\"checkEmpty\",value:function(e){var t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Sa(e).Wt({index:\"userMutationsIndex\",range:n},function(e,n,r){t=!1,r.done()}).next(function(){return t})}},{key:\"addMutationBatch\",value:function(e,t,n,r){var i=this,a=_a(e),u=Sa(e);return u.add({}).next(function(o){j(\"number\"==typeof o);var s,c=new Li(o,t,n,r),l=function(e,t,n){var r=n.baseMutations.map(function(t){return Cr(e.Jt,t)}),i=n.mutations.map(function(t){return Cr(e.Jt,t)});return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(i.M,i.userId,c),f=[],h=new zn(function(e,t){return se(e.canonicalString(),t.canonicalString())}),d=v(r);try{for(d.s();!(s=d.n()).done;){var y=s.value,p=ei(i.userId,y.key.path,o);h=h.add(y.key.path.popLast()),f.push(u.put(l)),f.push(a.put(p,ti))}}catch(m){d.e(m)}finally{d.f()}return h.forEach(function(t){f.push(i.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(function(){i.ln[o]=c.keys()}),xi.waitFor(f).next(function(){return c})})}},{key:\"lookupMutationBatch\",value:function(e,t){var n=this;return Sa(e).get(t).next(function(e){return e?(j(e.userId===n.userId),ji(n.M,e)):null})}},{key:\"fn\",value:function(e,t){var n=this;return this.ln[t]?xi.resolve(this.ln[t]):this.lookupMutationBatch(e,t).next(function(e){if(e){var r=e.keys();return n.ln[t]=r,r}return null})}},{key:\"getNextMutationBatchAfterBatchId\",value:function(e,t){var n=this,r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),a=null;return Sa(e).Wt({index:\"userMutationsIndex\",range:i},function(e,t,i){t.userId===n.userId&&(j(t.batchId>=r),a=ji(n.M,t)),i.done()}).next(function(){return a})}},{key:\"getHighestUnacknowledgedBatchId\",value:function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Sa(e).Wt({index:\"userMutationsIndex\",range:t,reverse:!0},function(e,t,r){n=t.batchId,r.done()}).next(function(){return n})}},{key:\"getAllMutationBatches\",value:function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Sa(e).qt(\"userMutationsIndex\",n).next(function(e){return e.map(function(e){return ji(t.M,e)})})}},{key:\"getAllMutationBatchesAffectingDocumentKey\",value:function(e,t){var n=this,r=Zr(this.userId,t.path),i=IDBKeyRange.lowerBound(r),a=[];return _a(e).Wt({range:i},function(r,i,u){var o=c(r,3),s=o[0],l=o[1],f=o[2],h=Jr(l);if(s===n.userId&&t.path.isEqual(h))return Sa(e).get(f).next(function(e){if(!e)throw G();j(e.userId===n.userId),a.push(ji(n.M,e))});u.done()}).next(function(){return a})}},{key:\"getAllMutationBatchesAffectingDocumentKeys\",value:function(e,t){var n=this,r=new zn(se),i=[];return t.forEach(function(t){var a=Zr(n.userId,t.path),u=IDBKeyRange.lowerBound(a),o=_a(e).Wt({range:u},function(e,i,a){var u=c(e,3),o=u[0],s=u[1],l=u[2],f=Jr(s);o===n.userId&&t.path.isEqual(f)?r=r.add(l):a.done()});i.push(o)}),xi.waitFor(i).next(function(){return n.dn(e,r)})}},{key:\"getAllMutationBatchesAffectingQuery\",value:function(e,t){var n=this,r=t.path,i=r.length+1,a=Zr(this.userId,r),u=IDBKeyRange.lowerBound(a),o=new zn(se);return _a(e).Wt({range:u},function(e,t,a){var u=c(e,3),s=u[0],l=u[1],f=u[2],h=Jr(l);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(o=o.add(f)):a.done()}).next(function(){return n.dn(e,o)})}},{key:\"dn\",value:function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(Sa(e).get(t).next(function(e){if(null===e)throw G();j(e.userId===n.userId),r.push(ji(n.M,e))}))}),xi.waitFor(i).next(function(){return r})}},{key:\"removeMutationBatch\",value:function(e,t){var n=this;return xa(e.Ht,this.userId,t).next(function(r){return e.addOnCommittedListener(function(){n._n(t.batchId)}),xi.forEach(r,function(t){return n.referenceDelegate.markPotentiallyOrphaned(e,t)})})}},{key:\"_n\",value:function(e){delete this.ln[e]}},{key:\"performConsistencyCheck\",value:function(e){var t=this;return this.checkEmpty(e).next(function(n){if(!n)return xi.resolve();var r=IDBKeyRange.lowerBound([t.userId]),i=[];return _a(e).Wt({range:r},function(e,n,r){if(e[0]===t.userId){var a=Jr(e[1]);i.push(a)}else r.done()}).next(function(){j(0===i.length)})})}},{key:\"containsKey\",value:function(e,t){return Ta(e,this.userId,t)}},{key:\"wn\",value:function(e){var t=this;return Aa(e).get(this.userId).next(function(e){return e||{userId:t.userId,lastAcknowledgedBatchId:-1,lastStreamToken:\"\"}})}}],[{key:\"Yt\",value:function(t,n,r,i){return j(\"\"!==t.uid),new e(t.isAuthenticated()?t.uid:\"\",n,r,i)}}]),e}();function Ta(e,t,n){var r=Zr(t,n.path),i=r[1],a=IDBKeyRange.lowerBound(r),u=!1;return _a(e).Wt({range:a,jt:!0},function(e,n,r){var a=c(e,3),o=a[0],s=a[1];a[2];o===t&&s===i&&(u=!0),r.done()}).next(function(){return u})}function Sa(e){return Mi(e,\"mutations\")}function _a(e){return Mi(e,\"documentMutations\")}function Aa(e){return Mi(e,\"mutationQueues\")}var Da=function(){function e(t){N(this,e),this.mn=t}return C(e,[{key:\"next\",value:function(){return this.mn+=2,this.mn}}],[{key:\"gn\",value:function(){return new e(0)}},{key:\"yn\",value:function(){return new e(-1)}}]),e}(),Na=function(){function e(t,n){N(this,e),this.referenceDelegate=t,this.M=n}return C(e,[{key:\"allocateTargetId\",value:function(e){var t=this;return this.pn(e).next(function(n){var r=new Da(n.highestTargetId);return n.highestTargetId=r.next(),t.In(e,n).next(function(){return n.highestTargetId})})}},{key:\"getLastRemoteSnapshotVersion\",value:function(e){return this.pn(e).next(function(e){return he.fromTimestamp(new fe(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))})}},{key:\"getHighestSequenceNumber\",value:function(e){return this.pn(e).next(function(e){return e.highestListenSequenceNumber})}},{key:\"setTargetsMetadata\",value:function(e,t,n){var r=this;return this.pn(e).next(function(i){return i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),r.In(e,i)})}},{key:\"addTargetData\",value:function(e,t){var n=this;return this.Tn(e,t).next(function(){return n.pn(e).next(function(r){return r.targetCount+=1,n.En(t,r),n.In(e,r)})})}},{key:\"updateTargetData\",value:function(e,t){return this.Tn(e,t)}},{key:\"removeTargetData\",value:function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return Ra(e).delete(t.targetId)}).next(function(){return n.pn(e)}).next(function(t){return j(t.targetCount>0),t.targetCount-=1,n.In(e,t)})}},{key:\"removeTargets\",value:function(e,t,n){var r=this,i=0,a=[];return Ra(e).Wt(function(u,o){var s=zi(o);s.sequenceNumber<=t&&null===n.get(s.targetId)&&(i++,a.push(r.removeTargetData(e,s)))}).next(function(){return xi.waitFor(a)}).next(function(){return i})}},{key:\"forEachTarget\",value:function(e,t){return Ra(e).Wt(function(e,n){var r=zi(n);t(r)})}},{key:\"pn\",value:function(e){return Ca(e).get(\"targetGlobalKey\").next(function(e){return j(null!==e),e})}},{key:\"In\",value:function(e,t){return Ca(e).put(\"targetGlobalKey\",t)}},{key:\"Tn\",value:function(e,t){return Ra(e).put(Qi(this.M,t))}},{key:\"En\",value:function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}},{key:\"getTargetCount\",value:function(e){return this.pn(e).next(function(e){return e.targetCount})}},{key:\"getTargetData\",value:function(e,t){var n=mt(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Ra(e).Wt({range:r,index:\"queryTargetsIndex\"},function(e,n,r){var a=zi(n);kt(t,a.target)&&(i=a,r.done())}).next(function(){return i})}},{key:\"addMatchingKeys\",value:function(e,t,n){var r=this,i=[],a=Ma(e);return t.forEach(function(t){var u=Hr(t.path);i.push(a.put({targetId:n,path:u})),i.push(r.referenceDelegate.addReference(e,n,t))}),xi.waitFor(i)}},{key:\"removeMatchingKeys\",value:function(e,t,n){var r=this,i=Ma(e);return xi.forEach(t,function(t){var a=Hr(t.path);return xi.waitFor([i.delete([n,a]),r.referenceDelegate.removeReference(e,n,t)])})}},{key:\"removeMatchingKeysForTargetId\",value:function(e,t){var n=Ma(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}},{key:\"getMatchingKeysForTargetId\",value:function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Ma(e),i=tr();return r.Wt({range:n,jt:!0},function(e,t,n){var r=Jr(e[1]),a=new Ve(r);i=i.add(a)}).next(function(){return i})}},{key:\"containsKey\",value:function(e,t){var n=Hr(t.path),r=IDBKeyRange.bound([n],[le(n)],!1,!0),i=0;return Ma(e).Wt({index:\"documentTargetsIndex\",jt:!0,range:r},function(e,t,n){var r=c(e,2),a=r[0];r[1];0!==a&&(i++,n.done())}).next(function(){return i>0})}},{key:\"Et\",value:function(e,t){return Ra(e).get(t).next(function(e){return e?zi(e):null})}}]),e}();function Ra(e){return Mi(e,\"targets\")}function Ca(e){return Mi(e,\"targetGlobal\")}function Ma(e){return Mi(e,\"targetDocuments\")}function La(e){return Va.apply(this,arguments)}function Va(){return(Va=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===W.FAILED_PRECONDITION&&t.message===wi){e.next=2;break}throw t;case 2:q(\"LocalStore\",\"Unexpectedly lost primary lease\");case 3:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Fa(e,t){var n=c(e,2),r=n[0],i=n[1],a=c(t,2),u=a[0],o=a[1],s=se(r,u);return 0===s?se(i,o):s}var Pa=function(){function e(t){N(this,e),this.An=t,this.buffer=new zn(Fa),this.Rn=0}return C(e,[{key:\"Pn\",value:function(){return++this.Rn}},{key:\"bn\",value:function(e){var t=[e,this.Pn()];if(this.buffer.size<this.An)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();Fa(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}},{key:\"maxValue\",get:function(){return this.buffer.last()[0]}}]),e}(),Oa=function(){function e(t,n){N(this,e),this.garbageCollector=t,this.asyncQueue=n,this.Vn=!1,this.vn=null}return C(e,[{key:\"start\",value:function(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Sn(e)}},{key:\"stop\",value:function(){this.vn&&(this.vn.cancel(),this.vn=null)}},{key:\"started\",get:function(){return null!==this.vn}},{key:\"Sn\",value:function(e){var t=this,n=this.Vn?3e5:6e4;q(\"LruGarbageCollector\",\"Garbage collection scheduled in \".concat(n,\"ms\")),this.vn=this.asyncQueue.enqueueAfterDelay(\"lru_garbage_collection\",n,p(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t.vn=null,t.Vn=!0,n.prev=1,n.next=4,e.collectGarbage(t.garbageCollector);case 4:n.next=14;break;case 6:if(n.prev=6,n.t0=n.catch(1),!_i(n.t0)){n.next=12;break}q(\"LruGarbageCollector\",\"Ignoring IndexedDB error during garbage collection: \",n.t0),n.next=14;break;case 12:return n.next=14,La(n.t0);case 14:return n.next=16,t.Sn(e);case 16:case\"end\":return n.stop()}},n,null,[[1,6]])})))}}]),e}(),qa=function(){function e(t,n){N(this,e),this.Dn=t,this.params=n}return C(e,[{key:\"calculateTargetCount\",value:function(e,t){return this.Dn.Cn(e).next(function(e){return Math.floor(t/100*e)})}},{key:\"nthSequenceNumber\",value:function(e,t){var n=this;if(0===t)return xi.resolve(ae.A);var r=new Pa(t);return this.Dn.forEachTarget(e,function(e){return r.bn(e.sequenceNumber)}).next(function(){return n.Dn.xn(e,function(e){return r.bn(e)})}).next(function(){return r.maxValue})}},{key:\"removeTargets\",value:function(e,t,n){return this.Dn.removeTargets(e,t,n)}},{key:\"removeOrphanedDocuments\",value:function(e,t){return this.Dn.removeOrphanedDocuments(e,t)}},{key:\"collect\",value:function(e,t){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(q(\"LruGarbageCollector\",\"Garbage collection skipped; disabled\"),xi.resolve(wa)):this.getCacheSize(e).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(q(\"LruGarbageCollector\",\"Garbage collection skipped; Cache size \".concat(r,\" is lower than threshold \").concat(n.params.cacheSizeCollectionThreshold)),wa):n.Nn(e,t)})}},{key:\"getCacheSize\",value:function(e){return this.Dn.getCacheSize(e)}},{key:\"Nn\",value:function(e,t){var n,i,a,u,o,s,c,l=this,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return t>l.params.maximumSequenceNumbersToCollect?(q(\"LruGarbageCollector\",\"Capping sequence numbers to collect down to the maximum of \".concat(l.params.maximumSequenceNumbersToCollect,\" from \").concat(t)),i=l.params.maximumSequenceNumbersToCollect):i=t,u=Date.now(),l.nthSequenceNumber(e,i)}).next(function(r){return n=r,o=Date.now(),l.removeTargets(e,n,t)}).next(function(t){return a=t,s=Date.now(),l.removeOrphanedDocuments(e,n)}).next(function(e){return c=Date.now(),P()<=r.LogLevel.DEBUG&&q(\"LruGarbageCollector\",\"LRU Garbage Collection\\n\\tCounted targets in \".concat(u-f,\"ms\\n\\tDetermined least recently used \").concat(i,\" in \")+(o-u)+\"ms\\n\"+\"\\tRemoved \".concat(a,\" targets in \")+(s-o)+\"ms\\n\"+\"\\tRemoved \".concat(e,\" documents in \")+(c-s)+\"ms\\n\"+\"Total Duration: \".concat(c-f,\"ms\")),xi.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:a,documentsRemoved:e})})}}]),e}(),Ua=function(){function e(t,n){N(this,e),this.db=t,this.garbageCollector=function(e,t){return new qa(e,t)}(this,n)}return C(e,[{key:\"Cn\",value:function(e){var t=this.kn(e);return this.db.getTargetCache().getTargetCount(e).next(function(e){return t.next(function(t){return e+t})})}},{key:\"kn\",value:function(e){var t=0;return this.xn(e,function(e){t++}).next(function(){return t})}},{key:\"forEachTarget\",value:function(e,t){return this.db.getTargetCache().forEachTarget(e,t)}},{key:\"xn\",value:function(e,t){return this.Mn(e,function(e,n){return t(n)})}},{key:\"addReference\",value:function(e,t,n){return Ba(e,n)}},{key:\"removeReference\",value:function(e,t,n){return Ba(e,n)}},{key:\"removeTargets\",value:function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}},{key:\"markPotentiallyOrphaned\",value:function(e,t){return Ba(e,t)}},{key:\"On\",value:function(e,t){return function(e,t){var n=!1;return Aa(e).zt(function(r){return Ta(e,r,t).next(function(e){return e&&(n=!0),xi.resolve(!e)})}).next(function(){return n})}(e,t)}},{key:\"removeOrphanedDocuments\",value:function(e,t){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],a=0;return this.Mn(e,function(u,o){if(o<=t){var s=n.On(e,u).next(function(t){if(!t)return a++,r.getEntry(e,u).next(function(){return r.removeEntry(u,he.min()),Ma(e).delete([0,Hr(u.path)])})});i.push(s)}}).next(function(){return xi.waitFor(i)}).next(function(){return r.apply(e)}).next(function(){return a})}},{key:\"removeTarget\",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}},{key:\"updateLimboDocument\",value:function(e,t){return Ba(e,t)}},{key:\"Mn\",value:function(e,t){var n,r=Ma(e),i=ae.A;return r.Wt({index:\"documentTargetsIndex\"},function(e,r){var a=c(e,2),u=a[0],o=(a[1],r.path),s=r.sequenceNumber;0===u?(i!==ae.A&&t(new Ve(Jr(n)),i),i=s,n=o):i=ae.A}).next(function(){i!==ae.A&&t(new Ve(Jr(n)),i)})}},{key:\"getCacheSize\",value:function(e){return this.db.getRemoteDocumentCache().getSize(e)}}]),e}();function Ba(e,t){return Ma(e).put(function(e,t){return{targetId:0,path:Hr(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}var Ka=function(){function e(){N(this,e),this.changes=new Bn(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),this.changesApplied=!1}return C(e,[{key:\"addEntry\",value:function(e){this.assertNotApplied(),this.changes.set(e.key,e)}},{key:\"removeEntry\",value:function(e,t){this.assertNotApplied(),this.changes.set(e,at.newInvalidDocument(e).setReadTime(t))}},{key:\"getEntry\",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?xi.resolve(n):this.getFromCache(e,t)}},{key:\"getEntries\",value:function(e,t){return this.getAllFromCache(e,t)}},{key:\"apply\",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:\"assertNotApplied\",value:function(){}}]),e}(),Ga=function(){function e(t){N(this,e),this.M=t}return C(e,[{key:\"setIndexManager\",value:function(e){this.indexManager=e}},{key:\"addEntry\",value:function(e,t,n){return Qa(e).put(n)}},{key:\"removeEntry\",value:function(e,t,n){return Qa(e).delete(function(e,t){var n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Bi(t),n[n.length-1]]}(t,n))}},{key:\"updateMetadata\",value:function(e,t){var n=this;return this.getMetadata(e).next(function(r){return r.byteSize+=t,n.Fn(e,r)})}},{key:\"getEntry\",value:function(e,t){var n=this,r=at.newInvalidDocument(t);return Qa(e).Wt({index:\"documentKeyIndex\",range:IDBKeyRange.only(Wa(t))},function(e,i){r=n.$n(t,i)}).next(function(){return r})}},{key:\"Bn\",value:function(e,t){var n=this,r={size:0,document:at.newInvalidDocument(t)};return Qa(e).Wt({index:\"documentKeyIndex\",range:IDBKeyRange.only(Wa(t))},function(e,i){r={document:n.$n(t,i),size:Ia(i)}}).next(function(){return r})}},{key:\"getEntries\",value:function(e,t){var n=this,r=Yn();return this.Ln(e,t,function(e,t){var i=n.$n(e,t);r=r.insert(e,i)}).next(function(){return r})}},{key:\"Un\",value:function(e,t){var n=this,r=Yn(),i=new Kn(Ve.comparator);return this.Ln(e,t,function(e,t){var a=n.$n(e,t);r=r.insert(e,a),i=i.insert(e,Ia(t))}).next(function(){return{documents:r,qn:i}})}},{key:\"Ln\",value:function(e,t,n){if(t.isEmpty())return xi.resolve();var r=new zn(Ya);t.forEach(function(e){return r=r.add(e)});var i=IDBKeyRange.bound(Wa(r.first()),Wa(r.last())),a=r.getIterator(),u=a.getNext();return Qa(e).Wt({index:\"documentKeyIndex\",range:i},function(e,t,r){for(var i=Ve.fromSegments([].concat(E(t.prefixPath),[t.collectionGroup,t.documentId]));u&&Ya(u,i)<0;)n(u,null),u=a.getNext();u&&u.isEqual(i)&&(n(u,t),u=a.hasNext()?a.getNext():null),u?r.Ut(Wa(u)):r.done()}).next(function(){for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}},{key:\"getAllFromCollection\",value:function(e,t,n){var r=this,i=[t.popLast().toArray(),t.lastSegment(),Bi(n.readTime),n.documentKey.path.isEmpty()?\"\":n.documentKey.path.lastSegment()],a=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],\"\"];return Qa(e).qt(IDBKeyRange.bound(i,a,!0)).next(function(e){var t,n=Yn(),i=v(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,u=r.$n(Ve.fromSegments(a.prefixPath.concat(a.collectionGroup,a.documentId)),a);n=n.insert(u.key,u)}}catch(o){i.e(o)}finally{i.f()}return n})}},{key:\"getAllFromCollectionGroup\",value:function(e,t,n,r){var i=this,a=Yn(),u=Ha(t,n),o=Ha(t,dt.max());return Qa(e).Wt({index:\"collectionGroupIndex\",range:IDBKeyRange.bound(u,o,!0)},function(e,t,n){var u=i.$n(Ve.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(a=a.insert(u.key,u)).size===r&&n.done()}).next(function(){return a})}},{key:\"newChangeBuffer\",value:function(e){return new ja(this,!!e&&e.trackRemovals)}},{key:\"getSize\",value:function(e){return this.getMetadata(e).next(function(e){return e.byteSize})}},{key:\"getMetadata\",value:function(e){return za(e).get(\"remoteDocumentGlobalKey\").next(function(e){return j(!!e),e})}},{key:\"Fn\",value:function(e,t){return za(e).put(\"remoteDocumentGlobalKey\",t)}},{key:\"$n\",value:function(e,t){if(t){var n=qi(this.M,t);if(!n.isNoDocument()||!n.version.isEqual(he.min()))return n}return at.newInvalidDocument(e)}}]),e}(),ja=function(e){m(n,Ka);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this)).Kn=e,i.trackRemovals=r,i.Gn=new Bn(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),i}return C(n,[{key:\"applyChanges\",value:function(e){var t=this,n=[],r=0,i=new zn(function(e,t){return se(e.canonicalString(),t.canonicalString())});return this.changes.forEach(function(a,u){var o=t.Gn.get(a);if(n.push(t.Kn.removeEntry(e,a,o.readTime)),u.isValidDocument()){var s=Ui(t.Kn.M,u);i=i.add(a.path.popLast());var c=Ia(s);r+=c-o.size,n.push(t.Kn.addEntry(e,a,s))}else if(r-=o.size,t.trackRemovals){var l=Ui(t.Kn.M,u.convertToNoDocument(he.min()));n.push(t.Kn.addEntry(e,a,l))}}),i.forEach(function(r){n.push(t.Kn.indexManager.addToCollectionParentIndex(e,r))}),n.push(this.Kn.updateMetadata(e,r)),xi.waitFor(n)}},{key:\"getFromCache\",value:function(e,t){var n=this;return this.Kn.Bn(e,t).next(function(e){return n.Gn.set(t,{size:e.size,readTime:e.document.readTime}),e.document})}},{key:\"getAllFromCache\",value:function(e,t){var n=this;return this.Kn.Un(e,t).next(function(e){var t=e.documents;return e.qn.forEach(function(e,r){n.Gn.set(e,{size:r,readTime:t.get(e).readTime})}),t})}}]),n}();function za(e){return Mi(e,\"remoteDocumentGlobal\")}function Qa(e){return Mi(e,\"remoteDocumentsV14\")}function Wa(e){var t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Ha(e,t){var n=t.documentKey.path.toArray();return[e,Bi(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:\"\"]}function Ya(e,t){for(var n=e.path.toArray(),r=t.path.toArray(),i=0,a=0;a<n.length-2&&a<r.length-2;++a)if(i=se(n[a],r[a]))return i;return(i=se(n.length,r.length))||((i=se(n[n.length-2],r[r.length-2]))||se(n[n.length-1],r[r.length-1]))}var Xa=function(){function e(t){N(this,e),this.M=t}return C(e,[{key:\"kt\",value:function(e,t,n,r){var i=this,a=new Ii(\"createOrUpgrade\",t);n<1&&r>=1&&(function(e){e.createObjectStore(\"owner\")}(e),function(e){e.createObjectStore(\"mutationQueues\",{keyPath:\"userId\"}),e.createObjectStore(\"mutations\",{keyPath:\"batchId\",autoIncrement:!0}).createIndex(\"userMutationsIndex\",$r,{unique:!0}),e.createObjectStore(\"documentMutations\")}(e),Ja(e),function(e){e.createObjectStore(\"remoteDocuments\")}(e));var u=xi.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(\"targetDocuments\"),e.deleteObjectStore(\"targets\"),e.deleteObjectStore(\"targetGlobal\")}(e),Ja(e)),u=u.next(function(){return e=a.store(\"targetGlobal\"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:he.min().toTimestamp(),targetCount:0},e.put(\"targetGlobalKey\",t);var e,t})),n<4&&r>=4&&(0!==n&&(u=u.next(function(){return function(e,t){return t.store(\"mutations\").qt().next(function(n){e.deleteObjectStore(\"mutations\"),e.createObjectStore(\"mutations\",{keyPath:\"batchId\",autoIncrement:!0}).createIndex(\"userMutationsIndex\",$r,{unique:!0});var r=t.store(\"mutations\"),i=n.map(function(e){return r.put(e)});return xi.waitFor(i)})}(e,a)})),u=u.next(function(){!function(e){e.createObjectStore(\"clientMetadata\",{keyPath:\"clientId\"})}(e)})),n<5&&r>=5&&(u=u.next(function(){return i.Qn(a)})),n<6&&r>=6&&(u=u.next(function(){return function(e){e.createObjectStore(\"remoteDocumentGlobal\")}(e),i.jn(a)})),n<7&&r>=7&&(u=u.next(function(){return i.Wn(a)})),n<8&&r>=8&&(u=u.next(function(){return i.zn(e,a)})),n<9&&r>=9&&(u=u.next(function(){!function(e){e.objectStoreNames.contains(\"remoteDocumentChanges\")&&e.deleteObjectStore(\"remoteDocumentChanges\")}(e)})),n<10&&r>=10&&(u=u.next(function(){return i.Hn(a)})),n<11&&r>=11&&(u=u.next(function(){!function(e){e.createObjectStore(\"bundles\",{keyPath:\"bundleId\"})}(e),function(e){e.createObjectStore(\"namedQueries\",{keyPath:\"name\"})}(e)})),n<12&&r>=12&&(u=u.next(function(){!function(e){var t=e.createObjectStore(\"documentOverlays\",{keyPath:di});t.createIndex(\"collectionPathOverlayIndex\",vi,{unique:!1}),t.createIndex(\"collectionGroupOverlayIndex\",yi,{unique:!1})}(e)})),n<13&&r>=13&&(u=u.next(function(){return function(e){var t=e.createObjectStore(\"remoteDocumentsV14\",{keyPath:ni});t.createIndex(\"documentKeyIndex\",ri),t.createIndex(\"collectionGroupIndex\",ii)}(e)}).next(function(){return i.Jn(e,a)}).next(function(){return e.deleteObjectStore(\"remoteDocuments\")})),n<14&&r>=14&&(u=u.next(function(){!function(e){e.createObjectStore(\"indexConfiguration\",{keyPath:\"indexId\",autoIncrement:!0}).createIndex(\"collectionGroupIndex\",\"collectionGroup\",{unique:!1}),e.createObjectStore(\"indexState\",{keyPath:ci}).createIndex(\"sequenceNumberIndex\",li,{unique:!1}),e.createObjectStore(\"indexEntries\",{keyPath:fi}).createIndex(\"documentKeyIndex\",hi,{unique:!1})}(e)})),u}},{key:\"jn\",value:function(e){var t=0;return e.store(\"remoteDocuments\").Wt(function(e,n){t+=Ia(n)}).next(function(){var n={byteSize:t};return e.store(\"remoteDocumentGlobal\").put(\"remoteDocumentGlobalKey\",n)})}},{key:\"Qn\",value:function(e){var t=this,n=e.store(\"mutationQueues\"),r=e.store(\"mutations\");return n.qt().next(function(n){return xi.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.qt(\"userMutationsIndex\",i).next(function(r){return xi.forEach(r,function(r){j(r.userId===n.userId);var i=ji(t.M,r);return xa(e,n.userId,i).next(function(){})})})})})}},{key:\"Wn\",value:function(e){var t=e.store(\"targetDocuments\"),n=e.store(\"remoteDocuments\");return e.store(\"targetGlobal\").get(\"targetGlobalKey\").next(function(e){var r=[];return n.Wt(function(n,i){var a=new me(n),u=[0,Hr(a)];r.push(t.get(u).next(function(n){return n?xi.resolve():function(n){return t.put({targetId:0,path:Hr(n),sequenceNumber:e.highestListenSequenceNumber})}(a)}))}).next(function(){return xi.waitFor(r)})})}},{key:\"zn\",value:function(e,t){e.createObjectStore(\"collectionParents\",{keyPath:si});var n=t.store(\"collectionParents\"),r=new da,i=function(e){if(r.add(e)){var t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:Hr(i)})}};return t.store(\"remoteDocuments\").Wt({jt:!0},function(e,t){var n=new me(e);return i(n.popLast())}).next(function(){return t.store(\"documentMutations\").Wt({jt:!0},function(e,t){var n=c(e,3),r=(n[0],n[1]),a=(n[2],Jr(r));return i(a.popLast())})})}},{key:\"Hn\",value:function(e){var t=this,n=e.store(\"targets\");return n.Wt(function(e,r){var i=zi(r),a=Qi(t.M,i);return n.put(a)})}},{key:\"Jn\",value:function(e,t){var n=t.store(\"remoteDocuments\"),r=[];return n.Wt(function(e,n){var i,a=t.store(\"remoteDocumentsV14\"),u=(i=n,i.document?new Ve(me.fromString(i.document.name).popFirst(5)):i.noDocument?Ve.fromSegments(i.noDocument.path):i.unknownDocument?Ve.fromSegments(i.unknownDocument.path):G()).path.toArray(),o={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(a.put(o))}).next(function(){return xi.waitFor(r)})}}]),e}();function Ja(e){e.createObjectStore(\"targetDocuments\",{keyPath:ui}).createIndex(\"documentTargetsIndex\",oi,{unique:!0}),e.createObjectStore(\"targets\",{keyPath:\"targetId\"}).createIndex(\"queryTargetsIndex\",ai,{unique:!0}),e.createObjectStore(\"targetGlobal\")}var $a=\"Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.\",Za=function(){function e(t,n,r,i,a,u,o,s,c,l){var f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:13;if(N(this,e),this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Yn=a,this.window=u,this.document=o,this.Xn=c,this.Zn=l,this.ts=f,this.es=null,this.ns=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ss=null,this.inForeground=!1,this.rs=null,this.os=null,this.us=Number.NEGATIVE_INFINITY,this.cs=function(e){return Promise.resolve()},!e.vt())throw new H(W.UNIMPLEMENTED,\"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.\");this.referenceDelegate=new Ua(this,i),this.hs=n+\"main\",this.M=new Oi(s),this.ls=new Ei(this.hs,this.ts,new Xa(this.M)),this.fs=new Na(this.referenceDelegate,this.M),this.ds=function(e){return new Ga(e)}(this.M),this._s=new Xi,this.window&&this.window.localStorage?this.ws=this.window.localStorage:(this.ws=null,!1===l&&U(\"IndexedDbPersistence\",\"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page.\"))}return C(e,[{key:\"start\",value:function(){var e=this;return this.gs().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new H(W.FAILED_PRECONDITION,$a);return e.ys(),e.ps(),e.Is(),e.runTransaction(\"getHighestListenSequenceNumber\",\"readonly\",function(t){return e.fs.getHighestSequenceNumber(t)})}).then(function(t){e.es=new ae(t,e.Xn)}).then(function(){e.ns=!0}).catch(function(t){return e.ls&&e.ls.close(),Promise.reject(t)})}},{key:\"Ts\",value:function(e){var t=this;return this.cs=function(){var n=p(regeneratorRuntime.mark(function n(r){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.started){n.next=2;break}return n.abrupt(\"return\",e(r));case 2:case\"end\":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}(),e(this.isPrimary)}},{key:\"setDatabaseDeletedListener\",value:function(e){this.ls.Ot(function(){var t=p(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=null===n.newVersion,!t.t0){t.next=4;break}return t.next=4,e();case 4:case\"end\":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:\"setNetworkEnabled\",value:function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Yn.enqueueAndForget(p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.started,!e.t0){e.next=4;break}return e.next=4,t.gs();case 4:case\"end\":return e.stop()}},e)}))))}},{key:\"gs\",value:function(){var e=this;return this.runTransaction(\"updateClientMetadataAndTryBecomePrimary\",\"readwrite\",function(t){return tu(t).put({clientId:e.clientId,updateTimeMs:Date.now(),networkEnabled:e.networkEnabled,inForeground:e.inForeground}).next(function(){if(e.isPrimary)return e.Es(t).next(function(t){t||(e.isPrimary=!1,e.Yn.enqueueRetryable(function(){return e.cs(!1)}))})}).next(function(){return e.As(t)}).next(function(n){return e.isPrimary&&!n?e.Rs(t).next(function(){return!1}):!!n&&e.Ps(t).next(function(){return!0})})}).catch(function(t){if(_i(t))return q(\"IndexedDbPersistence\",\"Failed to extend owner lease: \",t),e.isPrimary;if(!e.allowTabSynchronization)throw t;return q(\"IndexedDbPersistence\",\"Releasing owner lease after error during lease refresh\",t),!1}).then(function(t){e.isPrimary!==t&&e.Yn.enqueueRetryable(function(){return e.cs(t)}),e.isPrimary=t})}},{key:\"Es\",value:function(e){var t=this;return eu(e).get(\"owner\").next(function(e){return xi.resolve(t.bs(e))})}},{key:\"Vs\",value:function(e){return tu(e).delete(this.clientId)}},{key:\"vs\",value:function(){var e=p(regeneratorRuntime.mark(function e(){var t,n,r,i,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrimary||this.Ss(this.us,18e5)){e.next=6;break}return this.us=Date.now(),e.next=4,this.runTransaction(\"maybeGarbageCollectMultiClientState\",\"readwrite-primary\",function(e){var t=Mi(e,\"clientMetadata\");return t.qt().next(function(e){var n=a.Ds(e,18e5),r=e.filter(function(e){return-1===n.indexOf(e)});return xi.forEach(r,function(e){return t.delete(e.clientId)}).next(function(){return r})})}).catch(function(){return[]});case 4:if(t=e.sent,this.ws){n=v(t);try{for(n.s();!(r=n.n()).done;)i=r.value,this.ws.removeItem(this.Cs(i.clientId))}catch(u){n.e(u)}finally{n.f()}}case 6:case\"end\":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:\"Is\",value:function(){var e=this;this.os=this.Yn.enqueueAfterDelay(\"client_metadata_refresh\",4e3,function(){return e.gs().then(function(){return e.vs()}).then(function(){return e.Is()})})}},{key:\"bs\",value:function(e){return!!e&&e.ownerId===this.clientId}},{key:\"As\",value:function(e){var t=this;return this.Zn?xi.resolve(!0):eu(e).get(\"owner\").next(function(n){if(null!==n&&t.Ss(n.leaseTimestampMs,5e3)&&!t.xs(n.ownerId)){if(t.bs(n)&&t.networkEnabled)return!0;if(!t.bs(n)){if(!n.allowTabSynchronization)throw new H(W.FAILED_PRECONDITION,$a);return!1}}return!(!t.networkEnabled||!t.inForeground)||tu(e).qt().next(function(e){return void 0===t.Ds(e,5e3).find(function(e){if(t.clientId!==e.clientId){var n=!t.networkEnabled&&e.networkEnabled,r=!t.inForeground&&e.inForeground,i=t.networkEnabled===e.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(e){return t.isPrimary!==e&&q(\"IndexedDbPersistence\",\"Client \".concat(e?\"is\":\"is not\",\" eligible for a primary lease.\")),e})}},{key:\"shutdown\",value:function(){var e=p(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ns=!1,this.Ns(),this.os&&(this.os.cancel(),this.os=null),this.ks(),this.Ms(),e.next=7,this.ls.runTransaction(\"shutdown\",\"readwrite\",[\"owner\",\"clientMetadata\"],function(e){var n=new Ci(e,ae.A);return t.Rs(n).next(function(){return t.Vs(n)})});case 7:this.ls.close(),this.Os();case 9:case\"end\":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:\"Ds\",value:function(e,t){var n=this;return e.filter(function(e){return n.Ss(e.updateTimeMs,t)&&!n.xs(e.clientId)})}},{key:\"Fs\",value:function(){var e=this;return this.runTransaction(\"getActiveClients\",\"readonly\",function(t){return tu(t).qt().next(function(t){return e.Ds(t,18e5).map(function(e){return e.clientId})})})}},{key:\"started\",get:function(){return this.ns}},{key:\"getMutationQueue\",value:function(e,t){return Ea.Yt(e,this.M,t,this.referenceDelegate)}},{key:\"getTargetCache\",value:function(){return this.fs}},{key:\"getRemoteDocumentCache\",value:function(){return this.ds}},{key:\"getIndexManager\",value:function(e){return new ya(e,this.M.Jt.databaseId)}},{key:\"getDocumentOverlayCache\",value:function(e){return Zi.Yt(this.M,e)}},{key:\"getBundleCache\",value:function(){return this._s}},{key:\"runTransaction\",value:function(e,t,n){var r=this;q(\"IndexedDbPersistence\",\"Starting transaction:\",e);var i,a,u=\"readonly\"===t?\"readonly\":\"readwrite\",o=14===(i=this.ts)?ki:13===i?gi:12===i?mi:11===i?pi:void G();return this.ls.runTransaction(e,u,o,function(i){return a=new Ci(i,r.es?r.es.next():ae.A),\"readwrite-primary\"===t?r.Es(a).next(function(e){return!!e||r.As(a)}).next(function(t){if(!t)throw U(\"Failed to obtain primary lease for action '\".concat(e,\"'.\")),r.isPrimary=!1,r.Yn.enqueueRetryable(function(){return r.cs(!1)}),new H(W.FAILED_PRECONDITION,wi);return n(a)}).next(function(e){return r.Ps(a).next(function(){return e})}):r.$s(a).next(function(){return n(a)})}).then(function(e){return a.raiseOnCommittedEvent(),e})}},{key:\"$s\",value:function(e){var t=this;return eu(e).get(\"owner\").next(function(e){if(null!==e&&t.Ss(e.leaseTimestampMs,5e3)&&!t.xs(e.ownerId)&&!t.bs(e)&&!(t.Zn||t.allowTabSynchronization&&e.allowTabSynchronization))throw new H(W.FAILED_PRECONDITION,$a)})}},{key:\"Ps\",value:function(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return eu(e).put(\"owner\",t)}},{key:\"Rs\",value:function(e){var t=this,n=eu(e);return n.get(\"owner\").next(function(e){return t.bs(e)?(q(\"IndexedDbPersistence\",\"Releasing primary lease.\"),n.delete(\"owner\")):xi.resolve()})}},{key:\"Ss\",value:function(e,t){var n=Date.now();return!(e<n-t||e>n&&(U(\"Detected an update time that is in the future: \".concat(e,\" > \").concat(n)),1))}},{key:\"ys\",value:function(){var e=this;null!==this.document&&\"function\"==typeof this.document.addEventListener&&(this.rs=function(){e.Yn.enqueueAndForget(function(){return e.inForeground=\"visible\"===e.document.visibilityState,e.gs()})},this.document.addEventListener(\"visibilitychange\",this.rs),this.inForeground=\"visible\"===this.document.visibilityState)}},{key:\"ks\",value:function(){this.rs&&(this.document.removeEventListener(\"visibilitychange\",this.rs),this.rs=null)}},{key:\"ps\",value:function(){var e,t=this;\"function\"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ss=function(){t.Ns(),(0,i.isSafari)()&&navigator.appVersion.match(/Version\\/1[45]/)&&t.Yn.enterRestrictedMode(!0),t.Yn.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener(\"pagehide\",this.ss))}},{key:\"Ms\",value:function(){this.ss&&(this.window.removeEventListener(\"pagehide\",this.ss),this.ss=null)}},{key:\"xs\",value:function(e){var t;try{var n=null!==(null===(t=this.ws)||void 0===t?void 0:t.getItem(this.Cs(e)));return q(\"IndexedDbPersistence\",\"Client '\".concat(e,\"' \").concat(n?\"is\":\"is not\",\" zombied in LocalStorage\")),n}catch(e){return U(\"IndexedDbPersistence\",\"Failed to get zombied client id.\",e),!1}}},{key:\"Ns\",value:function(){if(this.ws)try{this.ws.setItem(this.Cs(this.clientId),String(Date.now()))}catch(e){U(\"Failed to set zombie client id.\",e)}}},{key:\"Os\",value:function(){if(this.ws)try{this.ws.removeItem(this.Cs(this.clientId))}catch(e){}}},{key:\"Cs\",value:function(e){return\"firestore_zombie_\".concat(this.persistenceKey,\"_\").concat(e)}}],[{key:\"vt\",value:function(){return Ei.vt()}}]),e}();function eu(e){return Mi(e,\"owner\")}function tu(e){return Mi(e,\"clientMetadata\")}function nu(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+=\".\"+e.database),\"firestore/\"+t+\"/\"+n+\"/\"}var ru=function(){function e(t,n,r){N(this,e),this.ds=t,this.Bs=n,this.indexManager=r}return C(e,[{key:\"Ls\",value:function(e,t){var n=this;return this.Bs.getAllMutationBatchesAffectingDocumentKey(e,t).next(function(r){return n.Us(e,t,r)})}},{key:\"Us\",value:function(e,t,n){return this.ds.getEntry(e,t).next(function(e){var t,r=v(n);try{for(r.s();!(t=r.n()).done;){t.value.applyToLocalView(e)}}catch(i){r.e(i)}finally{r.f()}return e})}},{key:\"qs\",value:function(e,t){e.forEach(function(e,n){var r,i=v(t);try{for(i.s();!(r=i.n()).done;){r.value.applyToLocalView(n)}}catch(a){i.e(a)}finally{i.f()}})}},{key:\"Ks\",value:function(e,t){var n=this;return this.ds.getEntries(e,t).next(function(t){return n.Gs(e,t).next(function(){return t})})}},{key:\"Gs\",value:function(e,t){var n=this;return this.Bs.getAllMutationBatchesAffectingDocumentKeys(e,t).next(function(e){return n.qs(t,e)})}},{key:\"Qs\",value:function(e,t,n){return function(e){return Ve.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.js(e,t.path):zt(t)?this.Ws(e,t,n):this.zs(e,t,n)}},{key:\"js\",value:function(e,t){return this.Ls(e,new Ve(t)).next(function(e){var t=Jn();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}},{key:\"Ws\",value:function(e,t,n){var r=this,i=t.collectionGroup,a=Jn();return this.indexManager.getCollectionParents(e,i).next(function(u){return xi.forEach(u,function(u){var o=function(e,t){return new Ot(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,u.child(i));return r.zs(e,o,n).next(function(e){e.forEach(function(e,t){a=a.insert(e,t)})})}).next(function(){return a})})}},{key:\"zs\",value:function(e,t,n){var r,i=this;return this.ds.getAllFromCollection(e,t.path,n).next(function(n){return r=n,i.Bs.getAllMutationBatchesAffectingQuery(e,t)}).next(function(e){var t,n=v(e);try{for(n.s();!(t=n.n()).done;){var i,a=t.value,u=v(a.mutations);try{for(u.s();!(i=u.n()).done;){var o=i.value,s=o.key,c=r.get(s);null==c&&(c=at.newInvalidDocument(s),r=r.insert(s,c)),Tn(o,c,a.localWriteTime),c.isFoundDocument()||(r=r.remove(s))}}catch(l){u.e(l)}finally{u.f()}}}catch(l){n.e(l)}finally{n.f()}}).next(function(){return r.forEach(function(e,n){$t(t,n)||(r=r.remove(e))}),r})}}]),e}(),iu=function(){function e(t,n,r,i){N(this,e),this.targetId=t,this.fromCache=n,this.Hs=r,this.Js=i}return C(e,null,[{key:\"Ys\",value:function(t,n){var r,i=tr(),a=tr(),u=v(n.docChanges);try{for(u.s();!(r=u.n()).done;){var o=r.value;switch(o.type){case 0:i=i.add(o.doc.key);break;case 1:a=a.add(o.doc.key)}}}catch(s){u.e(s)}finally{u.f()}return new e(t,n.fromCache,i,a)}}]),e}(),au=function(){function e(){N(this,e)}return C(e,[{key:\"Xs\",value:function(e){this.Zs=e}},{key:\"Qs\",value:function(e,t,n,i){var a=this;return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(he.min())?this.ti(e,t):this.Zs.Ks(e,i).next(function(u){var o=a.ei(t,u);return(Bt(t)||Kt(t))&&a.ni(t.limitType,o,i,n)?a.ti(e,t):(P()<=r.LogLevel.DEBUG&&q(\"QueryEngine\",\"Re-using previous result from %s to execute query: %s\",n.toString(),Jt(t)),a.Zs.Qs(e,t,ft(n,-1)).next(function(e){return o.forEach(function(t){e=e.insert(t.key,t)}),e}))})}},{key:\"ei\",value:function(e,t){var n=new zn(en(e));return t.forEach(function(t,r){$t(e,r)&&(n=n.add(r))}),n}},{key:\"ni\",value:function(e,t,n,r){if(n.size!==t.size)return!0;var i=\"F\"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:\"ti\",value:function(e,t){return P()<=r.LogLevel.DEBUG&&q(\"QueryEngine\",\"Using full collection scan to execute query:\",Jt(t)),this.Zs.Qs(e,t,dt.min())}}]),e}(),uu=function(){function e(t,n,r,i){N(this,e),this.persistence=t,this.si=n,this.M=i,this.ii=new Kn(se),this.ri=new Bn(function(e){return mt(e)},kt),this.oi=new Map,this.ui=t.getRemoteDocumentCache(),this.fs=t.getTargetCache(),this._s=t.getBundleCache(),this.ai(r)}return C(e,[{key:\"ai\",value:function(e){this.indexManager=this.persistence.getIndexManager(e),this.Bs=this.persistence.getMutationQueue(e,this.indexManager),this.ci=new ru(this.ui,this.Bs,this.indexManager),this.ui.setIndexManager(this.indexManager),this.si.Xs(this.ci)}},{key:\"collectGarbage\",value:function(e){var t=this;return this.persistence.runTransaction(\"Collect garbage\",\"readwrite-primary\",function(n){return e.collect(n,t.ii)})}}]),e}();function ou(e,t,n,r){return new uu(e,t,n,r)}function su(e,t){return cu.apply(this,arguments)}function cu(){return(cu=p(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),e.next=3,r.persistence.runTransaction(\"Handle user change\",\"readonly\",function(e){var t;return r.Bs.getAllMutationBatches(e).next(function(i){return t=i,r.ai(n),r.Bs.getAllMutationBatches(e)}).next(function(n){var i,a=[],u=[],o=tr(),s=v(t);try{for(s.s();!(i=s.n()).done;){var c=i.value;a.push(c.batchId);var l,f=v(c.mutations);try{for(f.s();!(l=f.n()).done;){var h=l.value;o=o.add(h.key)}}catch(w){f.e(w)}finally{f.f()}}}catch(w){s.e(w)}finally{s.f()}var d,y=v(n);try{for(y.s();!(d=y.n()).done;){var p=d.value;u.push(p.batchId);var m,g=v(p.mutations);try{for(g.s();!(m=g.n()).done;){var k=m.value;o=o.add(k.key)}}catch(w){g.e(w)}finally{g.f()}}}catch(w){y.e(w)}finally{y.f()}return r.ci.Ks(e,o).next(function(e){return{hi:e,removedBatchIds:a,addedBatchIds:u}})})});case 3:return e.abrupt(\"return\",e.sent);case 4:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function lu(e,t){var n=Q(e);return n.persistence.runTransaction(\"Acknowledge batch\",\"readwrite-primary\",function(e){var r=t.batch.keys(),i=n.ui.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),u=xi.resolve();return a.forEach(function(e){u=u.next(function(){return r.getEntry(t,e)}).next(function(t){var a=n.docVersions.get(e);j(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),u.next(function(){return e.Bs.removeMutationBatch(t,i)})}(n,e,t,i).next(function(){return i.apply(e)}).next(function(){return n.Bs.performConsistencyCheck(e)}).next(function(){return n.ci.Ks(e,r)})})}function fu(e){var t=Q(e);return t.persistence.runTransaction(\"Get last remote snapshot version\",\"readonly\",function(e){return t.fs.getLastRemoteSnapshotVersion(e)})}function hu(e,t){var n=Q(e),r=t.snapshotVersion,i=n.ii;return n.persistence.runTransaction(\"Apply remote event\",\"readwrite-primary\",function(e){var a=n.ui.newChangeBuffer({trackRemovals:!0});i=n.ii;var u=[];t.targetChanges.forEach(function(a,o){var s=i.get(o);if(s){u.push(n.fs.removeMatchingKeys(e,a.removedDocuments,o).next(function(){return n.fs.addMatchingKeys(e,a.addedDocuments,o)}));var c=s.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(o)?c=c.withResumeToken(xe.EMPTY_BYTE_STRING,he.min()).withLastLimboFreeSnapshotVersion(he.min()):a.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(a.resumeToken,r)),i=i.insert(o,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(s,c,a)&&u.push(n.fs.updateTargetData(e,c))}});var o=Yn();if(t.documentUpdates.forEach(function(r){t.resolvedLimboDocuments.has(r)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),u.push(du(e,a,t.documentUpdates).next(function(e){o=e})),!r.isEqual(he.min())){var s=n.fs.getLastRemoteSnapshotVersion(e).next(function(t){return n.fs.setTargetsMetadata(e,e.currentSequenceNumber,r)});u.push(s)}return xi.waitFor(u).next(function(){return a.apply(e)}).next(function(){return n.ci.Gs(e,o)}).next(function(){return o})}).then(function(e){return n.ii=i,e})}function du(e,t,n){var r=tr();return n.forEach(function(e){return r=r.add(e)}),t.getEntries(e,r).next(function(e){var r=Yn();return n.forEach(function(n,i){var a=e.get(n);i.isNoDocument()&&i.version.isEqual(he.min())?(t.removeEntry(n,i.readTime),r=r.insert(n,i)):!a.isValidDocument()||i.version.compareTo(a.version)>0||0===i.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(i),r=r.insert(n,i)):q(\"LocalStore\",\"Ignoring outdated watch update for \",n,\". Current version:\",a.version,\" Watch version:\",i.version)}),r})}function vu(e,t){var n=Q(e);return n.persistence.runTransaction(\"Get next mutation batch\",\"readonly\",function(e){return void 0===t&&(t=-1),n.Bs.getNextMutationBatchAfterBatchId(e,t)})}function yu(e,t){var n=Q(e);return n.persistence.runTransaction(\"Allocate target\",\"readwrite\",function(e){var r;return n.fs.getTargetData(e,t).next(function(i){return i?(r=i,xi.resolve(r)):n.fs.allocateTargetId(e).next(function(i){return r=new Pi(t,i,0,e.currentSequenceNumber),n.fs.addTargetData(e,r).next(function(){return r})})})}).then(function(e){var r=n.ii.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ii=n.ii.insert(e.targetId,e),n.ri.set(t,e.targetId)),e})}function pu(e,t,n){return mu.apply(this,arguments)}function mu(){return(mu=p(regeneratorRuntime.mark(function e(t,n,r){var i,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Q(t),a=i.ii.get(n),u=r?\"readwrite\":\"readwrite-primary\",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction(\"Release target\",u,function(e){return i.persistence.referenceDelegate.removeTarget(e,a)});case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),_i(e.t1)){e.next=12;break}throw e.t1;case 12:q(\"LocalStore\",\"Failed to update sequence numbers for target \".concat(n,\": \").concat(e.t1));case 13:i.ii=i.ii.remove(n),i.ri.delete(a.target);case 14:case\"end\":return e.stop()}},e,null,[[1,8]])}))).apply(this,arguments)}function gu(e,t,n){var r=Q(e),i=he.min(),a=tr();return r.persistence.runTransaction(\"Execute query\",\"readonly\",function(e){return function(e,t,n){var r=Q(e),i=r.ri.get(n);return void 0!==i?xi.resolve(r.ii.get(i)):r.fs.getTargetData(t,n)}(r,e,Wt(t)).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.fs.getMatchingKeysForTargetId(e,t.targetId).next(function(e){a=e})}).next(function(){return r.si.Qs(e,t,n?i:he.min(),n?a:tr())}).next(function(e){return bu(r,Zt(t),e),{documents:e,li:a}})})}function ku(e,t){var n=Q(e),r=Q(n.fs),i=n.ii.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction(\"Get target data\",\"readonly\",function(e){return r.Et(e,t).next(function(e){return e?e.target:null})})}function wu(e,t){var n=Q(e),r=n.oi.get(t)||he.min();return n.persistence.runTransaction(\"Get new document changes\",\"readonly\",function(e){return n.ui.getAllFromCollectionGroup(e,t,ft(r,-1),Number.MAX_SAFE_INTEGER)}).then(function(e){return bu(n,t,e),e})}function bu(e,t,n){var r=he.min();n.forEach(function(e,t){t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.oi.set(t,r)}function xu(e,t,n,r){return Iu.apply(this,arguments)}function Iu(){return(Iu=p(regeneratorRuntime.mark(function e(t,n,r,i){var a,u,o,s,c,l,f,h,d,y;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=Q(t),u=tr(),o=Yn(),s=v(r);try{for(s.s();!(c=s.n()).done;)l=c.value,f=n.fi(l.metadata.name),l.document&&(u=u.add(f)),(h=n.di(l)).setReadTime(n._i(l.metadata.readTime)),o=o.insert(f,h)}catch(p){s.e(p)}finally{s.f()}return d=a.ui.newChangeBuffer({trackRemovals:!0}),e.next=7,yu(a,function(e){return Wt(Ut(me.fromString(\"__bundle__/docs/\".concat(e))))}(i));case 7:return y=e.sent,e.abrupt(\"return\",a.persistence.runTransaction(\"Apply bundle documents\",\"readwrite\",function(e){return du(e,d,o).next(function(t){return d.apply(e),t}).next(function(t){return a.fs.removeMatchingKeysForTargetId(e,y.targetId).next(function(){return a.fs.addMatchingKeys(e,u,y.targetId)}).next(function(){return a.ci.Gs(e,t)}).next(function(){return t})})}));case 9:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Eu(e,t){return Tu.apply(this,arguments)}function Tu(){return(Tu=p(regeneratorRuntime.mark(function e(t,n){var r,i,a,u=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:tr(),e.next=3,yu(t,Wt(Wi(n.bundledQuery)));case 3:return i=e.sent,a=Q(t),e.abrupt(\"return\",a.persistence.runTransaction(\"Save named query\",\"readwrite\",function(e){var t=kr(n.readTime);if(i.snapshotVersion.compareTo(t)>=0)return a._s.saveNamedQuery(e,n);var u=i.withResumeToken(xe.EMPTY_BYTE_STRING,t);return a.ii=a.ii.insert(u.targetId,u),a.fs.updateTargetData(e,u).next(function(){return a.fs.removeMatchingKeysForTargetId(e,i.targetId)}).next(function(){return a.fs.addMatchingKeys(e,r,i.targetId)}).next(function(){return a._s.saveNamedQuery(e,n)})}));case 6:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}var Su=function(){function e(t){N(this,e),this.M=t,this.wi=new Map,this.mi=new Map}return C(e,[{key:\"getBundleMetadata\",value:function(e,t){return xi.resolve(this.wi.get(t))}},{key:\"saveBundleMetadata\",value:function(e,t){var n;return this.wi.set(t.id,{id:(n=t).id,version:n.version,createTime:kr(n.createTime)}),xi.resolve()}},{key:\"getNamedQuery\",value:function(e,t){return xi.resolve(this.mi.get(t))}},{key:\"saveNamedQuery\",value:function(e,t){return this.mi.set(t.name,function(e){return{name:e.name,query:Wi(e.bundledQuery),readTime:kr(e.readTime)}}(t)),xi.resolve()}}]),e}(),_u=function(){function e(){N(this,e),this.overlays=new Kn(Ve.comparator),this.gi=new Map}return C(e,[{key:\"getOverlay\",value:function(e,t){return xi.resolve(this.overlays.get(t))}},{key:\"saveOverlays\",value:function(e,t,n){var r=this;return n.forEach(function(n,i){r.Xt(e,t,i)}),xi.resolve()}},{key:\"removeOverlaysForBatchId\",value:function(e,t,n){var r=this,i=this.gi.get(n);return void 0!==i&&(i.forEach(function(e){return r.overlays=r.overlays.remove(e)}),this.gi.delete(n)),xi.resolve()}},{key:\"getOverlaysForCollection\",value:function(e,t,n){for(var r=$n(),i=t.length+1,a=new Ve(t.child(\"\")),u=this.overlays.getIteratorFrom(a);u.hasNext();){var o=u.getNext().value,s=o.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&o.largestBatchId>n&&r.set(o.getKey(),o)}return xi.resolve(r)}},{key:\"getOverlaysForCollectionGroup\",value:function(e,t,n,r){for(var i=new Kn(function(e,t){return e-t}),a=this.overlays.getIterator();a.hasNext();){var u=a.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>n){var o=i.get(u.largestBatchId);null===o&&(o=$n(),i=i.insert(u.largestBatchId,o)),o.set(u.getKey(),u)}}for(var s=$n(),c=i.getIterator();c.hasNext()&&(c.getNext().value.forEach(function(e,t){return s.set(e,t)}),!(s.size()>=r)););return xi.resolve(s)}},{key:\"Xt\",value:function(e,t,n){if(null!==n){var r=this.overlays.get(n.key);if(null!==r){var i=this.gi.get(r.largestBatchId).delete(n.key);this.gi.set(r.largestBatchId,i)}this.overlays=this.overlays.insert(n.key,new Fi(t,n));var a=this.gi.get(t);void 0===a&&(a=tr(),this.gi.set(t,a)),this.gi.set(t,a.add(n.key))}}}]),e}(),Au=function(){function e(){N(this,e),this.yi=new zn(Du.pi),this.Ii=new zn(Du.Ti)}return C(e,[{key:\"isEmpty\",value:function(){return this.yi.isEmpty()}},{key:\"addReference\",value:function(e,t){var n=new Du(e,t);this.yi=this.yi.add(n),this.Ii=this.Ii.add(n)}},{key:\"Ei\",value:function(e,t){var n=this;e.forEach(function(e){return n.addReference(e,t)})}},{key:\"removeReference\",value:function(e,t){this.Ai(new Du(e,t))}},{key:\"Ri\",value:function(e,t){var n=this;e.forEach(function(e){return n.removeReference(e,t)})}},{key:\"Pi\",value:function(e){var t=this,n=new Ve(new me([])),r=new Du(n,e),i=new Du(n,e+1),a=[];return this.Ii.forEachInRange([r,i],function(e){t.Ai(e),a.push(e.key)}),a}},{key:\"bi\",value:function(){var e=this;this.yi.forEach(function(t){return e.Ai(t)})}},{key:\"Ai\",value:function(e){this.yi=this.yi.delete(e),this.Ii=this.Ii.delete(e)}},{key:\"Vi\",value:function(e){var t=new Ve(new me([])),n=new Du(t,e),r=new Du(t,e+1),i=tr();return this.Ii.forEachInRange([n,r],function(e){i=i.add(e.key)}),i}},{key:\"containsKey\",value:function(e){var t=new Du(e,0),n=this.yi.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),Du=function(){function e(t,n){N(this,e),this.key=t,this.vi=n}return C(e,null,[{key:\"pi\",value:function(e,t){return Ve.comparator(e.key,t.key)||se(e.vi,t.vi)}},{key:\"Ti\",value:function(e,t){return se(e.vi,t.vi)||Ve.comparator(e.key,t.key)}}]),e}(),Nu=function(){function e(t,n){N(this,e),this.indexManager=t,this.referenceDelegate=n,this.Bs=[],this.Si=1,this.Di=new zn(Du.pi)}return C(e,[{key:\"checkEmpty\",value:function(e){return xi.resolve(0===this.Bs.length)}},{key:\"addMutationBatch\",value:function(e,t,n,r){var i=this.Si;this.Si++,this.Bs.length>0&&this.Bs[this.Bs.length-1];var a=new Li(i,t,n,r);this.Bs.push(a);var u,o=v(r);try{for(o.s();!(u=o.n()).done;){var s=u.value;this.Di=this.Di.add(new Du(s.key,i)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast())}}catch(c){o.e(c)}finally{o.f()}return xi.resolve(a)}},{key:\"lookupMutationBatch\",value:function(e,t){return xi.resolve(this.Ci(t))}},{key:\"getNextMutationBatchAfterBatchId\",value:function(e,t){var n=t+1,r=this.xi(n),i=r<0?0:r;return xi.resolve(this.Bs.length>i?this.Bs[i]:null)}},{key:\"getHighestUnacknowledgedBatchId\",value:function(){return xi.resolve(0===this.Bs.length?-1:this.Si-1)}},{key:\"getAllMutationBatches\",value:function(e){return xi.resolve(this.Bs.slice())}},{key:\"getAllMutationBatchesAffectingDocumentKey\",value:function(e,t){var n=this,r=new Du(t,0),i=new Du(t,Number.POSITIVE_INFINITY),a=[];return this.Di.forEachInRange([r,i],function(e){var t=n.Ci(e.vi);a.push(t)}),xi.resolve(a)}},{key:\"getAllMutationBatchesAffectingDocumentKeys\",value:function(e,t){var n=this,r=new zn(se);return t.forEach(function(e){var t=new Du(e,0),i=new Du(e,Number.POSITIVE_INFINITY);n.Di.forEachInRange([t,i],function(e){r=r.add(e.vi)})}),xi.resolve(this.Ni(r))}},{key:\"getAllMutationBatchesAffectingQuery\",value:function(e,t){var n=t.path,r=n.length+1,i=n;Ve.isDocumentKey(i)||(i=i.child(\"\"));var a=new Du(new Ve(i),0),u=new zn(se);return this.Di.forEachWhile(function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(u=u.add(e.vi)),!0)},a),xi.resolve(this.Ni(u))}},{key:\"Ni\",value:function(e){var t=this,n=[];return e.forEach(function(e){var r=t.Ci(e);null!==r&&n.push(r)}),n}},{key:\"removeMutationBatch\",value:function(e,t){var n=this;j(0===this.ki(t.batchId,\"removed\")),this.Bs.shift();var r=this.Di;return xi.forEach(t.mutations,function(i){var a=new Du(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(function(){n.Di=r})}},{key:\"_n\",value:function(e){}},{key:\"containsKey\",value:function(e,t){var n=new Du(t,0),r=this.Di.firstAfterOrEqual(n);return xi.resolve(t.isEqual(r&&r.key))}},{key:\"performConsistencyCheck\",value:function(e){return this.Bs.length,xi.resolve()}},{key:\"ki\",value:function(e,t){return this.xi(e)}},{key:\"xi\",value:function(e){return 0===this.Bs.length?0:e-this.Bs[0].batchId}},{key:\"Ci\",value:function(e){var t=this.xi(e);return t<0||t>=this.Bs.length?null:this.Bs[t]}}]),e}(),Ru=function(){function e(t){N(this,e),this.Mi=t,this.docs=new Kn(Ve.comparator),this.size=0}return C(e,[{key:\"setIndexManager\",value:function(e){this.indexManager=e}},{key:\"addEntry\",value:function(e,t){var n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.Mi(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}},{key:\"removeEntry\",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:\"getEntry\",value:function(e,t){var n=this.docs.get(t);return xi.resolve(n?n.document.mutableCopy():at.newInvalidDocument(t))}},{key:\"getEntries\",value:function(e,t){var n=this,r=Yn();return t.forEach(function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():at.newInvalidDocument(e))}),xi.resolve(r)}},{key:\"getAllFromCollection\",value:function(e,t,n){for(var r=Yn(),i=new Ve(t.child(\"\")),a=this.docs.getIteratorFrom(i);a.hasNext();){var u=a.getNext(),o=u.key,s=u.value.document;if(!t.isPrefixOf(o.path))break;o.path.length>t.length+1||vt(ht(s),n)<=0||(r=r.insert(s.key,s.mutableCopy()))}return xi.resolve(r)}},{key:\"getAllFromCollectionGroup\",value:function(e,t,n,r){G()}},{key:\"Oi\",value:function(e,t){return xi.forEach(this.docs,function(e){return t(e)})}},{key:\"newChangeBuffer\",value:function(e){return new Cu(this)}},{key:\"getSize\",value:function(e){return xi.resolve(this.size)}}]),e}(),Cu=function(e){m(n,Ka);var t=k(n);function n(e){var r;return N(this,n),(r=t.call(this)).Kn=e,r}return C(n,[{key:\"applyChanges\",value:function(e){var t=this,n=[];return this.changes.forEach(function(r,i){i.isValidDocument()?n.push(t.Kn.addEntry(e,i)):t.Kn.removeEntry(r)}),xi.waitFor(n)}},{key:\"getFromCache\",value:function(e,t){return this.Kn.getEntry(e,t)}},{key:\"getAllFromCache\",value:function(e,t){return this.Kn.getEntries(e,t)}}]),n}(),Mu=function(){function e(t){N(this,e),this.persistence=t,this.Fi=new Bn(function(e){return mt(e)},kt),this.lastRemoteSnapshotVersion=he.min(),this.highestTargetId=0,this.$i=0,this.Bi=new Au,this.targetCount=0,this.Li=Da.gn()}return C(e,[{key:\"forEachTarget\",value:function(e,t){return this.Fi.forEach(function(e,n){return t(n)}),xi.resolve()}},{key:\"getLastRemoteSnapshotVersion\",value:function(e){return xi.resolve(this.lastRemoteSnapshotVersion)}},{key:\"getHighestSequenceNumber\",value:function(e){return xi.resolve(this.$i)}},{key:\"allocateTargetId\",value:function(e){return this.highestTargetId=this.Li.next(),xi.resolve(this.highestTargetId)}},{key:\"setTargetsMetadata\",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.$i&&(this.$i=t),xi.resolve()}},{key:\"Tn\",value:function(e){this.Fi.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Li=new Da(t),this.highestTargetId=t),e.sequenceNumber>this.$i&&(this.$i=e.sequenceNumber)}},{key:\"addTargetData\",value:function(e,t){return this.Tn(t),this.targetCount+=1,xi.resolve()}},{key:\"updateTargetData\",value:function(e,t){return this.Tn(t),xi.resolve()}},{key:\"removeTargetData\",value:function(e,t){return this.Fi.delete(t.target),this.Bi.Pi(t.targetId),this.targetCount-=1,xi.resolve()}},{key:\"removeTargets\",value:function(e,t,n){var r=this,i=0,a=[];return this.Fi.forEach(function(u,o){o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r.Fi.delete(u),a.push(r.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),xi.waitFor(a).next(function(){return i})}},{key:\"getTargetCount\",value:function(e){return xi.resolve(this.targetCount)}},{key:\"getTargetData\",value:function(e,t){var n=this.Fi.get(t)||null;return xi.resolve(n)}},{key:\"addMatchingKeys\",value:function(e,t,n){return this.Bi.Ei(t,n),xi.resolve()}},{key:\"removeMatchingKeys\",value:function(e,t,n){this.Bi.Ri(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),xi.waitFor(i)}},{key:\"removeMatchingKeysForTargetId\",value:function(e,t){return this.Bi.Pi(t),xi.resolve()}},{key:\"getMatchingKeysForTargetId\",value:function(e,t){var n=this.Bi.Vi(t);return xi.resolve(n)}},{key:\"containsKey\",value:function(e,t){return xi.resolve(this.Bi.containsKey(t))}}]),e}(),Lu=function(){function e(t,n){var r=this;N(this,e),this.Ui={},this.overlays={},this.es=new ae(0),this.ns=!1,this.ns=!0,this.referenceDelegate=t(this),this.fs=new Mu(this),this.indexManager=new ha,this.ds=new Ru(function(e){return r.referenceDelegate.qi(e)}),this.M=new Oi(n),this._s=new Su(this.M)}return C(e,[{key:\"start\",value:function(){return Promise.resolve()}},{key:\"shutdown\",value:function(){return this.ns=!1,Promise.resolve()}},{key:\"started\",get:function(){return this.ns}},{key:\"setDatabaseDeletedListener\",value:function(){}},{key:\"setNetworkEnabled\",value:function(){}},{key:\"getIndexManager\",value:function(e){return this.indexManager}},{key:\"getDocumentOverlayCache\",value:function(e){var t=this.overlays[e.toKey()];return t||(t=new _u,this.overlays[e.toKey()]=t),t}},{key:\"getMutationQueue\",value:function(e,t){var n=this.Ui[e.toKey()];return n||(n=new Nu(t,this.referenceDelegate),this.Ui[e.toKey()]=n),n}},{key:\"getTargetCache\",value:function(){return this.fs}},{key:\"getRemoteDocumentCache\",value:function(){return this.ds}},{key:\"getBundleCache\",value:function(){return this._s}},{key:\"runTransaction\",value:function(e,t,n){var r=this;q(\"MemoryPersistence\",\"Starting transaction:\",e);var i=new Vu(this.es.next());return this.referenceDelegate.Ki(),n(i).next(function(e){return r.referenceDelegate.Gi(i).next(function(){return e})}).toPromise().then(function(e){return i.raiseOnCommittedEvent(),e})}},{key:\"Qi\",value:function(e,t){return xi.or(Object.values(this.Ui).map(function(n){return function(){return n.containsKey(e,t)}}))}}]),e}(),Vu=function(e){m(n,bi);var t=k(n);function n(e){var r;return N(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return C(n)}(),Fu=function(){function e(t){N(this,e),this.persistence=t,this.ji=new Au,this.Wi=null}return C(e,[{key:\"Hi\",get:function(){if(this.Wi)return this.Wi;throw G()}},{key:\"addReference\",value:function(e,t,n){return this.ji.addReference(n,t),this.Hi.delete(n.toString()),xi.resolve()}},{key:\"removeReference\",value:function(e,t,n){return this.ji.removeReference(n,t),this.Hi.add(n.toString()),xi.resolve()}},{key:\"markPotentiallyOrphaned\",value:function(e,t){return this.Hi.add(t.toString()),xi.resolve()}},{key:\"removeTarget\",value:function(e,t){var n=this;this.ji.Pi(t.targetId).forEach(function(e){return n.Hi.add(e.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(function(e){e.forEach(function(e){return n.Hi.add(e.toString())})}).next(function(){return r.removeTargetData(e,t)})}},{key:\"Ki\",value:function(){this.Wi=new Set}},{key:\"Gi\",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return xi.forEach(this.Hi,function(r){var i=Ve.fromPath(r);return t.Ji(e,i).next(function(e){e||n.removeEntry(i,he.min())})}).next(function(){return t.Wi=null,n.apply(e)})}},{key:\"updateLimboDocument\",value:function(e,t){var n=this;return this.Ji(e,t).next(function(e){e?n.Hi.delete(t.toString()):n.Hi.add(t.toString())})}},{key:\"qi\",value:function(e){return 0}},{key:\"Ji\",value:function(e,t){var n=this;return xi.or([function(){return xi.resolve(n.ji.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Qi(e,t)}])}}],[{key:\"zi\",value:function(t){return new e(t)}}]),e}();function Pu(e,t){return\"firestore_clients_\".concat(e,\"_\").concat(t)}function Ou(e,t,n){var r=\"firestore_mutations_\".concat(e,\"_\").concat(n);return t.isAuthenticated()&&(r+=\"_\".concat(t.uid)),r}function qu(e,t){return\"firestore_targets_\".concat(e,\"_\").concat(t)}var Uu=function(){function e(t,n,r,i){N(this,e),this.user=t,this.batchId=n,this.state=r,this.error=i}return C(e,[{key:\"Xi\",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:\"Yi\",value:function(t,n,r){var i,a=JSON.parse(r),u=\"object\"==d(a)&&-1!==[\"pending\",\"acknowledged\",\"rejected\"].indexOf(a.state)&&(void 0===a.error||\"object\"==d(a.error));return u&&a.error&&((u=\"string\"==typeof a.error.message&&\"string\"==typeof a.error.code)&&(i=new H(a.error.code,a.error.message))),u?new e(t,n,a.state,i):(U(\"SharedClientState\",\"Failed to parse mutation state for ID '\".concat(n,\"': \").concat(r)),null)}}]),e}(),Bu=function(){function e(t,n,r){N(this,e),this.targetId=t,this.state=n,this.error=r}return C(e,[{key:\"Xi\",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:\"Yi\",value:function(t,n){var r,i=JSON.parse(n),a=\"object\"==d(i)&&-1!==[\"not-current\",\"current\",\"rejected\"].indexOf(i.state)&&(void 0===i.error||\"object\"==d(i.error));return a&&i.error&&((a=\"string\"==typeof i.error.message&&\"string\"==typeof i.error.code)&&(r=new H(i.error.code,i.error.message))),a?new e(t,i.state,r):(U(\"SharedClientState\",\"Failed to parse target state for ID '\".concat(t,\"': \").concat(n)),null)}}]),e}(),Ku=function(){function e(t,n){N(this,e),this.clientId=t,this.activeTargetIds=n}return C(e,null,[{key:\"Yi\",value:function(t,n){for(var r=JSON.parse(n),i=\"object\"==d(r)&&r.activeTargetIds instanceof Array,a=rr(),u=0;i&&u<r.activeTargetIds.length;++u)i=Le(r.activeTargetIds[u]),a=a.add(r.activeTargetIds[u]);return i?new e(t,a):(U(\"SharedClientState\",\"Failed to parse client data for instance '\".concat(t,\"': \").concat(n)),null)}}]),e}(),Gu=function(){function e(t,n){N(this,e),this.clientId=t,this.onlineState=n}return C(e,null,[{key:\"Yi\",value:function(t){var n=JSON.parse(t);return\"object\"==d(n)&&-1!==[\"Unknown\",\"Online\",\"Offline\"].indexOf(n.onlineState)&&\"string\"==typeof n.clientId?new e(n.clientId,n.onlineState):(U(\"SharedClientState\",\"Failed to parse online state: \".concat(t)),null)}}]),e}(),ju=function(){function e(){N(this,e),this.activeTargetIds=rr()}return C(e,[{key:\"Zi\",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:\"tr\",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:\"Xi\",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),zu=function(){function e(t,n,r,i,a){N(this,e),this.window=t,this.Yn=n,this.persistenceKey=r,this.er=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.nr=this.sr.bind(this),this.ir=new Kn(se),this.started=!1,this.rr=[];var u=r.replace(/[.*+?^${}()|[\\]\\\\]/g,\"\\\\$&\");this.storage=this.window.localStorage,this.currentUser=a,this.ur=Pu(this.persistenceKey,this.er),this.ar=function(e){return\"firestore_sequence_number_\".concat(e)}(this.persistenceKey),this.ir=this.ir.insert(this.er,new ju),this.cr=new RegExp(\"^firestore_clients_\".concat(u,\"_([^_]*)$\")),this.hr=new RegExp(\"^firestore_mutations_\".concat(u,\"_(\\\\d+)(?:_(.*))?$\")),this.lr=new RegExp(\"^firestore_targets_\".concat(u,\"_(\\\\d+)$\")),this.dr=function(e){return\"firestore_online_state_\".concat(e)}(this.persistenceKey),this._r=function(e){return\"firestore_bundle_loaded_v2_\".concat(e)}(this.persistenceKey),this.window.addEventListener(\"storage\",this.nr)}return C(e,[{key:\"start\",value:function(){var e=p(regeneratorRuntime.mark(function e(){var t,n,r,i,a,u,o,s,c,l,f,h=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncEngine.Fs();case 2:t=e.sent,n=v(t),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=14;break}if((i=r.value)!==this.er){e.next=10;break}return e.abrupt(\"continue\",12);case 10:(a=this.getItem(Pu(this.persistenceKey,i)))&&(u=Ku.Yi(i,a))&&(this.ir=this.ir.insert(u.clientId,u));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:this.wr(),(o=this.storage.getItem(this.dr))&&(s=this.mr(o))&&this.gr(s),c=v(this.rr);try{for(c.s();!(l=c.n()).done;)f=l.value,this.sr(f)}catch(d){c.e(d)}finally{c.f()}this.rr=[],this.window.addEventListener(\"pagehide\",function(){return h.shutdown()}),this.started=!0;case 28:case\"end\":return e.stop()}},e,this,[[4,16,19,22]])}));return function(){return e.apply(this,arguments)}}()},{key:\"writeSequenceNumber\",value:function(e){this.setItem(this.ar,JSON.stringify(e))}},{key:\"getAllActiveQueryTargets\",value:function(){return this.yr(this.ir)}},{key:\"isActiveQueryTarget\",value:function(e){var t=!1;return this.ir.forEach(function(n,r){r.activeTargetIds.has(e)&&(t=!0)}),t}},{key:\"addPendingMutation\",value:function(e){this.pr(e,\"pending\")}},{key:\"updateMutationState\",value:function(e,t,n){this.pr(e,t,n),this.Ir(e)}},{key:\"addLocalQueryTarget\",value:function(e){var t=\"not-current\";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(qu(this.persistenceKey,e));if(n){var r=Bu.Yi(e,n);r&&(t=r.state)}}return this.Tr.Zi(e),this.wr(),t}},{key:\"removeLocalQueryTarget\",value:function(e){this.Tr.tr(e),this.wr()}},{key:\"isLocalQueryTarget\",value:function(e){return this.Tr.activeTargetIds.has(e)}},{key:\"clearQueryState\",value:function(e){this.removeItem(qu(this.persistenceKey,e))}},{key:\"updateQueryState\",value:function(e,t,n){this.Er(e,t,n)}},{key:\"handleUserChange\",value:function(e,t,n){var r=this;t.forEach(function(e){r.Ir(e)}),this.currentUser=e,n.forEach(function(e){r.addPendingMutation(e)})}},{key:\"setOnlineState\",value:function(e){this.Ar(e)}},{key:\"notifyBundleLoaded\",value:function(e){this.Rr(e)}},{key:\"shutdown\",value:function(){this.started&&(this.window.removeEventListener(\"storage\",this.nr),this.removeItem(this.ur),this.started=!1)}},{key:\"getItem\",value:function(e){var t=this.storage.getItem(e);return q(\"SharedClientState\",\"READ\",e,t),t}},{key:\"setItem\",value:function(e,t){q(\"SharedClientState\",\"SET\",e,t),this.storage.setItem(e,t)}},{key:\"removeItem\",value:function(e){q(\"SharedClientState\",\"REMOVE\",e),this.storage.removeItem(e)}},{key:\"sr\",value:function(e){var t=this,n=e;if(n.storageArea===this.storage){if(q(\"SharedClientState\",\"EVENT\",n.key,n.newValue),n.key===this.ur)return void U(\"Received WebStorage notification for local change. Another client might have garbage-collected our state\");this.Yn.enqueueRetryable(p(regeneratorRuntime.mark(function e(){var r,i,a,u,o,s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.started){e.next=43;break}if(null===n.key){e.next=41;break}if(!t.cr.test(n.key)){e.next=11;break}if(null!=n.newValue){e.next=6;break}return r=t.Pr(n.key),e.abrupt(\"return\",t.br(r,null));case 6:if(!(i=t.Vr(n.key,n.newValue))){e.next=9;break}return e.abrupt(\"return\",t.br(i.clientId,i));case 9:e.next=41;break;case 11:if(!t.hr.test(n.key)){e.next=18;break}if(null===n.newValue){e.next=16;break}if(!(a=t.vr(n.key,n.newValue))){e.next=16;break}return e.abrupt(\"return\",t.Sr(a));case 16:e.next=41;break;case 18:if(!t.lr.test(n.key)){e.next=25;break}if(null===n.newValue){e.next=23;break}if(!(u=t.Dr(n.key,n.newValue))){e.next=23;break}return e.abrupt(\"return\",t.Cr(u));case 23:e.next=41;break;case 25:if(n.key!==t.dr){e.next=32;break}if(null===n.newValue){e.next=30;break}if(!(o=t.mr(n.newValue))){e.next=30;break}return e.abrupt(\"return\",t.gr(o));case 30:e.next=41;break;case 32:if(n.key!==t.ar){e.next=37;break}(s=function(e){var t=ae.A;if(null!=e)try{var n=JSON.parse(e);j(\"number\"==typeof n),t=n}catch(e){U(\"SharedClientState\",\"Failed to read sequence number from WebStorage\",e)}return t}(n.newValue))!==ae.A&&t.sequenceNumberHandler(s),e.next=41;break;case 37:if(n.key!==t._r){e.next=41;break}return c=t.Nr(n.newValue),e.next=41,Promise.all(c.map(function(e){return t.syncEngine.kr(e)}));case 41:e.next=44;break;case 43:t.rr.push(n);case 44:case\"end\":return e.stop()}},e)})))}}},{key:\"Tr\",get:function(){return this.ir.get(this.er)}},{key:\"wr\",value:function(){this.setItem(this.ur,this.Tr.Xi())}},{key:\"pr\",value:function(e,t,n){var r=new Uu(this.currentUser,e,t,n),i=Ou(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Xi())}},{key:\"Ir\",value:function(e){var t=Ou(this.persistenceKey,this.currentUser,e);this.removeItem(t)}},{key:\"Ar\",value:function(e){var t={clientId:this.er,onlineState:e};this.storage.setItem(this.dr,JSON.stringify(t))}},{key:\"Er\",value:function(e,t,n){var r=qu(this.persistenceKey,e),i=new Bu(e,t,n);this.setItem(r,i.Xi())}},{key:\"Rr\",value:function(e){var t=JSON.stringify(Array.from(e));this.setItem(this._r,t)}},{key:\"Pr\",value:function(e){var t=this.cr.exec(e);return t?t[1]:null}},{key:\"Vr\",value:function(e,t){var n=this.Pr(e);return Ku.Yi(n,t)}},{key:\"vr\",value:function(e,t){var n=this.hr.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Uu.Yi(new L(i),r,t)}},{key:\"Dr\",value:function(e,t){var n=this.lr.exec(e),r=Number(n[1]);return Bu.Yi(r,t)}},{key:\"mr\",value:function(e){return Gu.Yi(e)}},{key:\"Nr\",value:function(e){return JSON.parse(e)}},{key:\"Sr\",value:function(){var e=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user.uid!==this.currentUser.uid){e.next=2;break}return e.abrupt(\"return\",this.syncEngine.Mr(t.batchId,t.state,t.error));case 2:q(\"SharedClientState\",\"Ignoring mutation for non-active user \".concat(t.user.uid));case 3:case\"end\":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:\"Cr\",value:function(e){return this.syncEngine.Or(e.targetId,e.state,e.error)}},{key:\"br\",value:function(e,t){var n=this,r=t?this.ir.insert(e,t):this.ir.remove(e),i=this.yr(this.ir),a=this.yr(r),u=[],o=[];return a.forEach(function(e){i.has(e)||u.push(e)}),i.forEach(function(e){a.has(e)||o.push(e)}),this.syncEngine.Fr(u,o).then(function(){n.ir=r})}},{key:\"gr\",value:function(e){this.ir.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}},{key:\"yr\",value:function(e){var t=rr();return e.forEach(function(e,n){t=t.unionWith(n.activeTargetIds)}),t}}],[{key:\"vt\",value:function(e){return!(!e||!e.localStorage)}}]),e}(),Qu=function(){function e(){N(this,e),this.$r=new ju,this.Br={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return C(e,[{key:\"addPendingMutation\",value:function(e){}},{key:\"updateMutationState\",value:function(e,t,n){}},{key:\"addLocalQueryTarget\",value:function(e){return this.$r.Zi(e),this.Br[e]||\"not-current\"}},{key:\"updateQueryState\",value:function(e,t,n){this.Br[e]=t}},{key:\"removeLocalQueryTarget\",value:function(e){this.$r.tr(e)}},{key:\"isLocalQueryTarget\",value:function(e){return this.$r.activeTargetIds.has(e)}},{key:\"clearQueryState\",value:function(e){delete this.Br[e]}},{key:\"getAllActiveQueryTargets\",value:function(){return this.$r.activeTargetIds}},{key:\"isActiveQueryTarget\",value:function(e){return this.$r.activeTargetIds.has(e)}},{key:\"start\",value:function(){return this.$r=new ju,Promise.resolve()}},{key:\"handleUserChange\",value:function(e,t,n){}},{key:\"setOnlineState\",value:function(e){}},{key:\"shutdown\",value:function(){}},{key:\"writeSequenceNumber\",value:function(e){}},{key:\"notifyBundleLoaded\",value:function(e){}}]),e}(),Wu=function(){function e(){N(this,e)}return C(e,[{key:\"Lr\",value:function(e){}},{key:\"shutdown\",value:function(){}}]),e}(),Hu=function(){function e(){var t=this;N(this,e),this.Ur=function(){return t.qr()},this.Kr=function(){return t.Gr()},this.Qr=[],this.jr()}return C(e,[{key:\"Lr\",value:function(e){this.Qr.push(e)}},{key:\"shutdown\",value:function(){window.removeEventListener(\"online\",this.Ur),window.removeEventListener(\"offline\",this.Kr)}},{key:\"jr\",value:function(){window.addEventListener(\"online\",this.Ur),window.addEventListener(\"offline\",this.Kr)}},{key:\"qr\",value:function(){q(\"ConnectivityMonitor\",\"Network connectivity changed: AVAILABLE\");var e,t=v(this.Qr);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:\"Gr\",value:function(){q(\"ConnectivityMonitor\",\"Network connectivity changed: UNAVAILABLE\");var e,t=v(this.Qr);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:\"vt\",value:function(){return\"undefined\"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),Yu={BatchGetDocuments:\"batchGet\",Commit:\"commit\",RunQuery:\"runQuery\"},Xu=function(){function e(t){N(this,e),this.Wr=t.Wr,this.zr=t.zr}return C(e,[{key:\"Hr\",value:function(e){this.Jr=e}},{key:\"Yr\",value:function(e){this.Xr=e}},{key:\"onMessage\",value:function(e){this.Zr=e}},{key:\"close\",value:function(){this.zr()}},{key:\"send\",value:function(e){this.Wr(e)}},{key:\"eo\",value:function(){this.Jr()}},{key:\"no\",value:function(e){this.Xr(e)}},{key:\"so\",value:function(e){this.Zr(e)}}]),e}(),Ju=function(e){m(n,function(){function e(t){N(this,e);this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?\"https\":\"http\";this.io=n+\"://\"+t.host,this.ro=\"projects/\"+this.databaseId.projectId+\"/databases/\"+this.databaseId.database+\"/documents\"}C(e,[{key:\"oo\",value:function e(t,n,r,i,a){var u=this.uo(t,n);q(\"RestConnection\",\"Sending: \",u,r);var o={};return this.ao(o,i,a),this.co(t,u,o,r).then(function(e){return q(\"RestConnection\",\"Received: \",e),e},function(e){throw B(\"RestConnection\",\"\".concat(t,\" failed with error: \"),e,\"url: \",u,\"request:\",r),e})}},{key:\"ho\",value:function e(t,n,r,i,a){return this.oo(t,n,r,i,a)}},{key:\"ao\",value:function e(t,n,r){t[\"X-Goog-Api-Client\"]=\"gl-js/ fire/\"+V,t[\"Content-Type\"]=\"text/plain\",this.databaseInfo.appId&&(t[\"X-Firebase-GMPID\"]=this.databaseInfo.appId),n&&n.headers.forEach(function(e,n){return t[n]=e}),r&&r.headers.forEach(function(e,n){return t[n]=e})}},{key:\"uo\",value:function e(t,n){var r=Yu[t];return\"\".concat(this.io,\"/v1/\").concat(n,\":\").concat(r)}}]);return e}());var t=k(n);function n(e){var r;return N(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r}return C(n,[{key:\"co\",value:function(e,t,n,r){return new Promise(function(i,u){var o=new a.XhrIo;o.listenOnce(a.EventType.COMPLETE,function(){try{switch(o.getLastErrorCode()){case a.ErrorCode.NO_ERROR:var t=o.getResponseJson();q(\"Connection\",\"XHR received:\",JSON.stringify(t)),i(t);break;case a.ErrorCode.TIMEOUT:q(\"Connection\",'RPC \"'+e+'\" timed out'),u(new H(W.DEADLINE_EXCEEDED,\"Request time out\"));break;case a.ErrorCode.HTTP_ERROR:var n=o.getStatus();if(q(\"Connection\",'RPC \"'+e+'\" failed with status:',n,\"response text:\",o.getResponseText()),n>0){var r=o.getResponseJson().error;if(r&&r.status&&r.message){var s=(c=r.status.toLowerCase().replace(/_/g,\"-\"),Object.values(W).indexOf(c)>=0?c:W.UNKNOWN);u(new H(s,r.message))}else u(new H(W.UNKNOWN,\"Server responded with status \"+o.getStatus()))}else u(new H(W.UNAVAILABLE,\"Connection failed.\"));break;default:G()}}finally{q(\"Connection\",'RPC \"'+e+'\" completed.')}var c});var s=JSON.stringify(r);o.send(t,\"POST\",s,n,15)})}},{key:\"lo\",value:function(e,t,n){var r=[this.io,\"/\",\"google.firestore.v1.Firestore\",\"/\",e,\"/channel\"],u=(0,a.createWebChannelTransport)(),o=(0,a.getStatEventTarget)(),s={httpSessionIdParam:\"gsessionid\",initMessageHeaders:{},messageUrlParams:{database:\"projects/\".concat(this.databaseId.projectId,\"/databases/\").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new a.FetchXmlHttpFactory({})),this.ao(s.initMessageHeaders,t,n),(0,i.isMobileCordova)()||(0,i.isReactNative)()||(0,i.isElectron)()||(0,i.isIE)()||(0,i.isUWP)()||(0,i.isBrowserExtension)()||(s.httpHeadersOverwriteParam=\"$httpHeaders\");var c=r.join(\"\");q(\"Connection\",\"Creating WebChannel: \"+c,s);var l=u.createWebChannel(c,s),f=!1,h=!1,d=new Xu({Wr:function(e){h?q(\"Connection\",\"Not sending because WebChannel is closed:\",e):(f||(q(\"Connection\",\"Opening WebChannel transport.\"),l.open(),f=!0),q(\"Connection\",\"WebChannel sending:\",e),l.send(e))},zr:function(){return l.close()}}),v=function(e,t,n){e.listen(t,function(e){try{n(e)}catch(e){setTimeout(function(){throw e},0)}})};return v(l,a.WebChannel.EventType.OPEN,function(){h||q(\"Connection\",\"WebChannel transport opened.\")}),v(l,a.WebChannel.EventType.CLOSE,function(){h||(h=!0,q(\"Connection\",\"WebChannel transport closed\"),d.no())}),v(l,a.WebChannel.EventType.ERROR,function(e){h||(h=!0,B(\"Connection\",\"WebChannel transport errored:\",e),d.no(new H(W.UNAVAILABLE,\"The operation could not be completed\")))}),v(l,a.WebChannel.EventType.MESSAGE,function(e){var t;if(!h){var n=e.data[0];j(!!n);var r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){q(\"Connection\",\"WebChannel received error:\",i);var a=i.status,u=function(e){var t=Ln[a];if(void 0!==t)return Un(t)}(),o=i.message;void 0===u&&(u=W.INTERNAL,o=\"Unknown error status: \"+a+\" with message \"+i.message),h=!0,d.no(new H(u,o)),l.close()}else q(\"Connection\",\"WebChannel received:\",n),d.so(n)}}),v(o,a.Event.STAT_EVENT,function(e){e.stat===a.Stat.PROXY?q(\"Connection\",\"Detected buffering proxy\"):e.stat===a.Stat.NOPROXY&&q(\"Connection\",\"Detected no buffering proxy\")}),setTimeout(function(){d.eo()},0),d}}]),n}();function $u(){return\"undefined\"!=typeof window?window:null}function Zu(){return\"undefined\"!=typeof document?document:null}function eo(e){return new yr(e,!0)}var to=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;N(this,e),this.Yn=t,this.timerId=n,this.fo=r,this._o=i,this.wo=a,this.mo=0,this.yo=null,this.po=Date.now(),this.reset()}return C(e,[{key:\"reset\",value:function(){this.mo=0}},{key:\"Io\",value:function(){this.mo=this.wo}},{key:\"To\",value:function(e){var t=this;this.cancel();var n=Math.floor(this.mo+this.Eo()),r=Math.max(0,Date.now()-this.po),i=Math.max(0,n-r);i>0&&q(\"ExponentialBackoff\",\"Backing off for \".concat(i,\" ms (base delay: \").concat(this.mo,\" ms, delay with jitter: \").concat(n,\" ms, last attempt: \").concat(r,\" ms ago)\")),this.yo=this.Yn.enqueueAfterDelay(this.timerId,i,function(){return t.po=Date.now(),e()}),this.mo*=this._o,this.mo<this.fo&&(this.mo=this.fo),this.mo>this.wo&&(this.mo=this.wo)}},{key:\"Ao\",value:function(){null!==this.yo&&(this.yo.skipDelay(),this.yo=null)}},{key:\"cancel\",value:function(){null!==this.yo&&(this.yo.cancel(),this.yo=null)}},{key:\"Eo\",value:function(){return(Math.random()-.5)*this.mo}}]),e}(),no=function(){function e(t,n,r,i,a,u,o,s){N(this,e),this.Yn=t,this.Ro=r,this.Po=i,this.bo=a,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=o,this.listener=s,this.state=0,this.Vo=0,this.vo=null,this.So=null,this.stream=null,this.Do=new to(t,n)}return C(e,[{key:\"Co\",value:function(){return 1===this.state||5===this.state||this.xo()}},{key:\"xo\",value:function(){return 2===this.state||3===this.state}},{key:\"start\",value:function(){4!==this.state?this.auth():this.No()}},{key:\"stop\",value:function(){var e=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.Co(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case\"end\":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:\"ko\",value:function(){this.state=0,this.Do.reset()}},{key:\"Mo\",value:function(){var e=this;this.xo()&&null===this.vo&&(this.vo=this.Yn.enqueueAfterDelay(this.Ro,6e4,function(){return e.Oo()}))}},{key:\"Fo\",value:function(e){this.$o(),this.stream.send(e)}},{key:\"Oo\",value:function(){var e=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.xo()){e.next=2;break}return e.abrupt(\"return\",this.close(0));case 2:case\"end\":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:\"$o\",value:function(){this.vo&&(this.vo.cancel(),this.vo=null)}},{key:\"Bo\",value:function(){this.So&&(this.So.cancel(),this.So=null)}},{key:\"close\",value:function(){var e=p(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.$o(),this.Bo(),this.Do.cancel(),this.Vo++,4!==t?this.Do.reset():n&&n.code===W.RESOURCE_EXHAUSTED?(U(n.toString()),U(\"Using maximum backoff delay to prevent overloading the backend.\"),this.Do.Io()):n&&n.code===W.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Lo(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.Yr(n);case 9:case\"end\":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:\"Lo\",value:function(){}},{key:\"auth\",value:function(){var e=this;this.state=1;var t=this.Uo(this.Vo),n=this.Vo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(function(t){var r=c(t,2),i=r[0],a=r[1];e.Vo===n&&e.qo(i,a)},function(n){t(function(){var t=new H(W.UNKNOWN,\"Fetching auth token failed: \"+n.message);return e.Ko(t)})})}},{key:\"qo\",value:function(e,t){var n=this,r=this.Uo(this.Vo);this.stream=this.Go(e,t),this.stream.Hr(function(){r(function(){return n.state=2,n.So=n.Yn.enqueueAfterDelay(n.Po,1e4,function(){return n.xo()&&(n.state=3),Promise.resolve()}),n.listener.Hr()})}),this.stream.Yr(function(e){r(function(){return n.Ko(e)})}),this.stream.onMessage(function(e){r(function(){return n.onMessage(e)})})}},{key:\"No\",value:function(){var e=this;this.state=5,this.Do.To(p(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case\"end\":return t.stop()}},t)})))}},{key:\"Ko\",value:function(e){return q(\"PersistentStream\",\"close with error: \".concat(e)),this.stream=null,this.close(4,e)}},{key:\"Uo\",value:function(e){var t=this;return function(n){t.Yn.enqueueAndForget(function(){return t.Vo===e?n():(q(\"PersistentStream\",\"stream callback skipped by getCloseGuardedDispatcher.\"),Promise.resolve())})}}}]),e}(),ro=function(e){m(n,no);var t=k(n);function n(e,r,i,a,u,o){var s;return N(this,n),(s=t.call(this,e,\"listen_stream_connection_backoff\",\"listen_stream_idle\",\"health_check_timeout\",r,i,a,o)).M=u,s}return C(n,[{key:\"Go\",value:function(e,t){return this.bo.lo(\"Listen\",e,t)}},{key:\"onMessage\",value:function(e){this.Do.reset();var t=Rr(this.M,e),n=function(e){if(!(\"targetChange\"in e))return he.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?he.min():t.readTime?kr(t.readTime):he.min()}(e);return this.listener.Qo(t,n)}},{key:\"jo\",value:function(e){var t={};t.database=Sr(this.M),t.addTarget=function(e,t){var n,r=t.target;return(n=wt(r)?{documents:Vr(e,r)}:{query:Fr(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=mr(e,t.resumeToken):t.snapshotVersion.compareTo(he.min())>0&&(n.readTime=pr(e,t.snapshotVersion.toTimestamp())),n}(this.M,e);var n=Or(this.M,e);n&&(t.labels=n),this.Fo(t)}},{key:\"Wo\",value:function(e){var t={};t.database=Sr(this.M),t.removeTarget=e,this.Fo(t)}}]),n}(),io=function(e){m(n,no);var t=k(n);function n(e,r,i,a,u,o){var s;return N(this,n),(s=t.call(this,e,\"write_stream_connection_backoff\",\"write_stream_idle\",\"health_check_timeout\",r,i,a,o)).M=u,s.zo=!1,s}return C(n,[{key:\"Ho\",get:function(){return this.zo}},{key:\"start\",value:function(){this.zo=!1,this.lastStreamToken=void 0,o(I(n.prototype),\"start\",this).call(this)}},{key:\"Lo\",value:function(){this.zo&&this.Jo([])}},{key:\"Go\",value:function(e,t){return this.bo.lo(\"Write\",e,t)}},{key:\"onMessage\",value:function(e){if(j(!!e.streamToken),this.lastStreamToken=e.streamToken,this.zo){this.Do.reset();var t=Lr(e.writeResults,e.commitTime),n=kr(e.commitTime);return this.listener.Yo(n,t)}return j(!e.writeResults||0===e.writeResults.length),this.zo=!0,this.listener.Xo()}},{key:\"Zo\",value:function(){var e={};e.database=Sr(this.M),this.Fo(e)}},{key:\"Jo\",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map(function(e){return Cr(t.M,e)})};this.Fo(n)}}]),n}(),ao=function(e){m(n,function(){function e(){N(this,e)}return C(e)}());var t=k(n);function n(e,r,i,a){var u;return N(this,n),(u=t.call(this)).authCredentials=e,u.appCheckCredentials=r,u.bo=i,u.M=a,u.tu=!1,u}return C(n,[{key:\"eu\",value:function(){if(this.tu)throw new H(W.FAILED_PRECONDITION,\"The client has already been terminated.\")}},{key:\"oo\",value:function(e,t,n){var r=this;return this.eu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(i){var a=c(i,2),u=a[0],o=a[1];return r.bo.oo(e,t,n,u,o)}).catch(function(e){throw\"FirebaseError\"===e.name?(e.code===W.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new H(W.UNKNOWN,e.toString())})}},{key:\"ho\",value:function(e,t,n){var r=this;return this.eu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(function(i){var a=c(i,2),u=a[0],o=a[1];return r.bo.ho(e,t,n,u,o)}).catch(function(e){throw\"FirebaseError\"===e.name?(e.code===W.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new H(W.UNKNOWN,e.toString())})}},{key:\"terminate\",value:function(){this.tu=!0}}]),n}(),uo=function(){function e(t,n){N(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state=\"Unknown\",this.nu=0,this.su=null,this.iu=!0}return C(e,[{key:\"ru\",value:function(){var e=this;0===this.nu&&(this.ou(\"Unknown\"),this.su=this.asyncQueue.enqueueAfterDelay(\"online_state_timeout\",1e4,function(){return e.su=null,e.uu(\"Backend didn't respond within 10 seconds.\"),e.ou(\"Offline\"),Promise.resolve()}))}},{key:\"au\",value:function(e){\"Online\"===this.state?this.ou(\"Unknown\"):(this.nu++,this.nu>=1&&(this.cu(),this.uu(\"Connection failed 1 times. Most recent error: \".concat(e.toString())),this.ou(\"Offline\")))}},{key:\"set\",value:function(e){this.cu(),this.nu=0,\"Online\"===e&&(this.iu=!1),this.ou(e)}},{key:\"ou\",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:\"uu\",value:function(e){var t=\"Could not reach Cloud Firestore backend. \".concat(e,\"\\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.\");this.iu?(U(t),this.iu=!1):q(\"OnlineStateTracker\",t)}},{key:\"cu\",value:function(){null!==this.su&&(this.su.cancel(),this.su=null)}}]),e}(),oo=C(function e(t,n,r,i,a){var u=this;N(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.hu=[],this.lu=new Map,this.fu=new Set,this.du=[],this._u=a,this._u.Lr(function(e){r.enqueueAndForget(p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=ko(u),!e.t0){e.next=5;break}return q(\"RemoteStore\",\"Restarting streams for network reachability change.\"),e.next=5,function(){var e=p(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=Q(t)).fu.add(4),e.next=4,lo(n);case 4:return n.wu.set(\"Unknown\"),n.fu.delete(4),e.next=8,so(n);case 8:case\"end\":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()(u);case 5:case\"end\":return e.stop()}},e)})))}),this.wu=new uo(r,i)});function so(e){return co.apply(this,arguments)}function co(){return(co=p(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!ko(t)){e.next=18;break}n=v(t.du),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case\"end\":return e.stop()}},e,null,[[2,12,15,18]])}))).apply(this,arguments)}function lo(e){return fo.apply(this,arguments)}function fo(){return(fo=p(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=v(t.du),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case\"end\":return e.stop()}},e,null,[[1,11,14,17]])}))).apply(this,arguments)}function ho(e,t){var n=Q(e);n.lu.has(t.targetId)||(n.lu.set(t.targetId,t),go(n)?mo(n):Ho(n).xo()&&yo(n,t))}function vo(e,t){var n=Q(e),r=Ho(n);n.lu.delete(t),r.xo()&&po(n,t),0===n.lu.size&&(r.xo()?r.Mo():ko(n)&&n.wu.set(\"Unknown\"))}function yo(e,t){e.mu.Z(t.targetId),Ho(e).jo(t)}function po(e,t){e.mu.Z(t),Ho(e).Wo(t)}function mo(e){e.mu=new lr({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},Et:function(t){return e.lu.get(t)||null}}),Ho(e).start(),e.wu.ru()}function go(e){return ko(e)&&!Ho(e).Co()&&e.lu.size>0}function ko(e){return 0===Q(e).fu.size}function wo(e){e.mu=void 0}function bo(e){return xo.apply(this,arguments)}function xo(){return(xo=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.lu.forEach(function(e,n){yo(t,e)});case 1:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Io(e,t){return Eo.apply(this,arguments)}function Eo(){return(Eo=p(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:wo(t),go(t)?(t.wu.au(n),mo(t)):t.wu.set(\"Unknown\");case 1:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function To(e,t,n){return So.apply(this,arguments)}function So(){return(So=p(regeneratorRuntime.mark(function e(t,n,r){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.wu.set(\"Online\"),!(n instanceof sr&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=p(regeneratorRuntime.mark(function e(t,n){var r,i,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=v(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(u=a.value,e.t0=t.lu.has(u),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(u,r);case 10:t.lu.delete(u),t.mu.removeTarget(u);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case\"end\":return e.stop()}},e,null,[[2,16,19,22]])}));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),q(\"RemoteStore\",\"Failed to remove targets %s: %s \",n.targetIds.join(\",\"),e.t0),e.next=11,_o(t,e.t0);case 11:e.next=29;break;case 13:if(n instanceof ur?t.mu.ut(n):n instanceof or?t.mu._t(n):t.mu.ht(n),r.isEqual(he.min())){e.next=29;break}return e.prev=14,e.next=17,fu(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.mu.yt(t);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.lu.get(r);i&&e.lu.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(function(t){var n=e.lu.get(t);if(n){e.lu.set(t,n.withResumeToken(xe.EMPTY_BYTE_STRING,n.snapshotVersion)),po(e,t);var r=new Pi(n.target,t,1,n.sequenceNumber);yo(e,r)}}),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 22:e.next=29;break;case 24:return e.prev=24,e.t2=e.catch(14),q(\"RemoteStore\",\"Failed to raise snapshot:\",e.t2),e.next=29,_o(t,e.t2);case 29:case\"end\":return e.stop()}},e,null,[[1,6],[14,24]])}))).apply(this,arguments)}function _o(e,t,n){return Ao.apply(this,arguments)}function Ao(){return(Ao=p(regeneratorRuntime.mark(function e(t,n,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(_i(n)){e.next=2;break}throw n;case 2:return t.fu.add(1),e.next=5,lo(t);case 5:t.wu.set(\"Offline\"),r||(r=function(){return fu(t.localStore)}),t.asyncQueue.enqueueRetryable(p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return q(\"RemoteStore\",\"Retrying IndexedDB access\"),e.next=3,r();case 3:return t.fu.delete(1),e.next=6,so(t);case 6:case\"end\":return e.stop()}},e)})));case 8:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Do(e,t){return t().catch(function(n){return _o(e,n,t)})}function No(e){return Ro.apply(this,arguments)}function Ro(){return(Ro=p(regeneratorRuntime.mark(function e(t){var n,r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=Q(t),r=Yo(n),i=n.hu.length>0?n.hu[n.hu.length-1].batchId:-1;case 2:if(!Co(n)){e.next=19;break}return e.prev=3,e.next=6,vu(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.hu.length&&r.Mo(),e.abrupt(\"break\",19);case 10:i=a.batchId,Mo(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,_o(n,e.t0);case 17:e.next=2;break;case 19:Lo(n)&&Vo(n);case 20:case\"end\":return e.stop()}},e,null,[[3,13]])}))).apply(this,arguments)}function Co(e){return ko(e)&&e.hu.length<10}function Mo(e,t){e.hu.push(t);var n=Yo(e);n.xo()&&n.Ho&&n.Jo(t.mutations)}function Lo(e){return ko(e)&&!Yo(e).Co()&&e.hu.length>0}function Vo(e){Yo(e).start()}function Fo(e){return Po.apply(this,arguments)}function Po(){return(Po=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:Yo(t).Zo();case 1:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Oo(e){return qo.apply(this,arguments)}function qo(){return(qo=p(regeneratorRuntime.mark(function e(t){var n,r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=Yo(t),r=v(t.hu);try{for(r.s();!(i=r.n()).done;)a=i.value,n.Jo(a.mutations)}catch(u){r.e(u)}finally{r.f()}case 3:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Uo(e,t,n){return Bo.apply(this,arguments)}function Bo(){return(Bo=p(regeneratorRuntime.mark(function e(t,n,r){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.hu.shift(),a=Vi.from(i,n,r),e.next=3,Do(t,function(){return t.remoteSyncer.applySuccessfulWrite(a)});case 3:return e.next=5,No(t);case 5:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Ko(e,t){return Go.apply(this,arguments)}function Go(){return(Go=p(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&Yo(t).Ho,!e.t0){e.next=4;break}return e.next=4,function(){var e=p(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!qn(i=n.code)||i===W.ABORTED){e.next=7;break}return r=t.hu.shift(),Yo(t).ko(),e.next=5,Do(t,function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)});case 5:return e.next=7,No(t);case 7:case\"end\":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:Lo(t)&&Vo(t);case 5:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function jo(e,t){return zo.apply(this,arguments)}function zo(){return(zo=p(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(r=Q(t)).asyncQueue.verifyOperationInProgress(),q(\"RemoteStore\",\"RemoteStore received new credentials\"),i=ko(r),r.fu.add(3),e.next=6,lo(r);case 6:return i&&r.wu.set(\"Unknown\"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.fu.delete(3),e.next=12,so(r);case 12:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Qo(e,t){return Wo.apply(this,arguments)}function Wo(){return(Wo=p(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Q(t),!n){e.next=7;break}return r.fu.delete(2),e.next=5,so(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.fu.add(2),e.next=12,lo(r);case 12:r.wu.set(\"Unknown\");case 13:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Ho(e){return e.gu||(e.gu=function(e,t,n){var r=Q(e);return r.eu(),new ro(t,r.bo,r.authCredentials,r.appCheckCredentials,r.M,n)}(e.datastore,e.asyncQueue,{Hr:bo.bind(null,e),Yr:Io.bind(null,e),Qo:To.bind(null,e)}),e.du.push(function(){var t=p(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.gu.ko(),go(e)?mo(e):e.wu.set(\"Unknown\"),t.next=7;break;case 4:return t.next=6,e.gu.stop();case 6:wo(e);case 7:case\"end\":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())),e.gu}function Yo(e){return e.yu||(e.yu=function(e,t,n){var r=Q(e);return r.eu(),new io(t,r.bo,r.authCredentials,r.appCheckCredentials,r.M,n)}(e.datastore,e.asyncQueue,{Hr:Fo.bind(null,e),Yr:Ko.bind(null,e),Xo:Oo.bind(null,e),Yo:Uo.bind(null,e)}),e.du.push(function(){var t=p(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.yu.ko(),t.next=4,No(e);case 4:t.next=9;break;case 6:return t.next=8,e.yu.stop();case 8:e.hu.length>0&&(q(\"RemoteStore\",\"Stopping write stream with \".concat(e.hu.length,\" pending writes\")),e.hu=[]);case 9:case\"end\":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())),e.yu}var Xo=function(){function e(t,n,r,i,a){N(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new Y,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(e){})}return C(e,[{key:\"start\",value:function(e){var t=this;this.timerHandle=setTimeout(function(){return t.handleDelayElapsed()},e)}},{key:\"skipDelay\",value:function(){return this.handleDelayElapsed()}},{key:\"cancel\",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new H(W.CANCELLED,\"Operation cancelled\"+(e?\": \"+e:\"\"))))}},{key:\"handleDelayElapsed\",value:function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})}},{key:\"clearTimeout\",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)})}],[{key:\"createAndSchedule\",value:function(t,n,r,i,a){var u=new e(t,n,Date.now()+r,i,a);return u.start(r),u}}]),e}();function Jo(e,t){if(U(\"AsyncQueue\",\"\".concat(t,\": \").concat(e)),_i(e))return new H(W.UNAVAILABLE,\"\".concat(t,\": \").concat(e));throw e}var $o=function(){function e(t){N(this,e),this.comparator=t?function(e,n){return t(e,n)||Ve.comparator(e.key,n.key)}:function(e,t){return Ve.comparator(e.key,t.key)},this.keyedMap=Jn(),this.sortedSet=new Kn(this.comparator)}return C(e,[{key:\"has\",value:function(e){return null!=this.keyedMap.get(e)}},{key:\"get\",value:function(e){return this.keyedMap.get(e)}},{key:\"first\",value:function(){return this.sortedSet.minKey()}},{key:\"last\",value:function(){return this.sortedSet.maxKey()}},{key:\"isEmpty\",value:function(){return this.sortedSet.isEmpty()}},{key:\"indexOf\",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:\"size\",get:function(){return this.sortedSet.size}},{key:\"forEach\",value:function(e){this.sortedSet.inorderTraversal(function(t,n){return e(t),!1})}},{key:\"add\",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:\"delete\",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:\"isEqual\",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:\"toString\",value:function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?\"DocumentSet ()\":\"DocumentSet (\\n  \"+e.join(\"  \\n\")+\"\\n)\"}},{key:\"copy\",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:\"emptySet\",value:function(t){return new e(t.comparator)}}]),e}(),Zo=function(){function e(){N(this,e),this.pu=new Kn(Ve.comparator)}return C(e,[{key:\"track\",value:function(e){var t=e.doc.key,n=this.pu.get(t);n?0!==e.type&&3===n.type?this.pu=this.pu.insert(t,e):3===e.type&&1!==n.type?this.pu=this.pu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.pu=this.pu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.pu=this.pu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.pu=this.pu.remove(t):1===e.type&&2===n.type?this.pu=this.pu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.pu=this.pu.insert(t,{type:2,doc:e.doc}):G():this.pu=this.pu.insert(t,e)}},{key:\"Iu\",value:function(){var e=[];return this.pu.inorderTraversal(function(t,n){e.push(n)}),e}}]),e}(),es=function(){function e(t,n,r,i,a,u,o,s){N(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=u,this.syncStateChanged=o,this.excludesMetadataChanges=s}return C(e,[{key:\"hasPendingWrites\",get:function(){return!this.mutatedKeys.isEmpty()}},{key:\"isEqual\",value:function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Yt(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:\"fromInitialDocuments\",value:function(t,n,r,i){var a=[];return n.forEach(function(e){a.push({type:0,doc:e})}),new e(t,n,$o.emptySet(n),a,r,i,!0,!1)}}]),e}(),ts=C(function e(){N(this,e),this.Tu=void 0,this.listeners=[]}),ns=C(function e(){N(this,e),this.queries=new Bn(function(e){return Xt(e)},Yt),this.onlineState=\"Unknown\",this.Eu=new Set});function rs(e,t){return is.apply(this,arguments)}function is(){return(is=p(regeneratorRuntime.mark(function e(t,n){var r,i,a,u,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Q(t),i=n.query,a=!1,(u=r.queries.get(i))||(a=!0,u=new ts),!a){e.next=13;break}return e.prev=3,e.next=6,r.onListen(i);case 6:u.Tu=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),o=Jo(e.t0,\"Initialization of query '\".concat(Jt(n.query),\"' failed\")),e.abrupt(\"return\",void n.onError(o));case 13:r.queries.set(i,u),u.listeners.push(n),n.Au(r.onlineState),u.Tu&&n.Ru(u.Tu)&&cs(r);case 14:case\"end\":return e.stop()}},e,null,[[3,9]])}))).apply(this,arguments)}function as(e,t){return us.apply(this,arguments)}function us(){return(us=p(regeneratorRuntime.mark(function e(t,n){var r,i,a,u,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Q(t),i=n.query,a=!1,(u=r.queries.get(i))&&(o=u.listeners.indexOf(n))>=0&&(u.listeners.splice(o,1),a=0===u.listeners.length),!a){e.next=6;break}return e.abrupt(\"return\",(r.queries.delete(i),r.onUnlisten(i)));case 6:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function os(e,t){var n,r=Q(e),i=!1,a=v(t);try{for(a.s();!(n=a.n()).done;){var u=n.value,o=u.query,s=r.queries.get(o);if(s){var c,l=v(s.listeners);try{for(l.s();!(c=l.n()).done;){c.value.Ru(u)&&(i=!0)}}catch(f){l.e(f)}finally{l.f()}s.Tu=u}}}catch(f){a.e(f)}finally{a.f()}i&&cs(r)}function ss(e,t,n){var r=Q(e),i=r.queries.get(t);if(i){var a,u=v(i.listeners);try{for(u.s();!(a=u.n()).done;){a.value.onError(n)}}catch(o){u.e(o)}finally{u.f()}}r.queries.delete(t)}function cs(e){e.Eu.forEach(function(e){e.next()})}var ls=function(){function e(t,n,r){N(this,e),this.query=t,this.Pu=n,this.bu=!1,this.Vu=null,this.onlineState=\"Unknown\",this.options=r||{}}return C(e,[{key:\"Ru\",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=v(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(u){r.e(u)}finally{r.f()}e=new es(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var a=!1;return this.bu?this.vu(e)&&(this.Pu.next(e),a=!0):this.Su(e,this.onlineState)&&(this.Du(e),a=!0),this.Vu=e,a}},{key:\"onError\",value:function(e){this.Pu.error(e)}},{key:\"Au\",value:function(e){this.onlineState=e;var t=!1;return this.Vu&&!this.bu&&this.Su(this.Vu,e)&&(this.Du(this.Vu),t=!0),t}},{key:\"Su\",value:function(e,t){if(!e.fromCache)return!0;var n=\"Offline\"!==t;return!(this.options.Cu&&n||e.docs.isEmpty()&&\"Offline\"!==t)}},{key:\"vu\",value:function(e){if(e.docChanges.length>0)return!0;var t=this.Vu&&this.Vu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:\"Du\",value:function(e){e=es.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.bu=!0,this.Pu.next(e)}}]),e}(),fs=function(){function e(t,n){N(this,e),this.payload=t,this.byteLength=n}return C(e,[{key:\"xu\",value:function(){return\"metadata\"in this.payload}}]),e}(),hs=function(){function e(t){N(this,e),this.M=t}return C(e,[{key:\"fi\",value:function(e){return Ir(this.M,e)}},{key:\"di\",value:function(e){return e.metadata.exists?Dr(this.M,e.document,!1):at.newNoDocument(this.fi(e.metadata.name),this._i(e.metadata.readTime))}},{key:\"_i\",value:function(e){return kr(e)}}]),e}(),ds=function(){function e(t,n,r){N(this,e),this.Nu=t,this.localStore=n,this.M=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=vs(t)}return C(e,[{key:\"ku\",value:function(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;var n=me.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}},{key:\"Mu\",value:function(e){var t,n=new Map,r=new hs(this.M),i=v(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.metadata.queries){var u,o=r.fi(a.metadata.name),s=v(a.metadata.queries);try{for(s.s();!(u=s.n()).done;){var c=u.value,l=(n.get(c)||tr()).add(o);n.set(c,l)}}catch(f){s.e(f)}finally{s.f()}}}}catch(f){i.e(f)}finally{i.f()}return n}},{key:\"complete\",value:function(){var e=p(regeneratorRuntime.mark(function e(){var t,n,r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xu(this.localStore,new hs(this.M),this.documents,this.Nu.id);case 2:t=e.sent,n=this.Mu(this.documents),r=v(this.queries),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=13;break}return a=i.value,e.next=11,Eu(this.localStore,a,n.get(a.name));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt(\"return\",(this.progress.taskState=\"Success\",{progress:this.progress,Ou:this.collectionGroups,Fu:t}));case 22:case\"end\":return e.stop()}},e,this,[[5,15,18,21]])}));return function(){return e.apply(this,arguments)}}()}]),e}();function vs(e){return{taskState:\"Running\",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}var ys=C(function e(t){N(this,e),this.key=t}),ps=C(function e(t){N(this,e),this.key=t}),ms=function(){function e(t,n){N(this,e),this.query=t,this.$u=n,this.Bu=null,this.current=!1,this.Lu=tr(),this.mutatedKeys=tr(),this.Uu=en(t),this.qu=new $o(this.Uu)}return C(e,[{key:\"Ku\",get:function(){return this.$u}},{key:\"Gu\",value:function(e,t){var n=this,r=t?t.Qu:new Zo,i=t?t.qu:this.qu,a=t?t.mutatedKeys:this.mutatedKeys,u=i,o=!1,s=Bt(this.query)&&i.size===this.query.limit?i.last():null,c=Kt(this.query)&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(function(e,t){var l=i.get(e),f=$t(n.query,t)?t:null,h=!!l&&n.mutatedKeys.has(l.key),d=!!f&&(f.hasLocalMutations||n.mutatedKeys.has(f.key)&&f.hasCommittedMutations),v=!1;l&&f?l.data.isEqual(f.data)?h!==d&&(r.track({type:3,doc:f}),v=!0):n.ju(l,f)||(r.track({type:2,doc:f}),v=!0,(s&&n.Uu(f,s)>0||c&&n.Uu(f,c)<0)&&(o=!0)):!l&&f?(r.track({type:0,doc:f}),v=!0):l&&!f&&(r.track({type:1,doc:l}),v=!0,(s||c)&&(o=!0)),v&&(f?(u=u.add(f),a=d?a.add(e):a.delete(e)):(u=u.delete(e),a=a.delete(e)))}),Bt(this.query)||Kt(this.query))for(;u.size>this.query.limit;){var l=Bt(this.query)?u.last():u.first();u=u.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{qu:u,Qu:r,ni:o,mutatedKeys:a}}},{key:\"ju\",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:\"applyChanges\",value:function(e,t,n){var r=this,i=this.qu;this.qu=e.qu,this.mutatedKeys=e.mutatedKeys;var a=e.Qu.Iu();a.sort(function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return G()}};return n(e)-n(t)}(e.type,t.type)||r.Uu(e.doc,t.doc)}),this.Wu(n);var u=t?this.zu():[],o=0===this.Lu.size&&this.current?1:0,s=o!==this.Bu;return this.Bu=o,0!==a.length||s?{snapshot:new es(this.query,e.qu,i,a,e.mutatedKeys,0===o,s,!1),Hu:u}:{Hu:u}}},{key:\"Au\",value:function(e){return this.current&&\"Offline\"===e?(this.current=!1,this.applyChanges({qu:this.qu,Qu:new Zo,mutatedKeys:this.mutatedKeys,ni:!1},!1)):{Hu:[]}}},{key:\"Ju\",value:function(e){return!this.$u.has(e)&&!!this.qu.has(e)&&!this.qu.get(e).hasLocalMutations}},{key:\"Wu\",value:function(e){var t=this;e&&(e.addedDocuments.forEach(function(e){return t.$u=t.$u.add(e)}),e.modifiedDocuments.forEach(function(e){}),e.removedDocuments.forEach(function(e){return t.$u=t.$u.delete(e)}),this.current=e.current)}},{key:\"zu\",value:function(){var e=this;if(!this.current)return[];var t=this.Lu;this.Lu=tr(),this.qu.forEach(function(t){e.Ju(t.key)&&(e.Lu=e.Lu.add(t.key))});var n=[];return t.forEach(function(t){e.Lu.has(t)||n.push(new ps(t))}),this.Lu.forEach(function(e){t.has(e)||n.push(new ys(e))}),n}},{key:\"Yu\",value:function(e){this.$u=e.li,this.Lu=tr();var t=this.Gu(e.documents);return this.applyChanges(t,!0)}},{key:\"Xu\",value:function(){return es.fromInitialDocuments(this.query,this.qu,this.mutatedKeys,0===this.Bu)}}]),e}(),gs=C(function e(t,n,r){N(this,e),this.query=t,this.targetId=n,this.view=r}),ks=C(function e(t){N(this,e),this.key=t,this.Zu=!1}),ws=function(){function e(t,n,r,i,a,u){N(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=u,this.ta={},this.ea=new Bn(function(e){return Xt(e)},Yt),this.na=new Map,this.sa=new Set,this.ia=new Kn(Ve.comparator),this.ra=new Map,this.oa=new Au,this.ua={},this.aa=new Map,this.ca=Da.yn(),this.onlineState=\"Unknown\",this.ha=void 0}return C(e,[{key:\"isPrimaryClient\",get:function(){return!0===this.ha}}]),e}();function bs(e,t){return xs.apply(this,arguments)}function xs(){return(xs=p(regeneratorRuntime.mark(function e(t,n){var r,i,a,u,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=vc(t),!(u=r.ea.get(n))){e.next=6;break}i=u.targetId,r.sharedClientState.addLocalQueryTarget(i),a=u.view.Xu(),e.next=15;break;case 6:return e.next=8,yu(r.localStore,Wt(n));case 8:return o=e.sent,r.isPrimaryClient&&ho(r.remoteStore,o),s=r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.targetId,e.next=14,Is(r,n,i,\"current\"===s);case 14:a=e.sent;case 15:return e.abrupt(\"return\",a);case 16:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Is(e,t,n,r){return Es.apply(this,arguments)}function Es(){return(Es=p(regeneratorRuntime.mark(function e(t,n,r,i){var a,u,o,s,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.la=function(e,n,r){return(i=p(regeneratorRuntime.mark(function e(t,n,r,i){var a,u,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.Gu(r),e.t0=a.ni,!e.t0){e.next=6;break}return e.next=5,gu(t.localStore,n.query,!1).then(function(e){var t=e.documents;return n.view.Gu(t,a)});case 5:a=e.sent;case 6:return u=i&&i.targetChanges.get(n.targetId),o=n.view.applyChanges(a,t.isPrimaryClient,u),e.abrupt(\"return\",(js(t,n.targetId,o.Hu),o.snapshot));case 8:case\"end\":return e.stop()}},e)})),function(e,t,n,r){return i.apply(this,arguments)})(t,e,n,r);var i},e.next=3,gu(t.localStore,n,!0);case 3:return a=e.sent,u=new ms(n,a.li),o=u.Gu(a.documents),s=ar.createSynthesizedTargetChangeForCurrentChange(r,i&&\"Offline\"!==t.onlineState),c=u.applyChanges(o,t.isPrimaryClient,s),js(t,r,c.Hu),l=new gs(n,r,u),e.abrupt(\"return\",(t.ea.set(n,l),t.na.has(r)?t.na.get(r).push(n):t.na.set(r,[n]),c.snapshot));case 11:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Ts(e,t){return Ss.apply(this,arguments)}function Ss(){return(Ss=p(regeneratorRuntime.mark(function e(t,n){var r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Q(t),i=r.ea.get(n),!((a=r.na.get(i.targetId)).length>1)){e.next=3;break}return e.abrupt(\"return\",(r.na.set(i.targetId,a.filter(function(e){return!Yt(e,n)})),void r.ea.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),e.t0){e.next=9;break}return e.next=9,pu(r.localStore,i.targetId,!1).then(function(){r.sharedClientState.clearQueryState(i.targetId),vo(r.remoteStore,i.targetId),Ks(r,i.targetId)}).catch(La);case 9:e.next=14;break;case 11:return Ks(r,i.targetId),e.next=14,pu(r.localStore,i.targetId,!0);case 14:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function _s(e,t,n){return As.apply(this,arguments)}function As(){return(As=p(regeneratorRuntime.mark(function e(t,n,r){var i,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=yc(t),e.prev=1,e.next=4,function(e,t){var n,r=Q(e),i=fe.now(),a=t.reduce(function(e,t){return e.add(t.key)},tr());return r.persistence.runTransaction(\"Locally write mutations\",\"readwrite\",function(e){return r.ci.Ks(e,a).next(function(a){n=a;var u,o=[],s=v(t);try{for(s.s();!(u=s.n()).done;){var c=u.value,l=Sn(c,n.get(c.key));null!=l&&o.push(new Nn(c.key,l,it(l.value.mapValue),bn.exists(!0)))}}catch(f){s.e(f)}finally{s.f()}return r.Bs.addMutationBatch(e,i,o,t)})}).then(function(e){return e.applyToLocalDocumentSet(n),{batchId:e.batchId,changes:n}})}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.ua[e.currentUser.toKey()];r||(r=new Kn(se)),r=r.insert(t,n),e.ua[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,Ws(i,a.changes);case 9:return e.next=11,No(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),u=Jo(e.t0,\"Failed to persist write\"),r.reject(u);case 17:case\"end\":return e.stop()}},e,null,[[1,13]])}))).apply(this,arguments)}function Ds(e,t){return Ns.apply(this,arguments)}function Ns(){return(Ns=p(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),e.prev=1,e.next=4,hu(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach(function(e,t){var n=r.ra.get(t);n&&(j(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.Zu=!0:e.modifiedDocuments.size>0?j(n.Zu):e.removedDocuments.size>0&&(j(n.Zu),n.Zu=!1))}),e.next=8,Ws(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,La(e.t0);case 14:case\"end\":return e.stop()}},e,null,[[1,10]])}))).apply(this,arguments)}function Rs(e,t,n){var r=Q(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.ea.forEach(function(e,n){var r=n.view.Au(t);r.snapshot&&i.push(r.snapshot)}),function(e,t){var n=Q(e);n.onlineState=t;var r=!1;n.queries.forEach(function(e,n){var i,a=v(n.listeners);try{for(a.s();!(i=a.n()).done;){i.value.Au(t)&&(r=!0)}}catch(u){a.e(u)}finally{a.f()}}),r&&cs(n)}(r.eventManager,t),i.length&&r.ta.Qo(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Cs(e,t,n){return Ms.apply(this,arguments)}function Ms(){return(Ms=p(regeneratorRuntime.mark(function e(t,n,r){var i,a,u,o,s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((i=Q(t)).sharedClientState.updateQueryState(n,\"rejected\",r),a=i.ra.get(n),!(u=a&&a.key)){e.next=14;break}return o=(o=new Kn(Ve.comparator)).insert(u,at.newNoDocument(u,he.min())),s=tr().add(u),c=new ir(he.min(),new Map,new zn(se),o,s),e.next=9,Ds(i,c);case 9:i.ia=i.ia.remove(u),i.ra.delete(n),Qs(i),e.next=16;break;case 14:return e.next=16,pu(i.localStore,n,!1).then(function(){return Ks(i,n,r)}).catch(La);case 16:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Ls(e,t){return Vs.apply(this,arguments)}function Vs(){return(Vs=p(regeneratorRuntime.mark(function e(t,n){var r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),i=n.batch.batchId,e.prev=1,e.next=4,lu(r.localStore,n);case 4:return a=e.sent,Bs(r,i,null),Us(r,i),r.sharedClientState.updateMutationState(i,\"acknowledged\"),e.next=10,Ws(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,La(e.t0);case 16:case\"end\":return e.stop()}},e,null,[[1,12]])}))).apply(this,arguments)}function Fs(e,t,n){return Ps.apply(this,arguments)}function Ps(){return(Ps=p(regeneratorRuntime.mark(function e(t,n,r){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=Q(t),e.prev=1,e.next=4,function(e,t){var n=Q(e);return n.persistence.runTransaction(\"Reject batch\",\"readwrite-primary\",function(e){var r;return n.Bs.lookupMutationBatch(e,t).next(function(t){return j(null!==t),r=t.keys(),n.Bs.removeMutationBatch(e,t)}).next(function(){return n.Bs.performConsistencyCheck(e)}).next(function(){return n.ci.Ks(e,r)})})}(i.localStore,n);case 4:return a=e.sent,Bs(i,n,r),Us(i,n),i.sharedClientState.updateMutationState(n,\"rejected\",r),e.next=10,Ws(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,La(e.t0);case 16:case\"end\":return e.stop()}},e,null,[[1,12]])}))).apply(this,arguments)}function Os(e,t){return qs.apply(this,arguments)}function qs(){return(qs=p(regeneratorRuntime.mark(function e(t,n){var r,i,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ko((r=Q(t)).remoteStore)||q(\"SyncEngine\",\"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.\"),e.prev=2,e.next=5,function(e){var t=Q(r.localStore);return t.persistence.runTransaction(\"Get highest unacknowledged batch id\",\"readonly\",function(e){return t.Bs.getHighestUnacknowledgedBatchId(e)})}();case 5:if(-1!==(i=e.sent)){e.next=8;break}return e.abrupt(\"return\",void n.resolve());case 8:(a=r.aa.get(i)||[]).push(n),r.aa.set(i,a),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),u=Jo(e.t0,\"Initialization of waitForPendingWrites() operation failed\"),n.reject(u);case 16:case\"end\":return e.stop()}},e,null,[[2,12]])}))).apply(this,arguments)}function Us(e,t){(e.aa.get(t)||[]).forEach(function(e){e.resolve()}),e.aa.delete(t)}function Bs(e,t,n){var r=Q(e),i=r.ua[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.ua[r.currentUser.toKey()]=i}}function Ks(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=v(e.na.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.ea.delete(a),n&&e.ta.fa(a,n)}}catch(u){i.e(u)}finally{i.f()}e.na.delete(t),e.isPrimaryClient&&e.oa.Pi(t).forEach(function(t){e.oa.containsKey(t)||Gs(e,t)})}function Gs(e,t){e.sa.delete(t.path.canonicalString());var n=e.ia.get(t);null!==n&&(vo(e.remoteStore,n),e.ia=e.ia.remove(t),e.ra.delete(n),Qs(e))}function js(e,t,n){var r,i=v(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof ys?(e.oa.addReference(a.key,t),zs(e,a)):a instanceof ps?(q(\"SyncEngine\",\"Document no longer in limbo: \"+a.key),e.oa.removeReference(a.key,t),e.oa.containsKey(a.key)||Gs(e,a.key)):G()}}catch(u){i.e(u)}finally{i.f()}}function zs(e,t){var n=t.key,r=n.path.canonicalString();e.ia.get(n)||e.sa.has(r)||(q(\"SyncEngine\",\"New document in limbo: \"+n),e.sa.add(r),Qs(e))}function Qs(e){for(;e.sa.size>0&&e.ia.size<e.maxConcurrentLimboResolutions;){var t=e.sa.values().next().value;e.sa.delete(t);var n=new Ve(me.fromString(t)),r=e.ca.next();e.ra.set(r,new ks(n)),e.ia=e.ia.insert(n,r),ho(e.remoteStore,new Pi(Wt(Ut(n.path)),r,2,ae.A))}}function Ws(e,t,n){return Hs.apply(this,arguments)}function Hs(){return(Hs=p(regeneratorRuntime.mark(function e(t,n,r){var i,a,u,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Q(t),a=[],u=[],o=[],e.t0=i.ea.isEmpty(),e.t0){e.next=9;break}return i.ea.forEach(function(e,t){o.push(i.la(t,n,r).then(function(e){if(e){i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,e.fromCache?\"not-current\":\"current\"),a.push(e);var n=iu.Ys(t.targetId,e);u.push(n)}}))}),e.next=6,Promise.all(o);case 6:return i.ta.Qo(a),e.next=9,function(){var e=p(regeneratorRuntime.mark(function e(t,n){var r,i,a,u,o,s,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),e.prev=1,e.next=4,r.persistence.runTransaction(\"notifyLocalViewChanges\",\"readwrite\",function(e){return xi.forEach(n,function(t){return xi.forEach(t.Hs,function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)}).next(function(){return xi.forEach(t.Js,function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)})})})});case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),_i(e.t0)){e.next=10;break}throw e.t0;case 10:q(\"LocalStore\",\"Failed to update sequence numbers: \"+e.t0);case 11:i=v(n);try{for(i.s();!(a=i.n()).done;)u=a.value,o=u.targetId,u.fromCache||(s=r.ii.get(o),c=s.snapshotVersion,l=s.withLastLimboFreeSnapshotVersion(c),r.ii=r.ii.insert(o,l))}catch(f){i.e(f)}finally{i.f()}case 13:case\"end\":return e.stop()}},e,null,[[1,6]])}));return function(t,n){return e.apply(this,arguments)}}()(i.localStore,u);case 9:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Ys(e,t){return Xs.apply(this,arguments)}function Xs(){return(Xs=p(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=Q(t)).currentUser.isEqual(n)){e.next=11;break}return q(\"SyncEngine\",\"User change. New user:\",n.toKey()),e.next=5,su(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.aa.forEach(function(e){e.forEach(function(e){e.reject(new H(W.CANCELLED,\"'waitForPendingWrites' promise is rejected due to a user change.\"))})}),e.aa.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,Ws(r,i.hi);case 11:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Js(e,t){var n=Q(e),r=n.ra.get(t);if(r&&r.Zu)return tr().add(r.key);var i=tr(),a=n.na.get(t);if(!a)return i;var u,o=v(a);try{for(o.s();!(u=o.n()).done;){var s=u.value,c=n.ea.get(s);i=i.unionWith(c.view.Ku)}}catch(l){o.e(l)}finally{o.f()}return i}function $s(e,t){return Zs.apply(this,arguments)}function Zs(){return(Zs=p(regeneratorRuntime.mark(function e(t,n){var r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),e.next=3,gu(r.localStore,n.query,!0);case 3:return i=e.sent,a=n.view.Yu(i),e.abrupt(\"return\",(r.isPrimaryClient&&js(r,n.targetId,a.Hu),a));case 6:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function ec(e,t){return tc.apply(this,arguments)}function tc(){return(tc=p(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),e.abrupt(\"return\",wu(r.localStore,n).then(function(e){return Ws(r,e)}));case 2:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function nc(e,t,n,r){return rc.apply(this,arguments)}function rc(){return(rc=p(regeneratorRuntime.mark(function e(t,n,r,i){var a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=Q(t),e.next=3,function(e,t){var n=Q(e),r=Q(n.Bs);return n.persistence.runTransaction(\"Lookup mutation documents\",\"readonly\",function(e){return r.fn(e,t).next(function(t){return t?n.ci.Ks(e,t):xi.resolve(null)})})}(a.localStore,n);case 3:if(null===(u=e.sent)){e.next=15;break}if(\"pending\"!==r){e.next=10;break}return e.next=8,No(a.remoteStore);case 8:e.next=11;break;case 10:\"acknowledged\"===r||\"rejected\"===r?(Bs(a,n,i||null),Us(a,n),function(e,t){Q(Q(e).Bs)._n(t)}(a.localStore,n)):G();case 11:return e.next=13,Ws(a,u);case 13:e.next=16;break;case 15:q(\"SyncEngine\",\"Cannot apply mutation batch with id: \"+n);case 16:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function ic(e,t){return ac.apply(this,arguments)}function ac(){return(ac=p(regeneratorRuntime.mark(function e(t,n){var r,i,a,u,o,s,c,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(vc(r=Q(t)),yc(r),!0!==n||!0===r.ha){e.next=13;break}return i=r.sharedClientState.getAllActiveQueryTargets(),e.next=5,uc(r,i.toArray());case 5:return a=e.sent,r.ha=!0,e.next=9,Qo(r.remoteStore,!0);case 9:u=v(a);try{for(u.s();!(o=u.n()).done;)s=o.value,ho(r.remoteStore,s)}catch(f){u.e(f)}finally{u.f()}e.next=25;break;case 13:if(!1!==n||!1===r.ha){e.next=25;break}return c=[],l=Promise.resolve(),r.na.forEach(function(e,t){r.sharedClientState.isLocalQueryTarget(t)?c.push(t):l=l.then(function(){return Ks(r,t),pu(r.localStore,t,!0)}),vo(r.remoteStore,t)}),e.next=19,l;case 19:return e.next=21,uc(r,c);case 21:return function(e){var t=Q(r);t.ra.forEach(function(e,n){vo(t.remoteStore,n)}),t.oa.bi(),t.ra=new Map,t.ia=new Kn(Ve.comparator)}(),r.ha=!1,e.next=25,Qo(r.remoteStore,!1);case 25:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function uc(e,t,n){return oc.apply(this,arguments)}function oc(){return(oc=p(regeneratorRuntime.mark(function e(t,n,r){var i,a,u,o,s,c,l,f,h,d,y,p,m,g;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=Q(t),a=[],u=[],o=v(n),e.prev=2,o.s();case 4:if((s=o.n()).done){e.next=45;break}if(c=s.value,l=void 0,!(f=i.na.get(c))||0===f.length){e.next=34;break}return e.next=11,yu(i.localStore,Wt(f[0]));case 11:l=e.sent,h=v(f),e.prev=13,h.s();case 15:if((d=h.n()).done){e.next=24;break}return y=d.value,p=i.ea.get(y),e.next=20,$s(i,p);case 20:(m=e.sent).snapshot&&u.push(m.snapshot);case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),h.e(e.t0);case 29:return e.prev=29,h.f(),e.finish(29);case 32:e.next=42;break;case 34:return e.next=36,ku(i.localStore,c);case 36:return g=e.sent,e.next=39,yu(i.localStore,g);case 39:return l=e.sent,e.next=42,Is(i,sc(g),c,!1);case 42:a.push(l);case 43:e.next=4;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(2),o.e(e.t1);case 50:return e.prev=50,o.f(),e.finish(50);case 53:return e.abrupt(\"return\",(i.ta.Qo(u),a));case 54:case\"end\":return e.stop()}},e,null,[[2,47,50,53],[13,26,29,32]])}))).apply(this,arguments)}function sc(e){return qt(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,\"F\",e.startAt,e.endAt)}function cc(e){var t=Q(e);return Q(Q(t.localStore).persistence).Fs()}function lc(e,t,n,r){return fc.apply(this,arguments)}function fc(){return(fc=p(regeneratorRuntime.mark(function e(t,n,r,i){var a,u,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=Q(t)).ha){e.next=3;break}return e.abrupt(\"return\",void q(\"SyncEngine\",\"Ignoring unexpected query state notification.\"));case 3:if(!((u=a.na.get(n))&&u.length>0)){e.next=20;break}e.t0=r,e.next=\"current\"===e.t0?8:\"not-current\"===e.t0?8:\"rejected\"===e.t0?15:19;break;case 8:return e.next=10,wu(a.localStore,Zt(u[0]));case 10:return o=e.sent,s=ir.createSynthesizedRemoteEventForCurrentChange(n,\"current\"===r),e.next=14,Ws(a,o,s);case 14:return e.abrupt(\"break\",20);case 15:return e.next=17,pu(a.localStore,n,!0);case 17:return Ks(a,n,i),e.abrupt(\"break\",20);case 19:G();case 20:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function hc(e,t,n){return dc.apply(this,arguments)}function dc(){return(dc=p(regeneratorRuntime.mark(function e(t,n,r){var i,a,u,o,s,c,l,f,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=vc(t)).ha){e.next=45;break}a=v(n),e.prev=3,a.s();case 5:if((u=a.n()).done){e.next=21;break}if(o=u.value,!i.na.has(o)){e.next=10;break}return q(\"SyncEngine\",\"Adding an already active target \"+o),e.abrupt(\"continue\",19);case 10:return e.next=12,ku(i.localStore,o);case 12:return s=e.sent,e.next=15,yu(i.localStore,s);case 15:return c=e.sent,e.next=18,Is(i,sc(s),c.targetId,!1);case 18:ho(i.remoteStore,c);case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),a.e(e.t0);case 26:return e.prev=26,a.f(),e.finish(26);case 29:l=v(r),e.prev=30,h=regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,e.t0=i.na.has(t),!e.t0){e.next=5;break}return e.next=5,pu(i.localStore,t,!1).then(function(){vo(i.remoteStore,t),Ks(i,t)}).catch(La);case 5:case\"end\":return e.stop()}},e)}),l.s();case 33:if((f=l.n()).done){e.next=37;break}return e.delegateYield(h(),\"t1\",35);case 35:e.next=33;break;case 37:e.next=42;break;case 39:e.prev=39,e.t2=e.catch(30),l.e(e.t2);case 42:return e.prev=42,l.f(),e.finish(42);case 45:case\"end\":return e.stop()}},e,null,[[3,23,26,29],[30,39,42,45]])}))).apply(this,arguments)}function vc(e){var t=Q(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ds.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Js.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Cs.bind(null,t),t.ta.Qo=os.bind(null,t.eventManager),t.ta.fa=ss.bind(null,t.eventManager),t}function yc(e){var t=Q(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Ls.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Fs.bind(null,t),t}function pc(e,t,n){var r,i=Q(e);(r=p(regeneratorRuntime.mark(function e(t,n,r){var i,a,u,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getMetadata();case 3:return i=e.sent,e.next=6,function(e,t){var n=Q(e),r=kr(t.createTime);return n.persistence.runTransaction(\"hasNewerBundle\",\"readonly\",function(e){return n._s.getBundleMetadata(e,t.id)}).then(function(e){return!!e&&e.createTime.compareTo(r)>=0})}(t.localStore,i);case 6:if(!e.sent){e.next=11;break}return e.next=9,n.close();case 9:return r._completeWith(function(e){return{taskState:\"Success\",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(i)),e.abrupt(\"return\",Promise.resolve(new Set));case 11:return r._updateProgress(vs(i)),a=new ds(i,t.localStore,n.M),e.next=15,n.da();case 15:u=e.sent;case 16:if(!u){e.next=26;break}return e.next=19,a.ku(u);case 19:return(o=e.sent)&&r._updateProgress(o),e.next=23,n.da();case 23:u=e.sent;case 24:e.next=16;break;case 26:return e.next=28,a.complete();case 28:return s=e.sent,e.next=31,Ws(t,s.Fu,void 0);case 31:return e.next=33,function(e,t){var n=Q(e);return n.persistence.runTransaction(\"Save bundle\",\"readwrite\",function(e){return n._s.saveBundleMetadata(e,t)})}(t.localStore,i);case 33:return r._completeWith(s.progress),e.abrupt(\"return\",Promise.resolve(s.Ou));case 37:return e.prev=37,e.t0=e.catch(0),e.abrupt(\"return\",(B(\"SyncEngine\",\"Loading bundle failed with \".concat(e.t0)),r._failWith(e.t0),Promise.resolve(new Set)));case 40:case\"end\":return e.stop()}},e,null,[[0,37]])})),function(e,t,n){return r.apply(this,arguments)})(i,t,n).then(function(e){i.sharedClientState.notifyBundleLoaded(e)})}var mc=function(){function e(){N(this,e),this.synchronizeTabs=!1}return C(e,[{key:\"initialize\",value:function(){var e=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.M=eo(t.databaseInfo.databaseId),this.sharedClientState=this._a(t),this.persistence=this.wa(t),e.next=5,this.persistence.start();case 5:this.gcScheduler=this.ma(t),this.localStore=this.ga(t);case 7:case\"end\":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:\"ma\",value:function(e){return null}},{key:\"ga\",value:function(e){return ou(this.persistence,new au,e.initialUser,this.M)}},{key:\"wa\",value:function(e){return new Lu(Fu.zi,this.M)}},{key:\"_a\",value:function(e){return new Qu}},{key:\"terminate\",value:function(){var e=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),e.next=3,this.sharedClientState.shutdown();case 3:return e.next=5,this.persistence.shutdown();case 5:case\"end\":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),gc=function(e){m(n,mc);var t=k(n);function n(e,r,i){var a;return N(this,n),(a=t.call(this)).ya=e,a.cacheSizeBytes=r,a.forceOwnership=i,a.synchronizeTabs=!1,a}return C(n,[{key:\"initialize\",value:function(){var e=p(regeneratorRuntime.mark(function e(t){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o(I(n.prototype),\"initialize\",this).call(this,t);case 2:return e.next=4,this.ya.initialize(this,t);case 4:return e.next=6,yc(this.ya.syncEngine);case 6:return e.next=8,No(this.ya.remoteStore);case 8:return e.next=10,this.persistence.Ts(function(){return r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(r.localStore),Promise.resolve()});case 10:case\"end\":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:\"ga\",value:function(e){return ou(this.persistence,new au,e.initialUser,this.M)}},{key:\"ma\",value:function(e){var t=this.persistence.referenceDelegate.garbageCollector;return new Oa(t,e.asyncQueue)}},{key:\"wa\",value:function(e){var t=nu(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ba.withCacheSize(this.cacheSizeBytes):ba.DEFAULT;return new Za(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,$u(),Zu(),this.M,this.sharedClientState,!!this.forceOwnership)}},{key:\"_a\",value:function(e){return new Qu}}]),n}(),kc=function(e){m(n,gc);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this,e,r,!1)).ya=e,i.cacheSizeBytes=r,i.synchronizeTabs=!0,i}return C(n,[{key:\"initialize\",value:function(){var e=p(regeneratorRuntime.mark(function e(t){var r,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o(I(n.prototype),\"initialize\",this).call(this,t);case 2:if(r=this.ya.syncEngine,e.t0=this.sharedClientState instanceof zu,!e.t0){e.next=8;break}return this.sharedClientState.syncEngine={Mr:nc.bind(null,r),Or:lc.bind(null,r),Fr:hc.bind(null,r),Fs:cc.bind(null,r),kr:ec.bind(null,r)},e.next=8,this.sharedClientState.start();case 8:return e.next=10,this.persistence.Ts(function(){var e=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ic(i.ya.syncEngine,t);case 2:i.gcScheduler&&(t&&!i.gcScheduler.started?i.gcScheduler.start(i.localStore):t||i.gcScheduler.stop());case 3:case\"end\":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());case 10:case\"end\":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:\"_a\",value:function(e){var t=$u();if(!zu.vt(t))throw new H(W.UNIMPLEMENTED,\"IndexedDB persistence is only available on platforms that support LocalStorage.\");var n=nu(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new zu(t,e.asyncQueue,n,e.clientId,e.initialUser)}}]),n}(),wc=function(){function e(){N(this,e)}return C(e,[{key:\"initialize\",value:function(){var e=p(regeneratorRuntime.mark(function e(t,n){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return Rs(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Ys.bind(null,this.syncEngine),e.next=12,Qo(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case\"end\":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:\"createEventManager\",value:function(e){return new ns}},{key:\"createDatastore\",value:function(e){var t,n=eo(e.databaseInfo.databaseId),r=(t=e.databaseInfo,new Ju(t));return function(e,t,n,r){return new ao(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,r,n)}},{key:\"createRemoteStore\",value:function(e){var t,n,r,i,a,u=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return Rs(u.syncEngine,e,0)},a=Hu.vt()?new Hu:new Wu,new oo(t,n,r,i,a)}},{key:\"createSyncEngine\",value:function(e,t){return function(e,t,n,r,i,a,u){var o=new ws(e,t,n,r,i,a);return u&&(o.ha=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:\"terminate\",value:function(){return(e=p(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Q(t),q(\"RemoteStore\",\"RemoteStore shutting down.\"),n.fu.add(5),e.next=5,lo(n);case 5:n._u.shutdown(),n.wu.set(\"Unknown\");case 7:case\"end\":return e.stop()}},e)})),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}]),e}();function bc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{read:function(){return p(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n<e.byteLength)){r.next=3;break}return i={value:e.slice(n,n+t),done:!1},r.abrupt(\"return\",(n+=t,i));case 3:return r.abrupt(\"return\",{done:!0});case 4:case\"end\":return r.stop()}},r)}))()},cancel:function(){return p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case\"end\":return e.stop()}},e)}))()},releaseLock:function(){},closed:Promise.reject(\"unimplemented\")}}var xc=function(){function e(t){N(this,e),this.observer=t,this.muted=!1}return C(e,[{key:\"next\",value:function(e){this.observer.next&&this.pa(this.observer.next,e)}},{key:\"error\",value:function(e){this.observer.error?this.pa(this.observer.error,e):console.error(\"Uncaught Error in snapshot listener:\",e)}},{key:\"Ia\",value:function(){this.muted=!0}},{key:\"pa\",value:function(e,t){var n=this;this.muted||setTimeout(function(){n.muted||e(t)},0)}}]),e}(),Ic=function(){function e(t,n){var r=this;N(this,e),this.Ta=t,this.M=n,this.metadata=new Y,this.buffer=new Uint8Array,this.Ea=new TextDecoder(\"utf-8\"),this.Aa().then(function(e){e&&e.xu()?r.metadata.resolve(e.payload.metadata):r.metadata.reject(new Error(\"The first element of the bundle is not a metadata, it is\\n             \".concat(JSON.stringify(null==e?void 0:e.payload))))},function(e){return r.metadata.reject(e)})}return C(e,[{key:\"close\",value:function(){return this.Ta.cancel()}},{key:\"getMetadata\",value:function(){var e=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",this.metadata.promise);case 1:case\"end\":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:\"da\",value:function(){var e=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata();case 2:return e.abrupt(\"return\",this.Aa());case 3:case\"end\":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:\"Aa\",value:function(){var e=p(regeneratorRuntime.mark(function e(){var t,n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Ra();case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt(\"return\",null);case 5:return n=this.Ea.decode(t),r=Number(n),isNaN(r)&&this.Pa(\"length string (\".concat(n,\") is not valid number\")),e.next=9,this.ba(r);case 9:return i=e.sent,e.abrupt(\"return\",new fs(JSON.parse(i),t.length+r));case 11:case\"end\":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:\"Va\",value:function(){return this.buffer.findIndex(function(e){return e===\"{\".charCodeAt(0)})}},{key:\"Ra\",value:function(){var e=p(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.Va()<0)){e.next=7;break}return e.next=3,this.va();case 3:if(!e.sent){e.next=5;break}return e.abrupt(\"break\",7);case 5:e.next=0;break;case 7:if(0!==this.buffer.length){e.next=9;break}return e.abrupt(\"return\",null);case 9:return(t=this.Va())<0&&this.Pa(\"Reached the end of bundle when a length string is expected.\"),n=this.buffer.slice(0,t),e.abrupt(\"return\",(this.buffer=this.buffer.slice(t),n));case 13:case\"end\":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:\"ba\",value:function(){var e=p(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length<t)){e.next=8;break}return e.next=3,this.va();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.Pa(\"Reached the end of bundle when more is expected.\");case 6:e.next=0;break;case 8:return n=this.Ea.decode(this.buffer.slice(0,t)),e.abrupt(\"return\",(this.buffer=this.buffer.slice(t),n));case 10:case\"end\":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:\"Pa\",value:function(e){throw this.Ta.cancel(),new Error(\"Invalid bundle format: \".concat(e))}},{key:\"va\",value:function(){var e=p(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Ta.read();case 2:return(t=e.sent).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),e.abrupt(\"return\",t.done);case 5:case\"end\":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),e}(),Ec=function(){function e(t){N(this,e),this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return C(e,[{key:\"lookup\",value:function(){var e=p(regeneratorRuntime.mark(function e(t){var n,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!(this.mutations.length>0)){e.next=2;break}throw new H(W.INVALID_ARGUMENT,\"Firestore transactions require all reads to be executed before all writes.\");case 2:return e.next=4,function(){var e=p(regeneratorRuntime.mark(function e(t,n){var r,i,a,u,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),i=Sr(r.M)+\"/documents\",a={documents:n.map(function(e){return xr(r.M,e)})},e.next=5,r.ho(\"BatchGetDocuments\",i,a);case 5:return u=e.sent,o=new Map,u.forEach(function(e){var t=Nr(r.M,e);o.set(t.key.toString(),t)}),s=[],e.abrupt(\"return\",(n.forEach(function(e){var t=o.get(e.toString());j(!!t),s.push(t)}),s));case 10:case\"end\":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,t);case 4:return n=e.sent,e.abrupt(\"return\",(n.forEach(function(e){return r.recordVersion(e)}),n));case 6:case\"end\":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:\"set\",value:function(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:\"update\",value:function(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}},{key:\"delete\",value:function(e){this.write(new Fn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:\"commit\",value:function(){var e=p(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!this.lastWriteError){e.next=2;break}throw this.lastWriteError;case 2:return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(e,t){var r=Ve.fromPath(t);n.mutations.push(new Pn(r,n.precondition(r)))}),e.next=7,function(){var e=p(regeneratorRuntime.mark(function e(t,n){var r,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=Q(t),i=Sr(r.M)+\"/documents\",a={writes:n.map(function(e){return Cr(r.M,e)})},e.next=3,r.oo(\"Commit\",i,a);case 3:case\"end\":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,this.mutations);case 7:this.committed=!0;case 8:case\"end\":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:\"recordVersion\",value:function(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw G();t=he.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new H(W.ABORTED,\"Document version changed between two reads.\")}else this.readVersions.set(e.key.toString(),t)}},{key:\"precondition\",value:function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?bn.updateTime(t):bn.none()}},{key:\"preconditionForUpdate\",value:function(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(he.min()))throw new H(W.INVALID_ARGUMENT,\"Can't update a document that doesn't exist.\");return bn.updateTime(t)}return bn.exists(!0)}},{key:\"write\",value:function(e){this.ensureCommitNotCalled(),this.mutations.push(e)}},{key:\"ensureCommitNotCalled\",value:function(){}}]),e}(),Tc=function(){function e(t,n,r,i){N(this,e),this.asyncQueue=t,this.datastore=n,this.updateFunction=r,this.deferred=i,this.Sa=5,this.Do=new to(this.asyncQueue,\"transaction_retry\")}return C(e,[{key:\"run\",value:function(){this.Sa-=1,this.Da()}},{key:\"Da\",value:function(){var e=this;this.Do.To(p(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=new Ec(e.datastore),(r=e.Ca(n))&&r.then(function(t){e.asyncQueue.enqueueAndForget(function(){return n.commit().then(function(){e.deferred.resolve(t)}).catch(function(t){e.xa(t)})})}).catch(function(t){e.xa(t)});case 2:case\"end\":return t.stop()}},t)})))}},{key:\"Ca\",value:function(e){try{var t=this.updateFunction(e);return!Ce(t)&&t.catch&&t.then?t:(this.deferred.reject(Error(\"Transaction callback must return a Promise\")),null)}catch(e){return this.deferred.reject(e),null}}},{key:\"xa\",value:function(e){var t=this;this.Sa>0&&this.Na(e)?(this.Sa-=1,this.asyncQueue.enqueueAndForget(function(){return t.Da(),Promise.resolve()})):this.deferred.reject(e)}},{key:\"Na\",value:function(e){if(\"FirebaseError\"===e.name){var t=e.code;return\"aborted\"===t||\"failed-precondition\"===t||!qn(t)}return!1}}]),e}(),Sc=function(){function e(t,n,r,i){var a=this;N(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=L.UNAUTHENTICATED,this.clientId=oe.R(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,function(){var e=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return q(\"FirestoreClient\",\"Received user=\",t.uid),e.next=3,a.authCredentialListener(t);case 3:a.user=t;case 4:case\"end\":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(r,function(e){return q(\"FirestoreClient\",\"Received new app check token=\",e),a.appCheckCredentialListener(e,a.user)})}return C(e,[{key:\"getConfiguration\",value:function(){var e=p(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt(\"return\",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case\"end\":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:\"setCredentialChangeListener\",value:function(e){this.authCredentialListener=e}},{key:\"setAppCheckTokenChangeListener\",value:function(e){this.appCheckCredentialListener=e}},{key:\"verifyNotTerminated\",value:function(){if(this.asyncQueue.isShuttingDown)throw new H(W.FAILED_PRECONDITION,\"The client has already been terminated.\")}},{key:\"terminate\",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new Y;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(p(regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e.onlineComponents,!n.t0){n.next=5;break}return n.next=5,e.onlineComponents.terminate();case 5:if(n.t1=e.offlineComponents,!n.t1){n.next=9;break}return n.next=9,e.offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=Jo(n.t2,\"Failed to shutdown persistence\"),t.reject(r);case 18:case\"end\":return n.stop()}},n,null,[[0,14]])}))),t.promise}}]),e}();function _c(e,t){return Ac.apply(this,arguments)}function Ac(){return(Ac=p(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),q(\"FirestoreClient\",\"Initializing OfflineComponentProvider\"),e.next=3,t.getConfiguration();case 3:return r=e.sent,e.next=6,n.initialize(r);case 6:i=r.initialUser,t.setCredentialChangeListener(function(){var e=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,su(n.localStore,t);case 4:i=t;case 5:case\"end\":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=n;case 8:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Dc(e,t){return Nc.apply(this,arguments)}function Nc(){return(Nc=p(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,Rc(t);case 3:return r=e.sent,q(\"FirestoreClient\",\"Initializing OnlineComponentProvider\"),e.next=7,t.getConfiguration();case 7:return i=e.sent,e.next=10,n.initialize(r,i);case 10:t.setCredentialChangeListener(function(e){return jo(n.remoteStore,e)}),t.setAppCheckTokenChangeListener(function(e,t){return jo(n.remoteStore,t)}),t.onlineComponents=n;case 13:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Rc(e){return Cc.apply(this,arguments)}function Cc(){return(Cc=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.offlineComponents,e.t0){e.next=5;break}return q(\"FirestoreClient\",\"Using default OfflineComponentProvider\"),e.next=5,_c(t,new mc);case 5:return e.abrupt(\"return\",t.offlineComponents);case 6:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Mc(e){return Lc.apply(this,arguments)}function Lc(){return(Lc=p(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.onlineComponents,e.t0){e.next=5;break}return q(\"FirestoreClient\",\"Using default OnlineComponentProvider\"),e.next=5,Dc(t,new wc);case 5:return e.abrupt(\"return\",t.onlineComponents);case 6:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Vc(e){return Rc(e).then(function(e){return e.persistence})}function Fc(e){return Rc(e).then(function(e){return e.localStore})}function Pc(e){return Mc(e).then(function(e){return e.remoteStore})}function Oc(e){return Mc(e).then(function(e){return e.syncEngine})}function qc(e){return Uc.apply(this,arguments)}function Uc(){return(Uc=p(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Mc(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt(\"return\",(r.onListen=bs.bind(null,n.syncEngine),r.onUnlisten=Ts.bind(null,n.syncEngine),r));case 5:case\"end\":return e.stop()}},e)}))).apply(this,arguments)}function Bc(e){return e.asyncQueue.enqueue(p(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Vc(e);case 2:return n=t.sent,t.next=5,Pc(e);case 5:return r=t.sent,t.abrupt(\"return\",(n.setNetworkEnabled(!0),function(e){var t=Q(r);return t.fu.delete(0),so(t)}()));case 7:case\"end\":return t.stop()}},t)})))}function Kc(e){return e.asyncQueue.enqueue(p(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Vc(e);case 2:return n=t.sent,t.next=5,Pc(e);case 5:return r=t.sent,t.abrupt(\"return\",(n.setNetworkEnabled(!1),function(){var e=p(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=Q(t)).fu.add(0),e.next=4,lo(n);case 4:n.wu.set(\"Offline\");case 5:case\"end\":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()(r)));case 7:case\"end\":return t.stop()}},t)})))}function Gc(e,t){var n=new Y;return e.asyncQueue.enqueueAndForget(p(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=p(regeneratorRuntime.mark(function e(t,n,r){var i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,function(e,t){var n=Q(e);return n.persistence.runTransaction(\"read document\",\"readonly\",function(e){return n.ci.Ls(e,t)})}(t,n);case 3:(i=e.sent).isFoundDocument()?r.resolve(i):i.isNoDocument()?r.resolve(null):r.reject(new H(W.UNAVAILABLE,\"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)\")),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a=Jo(e.t0,\"Failed to get document '\".concat(n,\" from cache\")),r.reject(a);case 11:case\"end\":return e.stop()}},e,null,[[0,7]])}));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Fc(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt(\"return\",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case\"end\":return r.stop()}},r)}))),n.promise}function jc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new Y;return e.asyncQueue.enqueueAndForget(p(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new xc({next:function(a){t.enqueueAndForget(function(){return as(e,u)});var o=a.docs.has(n);!o&&a.fromCache?i.reject(new H(W.UNAVAILABLE,\"Failed to get document because the client is offline.\")):o&&a.fromCache&&r&&\"server\"===r.source?i.reject(new H(W.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to \"server\" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),u=new ls(Ut(n.path),a,{includeMetadataChanges:!0,Cu:!0});return rs(e,u)},i.next=3,qc(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt(\"return\",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case\"end\":return i.stop()}},i)}))),r.promise}function zc(e,t){var n=new Y;return e.asyncQueue.enqueueAndForget(p(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=p(regeneratorRuntime.mark(function e(t,n,r){var i,a,u,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,gu(t,n,!0);case 3:i=e.sent,a=new ms(n,i.li),u=a.Gu(i.documents),o=a.applyChanges(u,!1),r.resolve(o.snapshot),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),s=Jo(e.t0,\"Failed to execute query '\".concat(n,\" against cache\")),r.reject(s);case 14:case\"end\":return e.stop()}},e,null,[[0,10]])}));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Fc(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt(\"return\",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case\"end\":return r.stop()}},r)}))),n.promise}function Qc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new Y;return e.asyncQueue.enqueueAndForget(p(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new xc({next:function(n){t.enqueueAndForget(function(){return as(e,u)}),n.fromCache&&\"server\"===r.source?i.reject(new H(W.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to \"server\" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),u=new ls(n,a,{includeMetadataChanges:!0,Cu:!0});return rs(e,u)},i.next=3,qc(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt(\"return\",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case\"end\":return i.stop()}},i)}))),r.promise}function Wc(e,t){var n=new xc(t);return e.asyncQueue.enqueueAndForget(p(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){Q(e).Eu.add(t),t.next()},t.next=3,qc(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt(\"return\",(0,t.t0)(t.t1,t.t2));case 6:case\"end\":return t.stop()}},t)}))),function(){n.Ia(),e.asyncQueue.enqueueAndForget(p(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){Q(e).Eu.delete(t)},t.next=3,qc(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt(\"return\",(0,t.t0)(t.t1,t.t2));case 6:case\"end\":return t.stop()}},t)})))}}function Hc(e,t){var n=new Y;return e.asyncQueue.enqueueAndForget(p(regeneratorRuntime.mark(function r(){var i;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,function(e){return Mc(e).then(function(e){return e.datastore})}(e);case 2:i=r.sent,new Tc(e.asyncQueue,i,t,n).run();case 4:case\"end\":return r.stop()}},r)}))),n.promise}function Yc(e,t,n,r){var i=function(e,t){return function(e,t){return new Ic(e,t)}(function(e,t){if(e instanceof Uint8Array)return bc(e,t);if(e instanceof ArrayBuffer)return bc(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error(\"Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream\")}(\"string\"==typeof e?(new TextEncoder).encode(e):e),t)}(n,eo(t));e.asyncQueue.enqueueAndForget(p(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=pc,t.next=3,Oc(e);case 3:t.t1=t.sent,t.t2=i,t.t3=r,(0,t.t0)(t.t1,t.t2,t.t3);case 7:case\"end\":return t.stop()}},t)})))}function Xc(e,t){return e.asyncQueue.enqueue(p(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(e,t){var n=Q(e);return n.persistence.runTransaction(\"Get named query\",\"readonly\",function(e){return n._s.getNamedQuery(e,t)})},n.next=3,Fc(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt(\"return\",(0,n.t0)(n.t1,n.t2));case 6:case\"end\":return n.stop()}},n)})))}var Jc=new Map;function $c(e,t,n){if(!n)throw new H(W.INVALID_ARGUMENT,\"Function \".concat(e,\"() cannot be called with an empty \").concat(t,\".\"))}function Zc(e,t,n,r){if(!0===t&&!0===r)throw new H(W.INVALID_ARGUMENT,\"\".concat(e,\" and \").concat(n,\" cannot be used together.\"))}function el(e){if(!Ve.isDocumentKey(e))throw new H(W.INVALID_ARGUMENT,\"Invalid document reference. Document references must have an even number of segments, but \".concat(e,\" has \").concat(e.length,\".\"))}function tl(e){if(Ve.isDocumentKey(e))throw new H(W.INVALID_ARGUMENT,\"Invalid collection reference. Collection references must have an odd number of segments, but \".concat(e,\" has \").concat(e.length,\".\"))}function nl(e){if(void 0===e)return\"undefined\";if(null===e)return\"null\";if(\"string\"==typeof e)return e.length>20&&(e=\"\".concat(e.substring(0,20),\"...\")),JSON.stringify(e);if(\"number\"==typeof e||\"boolean\"==typeof e)return\"\"+e;if(\"object\"==d(e)){if(e instanceof Array)return\"an array\";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?\"a custom \".concat(t,\" object\"):\"an object\"}return\"function\"==typeof e?\"a function\":G()}function rl(e,t){if(\"_delegate\"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new H(W.INVALID_ARGUMENT,\"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?\");var n=nl(e);throw new H(W.INVALID_ARGUMENT,\"Expected type '\".concat(t.name,\"', but it was: \").concat(n))}return e}function il(e,t){if(t<=0)throw new H(W.INVALID_ARGUMENT,\"Function \".concat(e,\"() requires a positive number, but it was: \").concat(t,\".\"))}var al=function(){function e(t){var n;if(N(this,e),void 0===t.host){if(void 0!==t.ssl)throw new H(W.INVALID_ARGUMENT,\"Can't provide ssl option if host option is not set\");this.host=\"firestore.googleapis.com\",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new H(W.INVALID_ARGUMENT,\"cacheSizeBytes must be at least 1048576\");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Zc(\"experimentalForceLongPolling\",t.experimentalForceLongPolling,\"experimentalAutoDetectLongPolling\",t.experimentalAutoDetectLongPolling)}return C(e,[{key:\"isEqual\",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),ul=function(){function e(t,n,r){N(this,e),this._authCredentials=n,this._appCheckCredentials=r,this.type=\"firestore-lite\",this._persistenceKey=\"(lite)\",this._settings=new al({}),this._settingsFrozen=!1,t instanceof Re?this._databaseId=t:(this._app=t,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,[\"projectId\"]))throw new H(W.INVALID_ARGUMENT,'\"projectId\" not provided in firebase.initializeApp.');return new Re(e.options.projectId)}(t))}return C(e,[{key:\"app\",get:function(){if(!this._app)throw new H(W.FAILED_PRECONDITION,\"Firestore was not initialized using the Firebase SDK. 'app' is not available\");return this._app}},{key:\"_initialized\",get:function(){return this._settingsFrozen}},{key:\"_terminated\",get:function(){return void 0!==this._terminateTask}},{key:\"_setSettings\",value:function(e){if(this._settingsFrozen)throw new H(W.FAILED_PRECONDITION,\"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.\");this._settings=new al(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new J;switch(e.type){case\"gapi\":var t=e.client;return j(!(\"object\"!=d(t)||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new te(t,e.sessionIndex||\"0\",e.iamToken||null);case\"provider\":return e.client;default:throw new H(W.INVALID_ARGUMENT,\"makeAuthCredentialsProvider failed due to invalid credential type\")}}(e.credentials))}},{key:\"_getSettings\",value:function(){return this._settings}},{key:\"_freezeSettings\",value:function(){return this._settingsFrozen=!0,this._settings}},{key:\"_delete\",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:\"toJSON\",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:\"_terminate\",value:function(){return e=this,(t=Jc.get(e))&&(q(\"ComponentProvider\",\"Removing Datastore\"),Jc.delete(e),t.terminate()),Promise.resolve();var e,t}}]),e}();function ol(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=(e=rl(e,ul))._getSettings();if(\"firestore.googleapis.com\"!==u.host&&u.host!==t&&B(\"Host has been set in both settings() and useEmulator(), emulator host will be used\"),e._setSettings(Object.assign(Object.assign({},u),{host:\"\".concat(t,\":\").concat(n),ssl:!1})),a.mockUserToken){var o,s;if(\"string\"==typeof a.mockUserToken)o=a.mockUserToken,s=L.MOCK_USER;else{o=(0,i.createMockUserToken)(a.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var c=a.mockUserToken.sub||a.mockUserToken.user_id;if(!c)throw new H(W.INVALID_ARGUMENT,\"mockUserToken must contain 'sub' or 'user_id' field!\");s=new L(c)}e._authCredentials=new $(new X(o,s))}}var sl=function(){function e(t,n,r){N(this,e),this.converter=n,this._key=r,this.type=\"document\",this.firestore=t}return C(e,[{key:\"_path\",get:function(){return this._key.path}},{key:\"id\",get:function(){return this._key.path.lastSegment()}},{key:\"path\",get:function(){return this._key.path.canonicalString()}},{key:\"parent\",get:function(){return new ll(this.firestore,this.converter,this._key.path.popLast())}},{key:\"withConverter\",value:function(t){return new e(this.firestore,t,this._key)}}]),e}();exports.DocumentReference=sl;var cl=function(){function e(t,n,r){N(this,e),this.converter=n,this._query=r,this.type=\"query\",this.firestore=t}return C(e,[{key:\"withConverter\",value:function(t){return new e(this.firestore,t,this._query)}}]),e}();exports.Query=cl;var ll=function(e){m(n,cl);var t=k(n);function n(e,r,i){var a;return N(this,n),(a=t.call(this,e,r,Ut(i)))._path=i,a.type=\"collection\",a}return C(n,[{key:\"id\",get:function(){return this._query.path.lastSegment()}},{key:\"path\",get:function(){return this._query.path.canonicalString()}},{key:\"parent\",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new sl(this.firestore,null,new Ve(e))}},{key:\"withConverter\",value:function(e){return new n(this.firestore,e,this._path)}}]),n}();function fl(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(e=(0,i.getModularInstance)(e),$c(\"collection\",\"path\",t),e instanceof ul){var u=me.fromString.apply(me,[t].concat(r));return tl(u),new ll(e,null,u)}if(!(e instanceof sl||e instanceof ll))throw new H(W.INVALID_ARGUMENT,\"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore\");var o=e._path.child(me.fromString.apply(me,[t].concat(r)));return tl(o),new ll(e.firestore,null,o)}function hl(e,t){if(e=rl(e,ul),$c(\"collectionGroup\",\"collection id\",t),t.indexOf(\"/\")>=0)throw new H(W.INVALID_ARGUMENT,\"Invalid collection ID '\".concat(t,\"' passed to function collectionGroup(). Collection IDs must not contain '/'.\"));return new cl(e,null,function(e){return new Ot(me.emptyPath(),e)}(t))}function dl(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(e=(0,i.getModularInstance)(e),1===arguments.length&&(t=oe.R()),$c(\"doc\",\"path\",t),e instanceof ul){var u=me.fromString.apply(me,[t].concat(r));return el(u),new sl(e,null,new Ve(u))}if(!(e instanceof sl||e instanceof ll))throw new H(W.INVALID_ARGUMENT,\"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore\");var o=e._path.child(me.fromString.apply(me,[t].concat(r)));return el(o),new sl(e.firestore,e instanceof ll?e.converter:null,new Ve(o))}function vl(e,t){return e=(0,i.getModularInstance)(e),t=(0,i.getModularInstance)(t),(e instanceof sl||e instanceof ll)&&(t instanceof sl||t instanceof ll)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function yl(e,t){return e=(0,i.getModularInstance)(e),t=(0,i.getModularInstance)(t),e instanceof cl&&t instanceof cl&&e.firestore===t.firestore&&Yt(e._query,t._query)&&e.converter===t.converter}exports.CollectionReference=ll;var pl=function(){function e(){var t=this;N(this,e),this.ka=Promise.resolve(),this.Ma=[],this.Oa=!1,this.Fa=[],this.$a=null,this.Ba=!1,this.La=!1,this.Ua=[],this.Do=new to(this,\"async_queue_retry\"),this.qa=function(){var e=Zu();e&&q(\"AsyncQueue\",\"Visibility state changed to \"+e.visibilityState),t.Do.Ao()};var n=Zu();n&&\"function\"==typeof n.addEventListener&&n.addEventListener(\"visibilitychange\",this.qa)}return C(e,[{key:\"isShuttingDown\",get:function(){return this.Oa}},{key:\"enqueueAndForget\",value:function(e){this.enqueue(e)}},{key:\"enqueueAndForgetEvenWhileRestricted\",value:function(e){this.Ka(),this.Ga(e)}},{key:\"enterRestrictedMode\",value:function(e){if(!this.Oa){this.Oa=!0,this.La=e||!1;var t=Zu();t&&\"function\"==typeof t.removeEventListener&&t.removeEventListener(\"visibilitychange\",this.qa)}}},{key:\"enqueue\",value:function(e){var t=this;if(this.Ka(),this.Oa)return new Promise(function(){});var n=new Y;return this.Ga(function(){return t.Oa&&t.La?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})}},{key:\"enqueueRetryable\",value:function(e){var t=this;this.enqueueAndForget(function(){return t.Ma.push(e),t.Qa()})}},{key:\"Qa\",value:function(){var e=p(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.Ma.length){e.next=14;break}return e.prev=1,e.next=4,this.Ma[0]();case 4:this.Ma.shift(),this.Do.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),_i(e.t0)){e.next=12;break}throw e.t0;case 12:q(\"AsyncQueue\",\"Operation failed with retryable error: \"+e.t0);case 13:this.Ma.length>0&&this.Do.To(function(){return t.Qa()});case 14:case\"end\":return e.stop()}},e,this,[[1,8]])}));return function(){return e.apply(this,arguments)}}()},{key:\"Ga\",value:function(e){var t=this,n=this.ka.then(function(){return t.Ba=!0,e().catch(function(e){throw t.$a=e,t.Ba=!1,U(\"INTERNAL UNHANDLED ERROR: \",function(e){var t=e.message||\"\";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+\"\\n\"+e.stack),t}(e)),e}).then(function(e){return t.Ba=!1,e})});return this.ka=n,n}},{key:\"enqueueAfterDelay\",value:function(e,t,n){var r=this;this.Ka(),this.Ua.indexOf(e)>-1&&(t=0);var i=Xo.createAndSchedule(this,e,t,n,function(e){return r.ja(e)});return this.Fa.push(i),i}},{key:\"Ka\",value:function(){this.$a&&G()}},{key:\"verifyOperationInProgress\",value:function(){}},{key:\"Wa\",value:function(){var e=p(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.ka,e.next=3,t;case 3:if(t!==this.ka){e.next=0;break}case 4:case\"end\":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:\"za\",value:function(e){var t,n=v(this.Fa);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:\"Ha\",value:function(e){var t=this;return this.Wa().then(function(){t.Fa.sort(function(e,t){return e.targetTimeMs-t.targetTimeMs});var n,r=v(t.Fa);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),\"all\"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.Wa()})}},{key:\"Ja\",value:function(e){this.Ua.push(e)}},{key:\"ja\",value:function(e){var t=this.Fa.indexOf(e);this.Fa.splice(t,1)}}]),e}();function ml(e){return function(e,t){if(\"object\"!=d(e)||null===e)return!1;var n,r=e,i=v([\"next\",\"error\",\"complete\"]);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&\"function\"==typeof r[a])return!0}}catch(u){i.e(u)}finally{i.f()}return!1}(e)}var gl=function(){function e(){N(this,e),this._progressObserver={},this._taskCompletionResolver=new Y,this._lastProgress={taskState:\"Running\",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return C(e,[{key:\"onProgress\",value:function(e,t,n){this._progressObserver={next:e,error:t,complete:n}}},{key:\"catch\",value:function(e){return this._taskCompletionResolver.promise.catch(e)}},{key:\"then\",value:function(e,t){return this._taskCompletionResolver.promise.then(e,t)}},{key:\"_completeWith\",value:function(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}},{key:\"_failWith\",value:function(e){this._lastProgress.taskState=\"Error\",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}},{key:\"_updateProgress\",value:function(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}]),e}();exports.LoadBundleTask=gl;var kl=-1;exports.CACHE_SIZE_UNLIMITED=kl;var wl=function(e){m(n,ul);var t=k(n);function n(e,r,i){var a;return N(this,n),(a=t.call(this,e,r,i)).type=\"firestore\",a._queue=new pl,a._persistenceKey=\"name\"in e?e.name:\"[DEFAULT]\",a}return C(n,[{key:\"_terminate\",value:function(){return this._firestoreClient||El(this),this._firestoreClient.terminate()}}]),n}();function bl(e,n){var r=(0,t._getProvider)(e,\"firestore\");if(r.isInitialized()){var a=r.getImmediate(),u=r.getOptions();if((0,i.deepEqual)(u,n))return a;throw new H(W.FAILED_PRECONDITION,\"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.\")}if(void 0!==n.cacheSizeBytes&&-1!==n.cacheSizeBytes&&n.cacheSizeBytes<1048576)throw new H(W.INVALID_ARGUMENT,\"cacheSizeBytes must be at least 1048576\");return r.initialize({options:n})}function xl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,t.getApp)();return(0,t._getProvider)(e,\"firestore\").getImmediate()}function Il(e){return e._firestoreClient||El(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function El(e){var t,n=e._freezeSettings(),r=function(e,t,n,r){return new Ne(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||\"\",e._persistenceKey,n);e._firestoreClient=new Sc(e._authCredentials,e._appCheckCredentials,e._queue,r)}function Tl(e,t){Vl(e=rl(e,wl));var n=Il(e),r=e._freezeSettings(),i=new wc;return _l(n,i,new gc(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function Sl(e){Vl(e=rl(e,wl));var t=Il(e),n=e._freezeSettings(),r=new wc;return _l(t,r,new kc(r,n.cacheSizeBytes))}function _l(e,t,n){var r=new Y;return e.asyncQueue.enqueue(p(regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,_c(e,n);case 3:return i.next=5,Dc(e,t);case 5:r.resolve(),i.next=13;break;case 8:if(i.prev=8,i.t0=i.catch(0),function(e){return\"FirebaseError\"===e.name?e.code===W.FAILED_PRECONDITION||e.code===W.UNIMPLEMENTED:!(\"undefined\"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(i.t0)){i.next=12;break}throw i.t0;case 12:console.warn(\"Error enabling offline persistence. Falling back to persistence disabled: \"+i.t0),r.reject(i.t0);case 13:case\"end\":return i.stop()}},i,null,[[0,8]])}))).then(function(){return r.promise})}function Al(e){if(e._initialized&&!e._terminated)throw new H(W.FAILED_PRECONDITION,\"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.\");var t=new Y;return e._queue.enqueueAndForgetEvenWhileRestricted(p(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,function(){var e=p(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Ei.vt()){e.next=2;break}return e.abrupt(\"return\",Promise.resolve());case 2:return n=t+\"main\",e.next=5,Ei.delete(n);case 5:case\"end\":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()(nu(e._databaseId,e._persistenceKey));case 3:t.resolve(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t.reject(n.t0);case 9:case\"end\":return n.stop()}},n,null,[[0,6]])}))),t.promise}function Dl(e){return function(e){var t=new Y;return e.asyncQueue.enqueueAndForget(p(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=Os,n.next=3,Oc(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt(\"return\",(0,n.t0)(n.t1,n.t2));case 6:case\"end\":return n.stop()}},n)}))),t.promise}(Il(e=rl(e,wl)))}function Nl(e){return Bc(Il(e=rl(e,wl)))}function Rl(e){return Kc(Il(e=rl(e,wl)))}function Cl(e){return(0,t._removeServiceInstance)(e.app,\"firestore\"),e._delete()}function Ml(e,t){var n=Il(e=rl(e,wl)),r=new gl;return Yc(n,e._databaseId,t,r),r}function Ll(e,t){return Xc(Il(e=rl(e,wl)),t).then(function(t){return t?new cl(e,null,t.query):null})}function Vl(e){if(e._initialized||e._terminated)throw new H(W.FAILED_PRECONDITION,\"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.\")}exports.Firestore=wl;var Fl=function(){function e(){N(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new H(W.INVALID_ARGUMENT,\"Invalid field name at argument $(i + 1). Field names must not be empty.\");this._internalPath=new ke(n)}return C(e,[{key:\"isEqual\",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();function Pl(){return new Fl(\"__name__\")}exports.FieldPath=Fl;var Ol=function(){function e(t){N(this,e),this._byteString=t}return C(e,[{key:\"toBase64\",value:function(){return this._byteString.toBase64()}},{key:\"toUint8Array\",value:function(){return this._byteString.toUint8Array()}},{key:\"toString\",value:function(){return\"Bytes(base64: \"+this.toBase64()+\")\"}},{key:\"isEqual\",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:\"fromBase64String\",value:function(t){try{return new e(xe.fromBase64String(t))}catch(t){throw new H(W.INVALID_ARGUMENT,\"Failed to construct data from Base64 string: \"+t)}}},{key:\"fromUint8Array\",value:function(t){return new e(xe.fromUint8Array(t))}}]),e}();exports.Bytes=Ol;var ql=C(function e(t){N(this,e),this._methodName=t});exports.FieldValue=ql;var Ul=function(){function e(t,n){if(N(this,e),!isFinite(t)||t<-90||t>90)throw new H(W.INVALID_ARGUMENT,\"Latitude must be a number between -90 and 90, but was: \"+t);if(!isFinite(n)||n<-180||n>180)throw new H(W.INVALID_ARGUMENT,\"Longitude must be a number between -180 and 180, but was: \"+n);this._lat=t,this._long=n}return C(e,[{key:\"latitude\",get:function(){return this._lat}},{key:\"longitude\",get:function(){return this._long}},{key:\"isEqual\",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:\"toJSON\",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:\"_compareTo\",value:function(e){return se(this._lat,e._lat)||se(this._long,e._long)}}]),e}();exports.GeoPoint=Ul;var Bl=/^__.*__$/,Kl=function(){function e(t,n,r){N(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return C(e,[{key:\"toMutation\",value:function(e,t){return null!==this.fieldMask?new Nn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Dn(e,this.data,t,this.fieldTransforms)}}]),e}(),Gl=function(){function e(t,n,r){N(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return C(e,[{key:\"toMutation\",value:function(e,t){return new Nn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function jl(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw G()}}var zl=function(){function e(t,n,r,i,a,u){N(this,e),this.settings=t,this.databaseId=n,this.M=r,this.ignoreUndefinedProperties=i,void 0===a&&this.Ya(),this.fieldTransforms=a||[],this.fieldMask=u||[]}return C(e,[{key:\"path\",get:function(){return this.settings.path}},{key:\"Xa\",get:function(){return this.settings.Xa}},{key:\"Za\",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.M,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:\"tc\",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Za({path:n,ec:!1});return r.nc(e),r}},{key:\"sc\",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Za({path:n,ec:!1});return r.Ya(),r}},{key:\"ic\",value:function(e){return this.Za({path:void 0,ec:!0})}},{key:\"rc\",value:function(e){return hf(e,this.settings.methodName,this.settings.oc||!1,this.path,this.settings.uc)}},{key:\"contains\",value:function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})}},{key:\"Ya\",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.nc(this.path.get(e))}},{key:\"nc\",value:function(e){if(0===e.length)throw this.rc(\"Document fields must not be empty\");if(jl(this.Xa)&&Bl.test(e))throw this.rc('Document fields cannot begin and end with \"__\"')}}]),e}(),Ql=function(){function e(t,n,r){N(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.M=r||eo(t)}return C(e,[{key:\"ac\",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new zl({Xa:e,methodName:t,uc:n,path:ke.emptyPath(),ec:!1,oc:r},this.databaseId,this.M,this.ignoreUndefinedProperties)}}]),e}();function Wl(e){var t=e._freezeSettings(),n=eo(e._databaseId);return new Ql(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Hl(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=e.ac(a.merge||a.mergeFields?2:0,t,n,i);sf(\"Data must be an object, but it was:\",u,r);var o,s,c=uf(r,u);if(a.merge)o=new we(u.fieldMask),s=u.fieldTransforms;else if(a.mergeFields){var l,f=[],h=v(a.mergeFields);try{for(h.s();!(l=h.n()).done;){var d=cf(t,l.value,n);if(!u.contains(d))throw new H(W.INVALID_ARGUMENT,\"Field '\".concat(d,\"' is specified in your field mask but missing from your input data.\"));df(f,d)||f.push(d)}}catch(y){h.e(y)}finally{h.f()}o=new we(f),s=u.fieldTransforms.filter(function(e){return o.covers(e.field)})}else o=null,s=u.fieldTransforms;return new Kl(new rt(c),o,s)}var Yl=function(e){m(n,ql);var t=k(n);function n(){return N(this,n),t.apply(this,arguments)}return C(n,[{key:\"_toFieldTransform\",value:function(e){if(2!==e.Xa)throw 1===e.Xa?e.rc(\"\".concat(this._methodName,\"() can only appear at the top level of your update data\")):e.rc(\"\".concat(this._methodName,\"() cannot be used with set() unless you pass {merge:true}\"));return e.fieldMask.push(e.path),null}},{key:\"isEqual\",value:function(e){return e instanceof n}}]),n}();function Xl(e,t,n){return new zl({Xa:3,uc:t.settings.uc,methodName:e._methodName,ec:n},t.databaseId,t.M,t.ignoreUndefinedProperties)}var Jl=function(e){m(n,ql);var t=k(n);function n(){return N(this,n),t.apply(this,arguments)}return C(n,[{key:\"_toFieldTransform\",value:function(e){return new gn(e.path,new ln)}},{key:\"isEqual\",value:function(e){return e instanceof n}}]),n}(),$l=function(e){m(n,ql);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this,e)).cc=r,i}return C(n,[{key:\"_toFieldTransform\",value:function(e){var t=Xl(this,e,!0),n=this.cc.map(function(e){return af(e,t)}),r=new fn(n);return new gn(e.path,r)}},{key:\"isEqual\",value:function(e){return this===e}}]),n}(),Zl=function(e){m(n,ql);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this,e)).cc=r,i}return C(n,[{key:\"_toFieldTransform\",value:function(e){var t=Xl(this,e,!0),n=this.cc.map(function(e){return af(e,t)}),r=new dn(n);return new gn(e.path,r)}},{key:\"isEqual\",value:function(e){return this===e}}]),n}(),ef=function(e){m(n,ql);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this,e)).hc=r,i}return C(n,[{key:\"_toFieldTransform\",value:function(e){var t=new yn(e.M,an(e.M,this.hc));return new gn(e.path,t)}},{key:\"isEqual\",value:function(e){return this===e}}]),n}();function tf(e,t,n,r){var a=e.ac(1,t,n);sf(\"Data must be an object, but it was:\",a,r);var u=[],o=rt.empty();ve(r,function(e,r){var s=ff(t,e,n);r=(0,i.getModularInstance)(r);var c=a.sc(s);if(r instanceof Yl)u.push(s);else{var l=af(r,c);null!=l&&(u.push(s),o.set(s,l))}});var s=new we(u);return new Gl(o,s,a.fieldTransforms)}function nf(e,t,n,r,a,u){var o=e.ac(1,t,n),s=[cf(t,r,n)],c=[a];if(u.length%2!=0)throw new H(W.INVALID_ARGUMENT,\"Function \".concat(t,\"() needs to be called with an even number of arguments that alternate between field names and values.\"));for(var l=0;l<u.length;l+=2)s.push(cf(t,u[l])),c.push(u[l+1]);for(var f=[],h=rt.empty(),d=s.length-1;d>=0;--d)if(!df(f,s[d])){var v=s[d],y=c[d];y=(0,i.getModularInstance)(y);var p=o.sc(v);if(y instanceof Yl)f.push(v);else{var m=af(y,p);null!=m&&(f.push(v),h.set(v,m))}}var g=new we(f);return new Gl(h,g,o.fieldTransforms)}function rf(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return af(n,e.ac(r?4:3,t))}function af(e,t){if(of(e=(0,i.getModularInstance)(e)))return sf(\"Unsupported field value:\",t,e),uf(e,t);if(e instanceof ql)return function(e,t){if(!jl(t.Xa))throw t.rc(\"\".concat(e._methodName,\"() can only be used with update() and set()\"));if(!t.path)throw t.rc(\"\".concat(e._methodName,\"() is not currently supported inside arrays\"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.ec&&4!==t.Xa)throw t.rc(\"Nested arrays are not supported\");return function(e,t){var n,r=[],i=0,a=v(e);try{for(a.s();!(n=a.n()).done;){var u=af(n.value,t.ic(i));null==u&&(u={nullValue:\"NULL_VALUE\"}),r.push(u),i++}}catch(o){a.e(o)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=(0,i.getModularInstance)(e)))return{nullValue:\"NULL_VALUE\"};if(\"number\"==typeof e)return an(t.M,e);if(\"boolean\"==typeof e)return{booleanValue:e};if(\"string\"==typeof e)return{stringValue:e};if(e instanceof Date){var n=fe.fromDate(e);return{timestampValue:pr(t.M,n)}}if(e instanceof fe){var r=new fe(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:pr(t.M,r)}}if(e instanceof Ul)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Ol)return{bytesValue:mr(t.M,e._byteString)};if(e instanceof sl){var a=t.databaseId,u=e.firestore._databaseId;if(!u.isEqual(a))throw t.rc(\"Document reference is for database \".concat(u.projectId,\"/\").concat(u.database,\" but should be for database \").concat(a.projectId,\"/\").concat(a.database));return{referenceValue:wr(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.rc(\"Unsupported field value: \".concat(nl(e)))}(e,t)}function uf(e,t){var n={};return ye(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ve(e,function(e,r){var i=af(r,t.tc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function of(e){return!(\"object\"!=d(e)||null===e||e instanceof Array||e instanceof Date||e instanceof fe||e instanceof Ul||e instanceof Ol||e instanceof sl||e instanceof ql)}function sf(e,t,n){if(!of(n)||!function(e){return\"object\"==d(e)&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=nl(n);throw\"an object\"===r?t.rc(e+\" a custom object\"):t.rc(e+\" \"+r)}}function cf(e,t,n){if((t=(0,i.getModularInstance)(t))instanceof Fl)return t._internalPath;if(\"string\"==typeof t)return ff(e,t);throw hf(\"Field path arguments must be of type string or \",e,!1,void 0,n)}var lf=new RegExp(\"[~\\\\*/\\\\[\\\\]]\");function ff(e,t,n){if(t.search(lf)>=0)throw hf(\"Invalid field path (\".concat(t,\"). Paths must not contain '~', '*', '/', '[', or ']'\"),e,!1,void 0,n);try{return u(Fl,E(t.split(\".\")))._internalPath}catch(r){throw hf(\"Invalid field path (\".concat(t,\"). Paths must not be empty, begin with '.', end with '.', or contain '..'\"),e,!1,void 0,n)}}function hf(e,t,n,r,i){var a=r&&!r.isEmpty(),u=void 0!==i,o=\"Function \".concat(t,\"() called with invalid data\");n&&(o+=\" (via `toFirestore()`)\"),o+=\". \";var s=\"\";return(a||u)&&(s+=\" (found\",a&&(s+=\" in field \".concat(r)),u&&(s+=\" in document \".concat(i)),s+=\")\"),new H(W.INVALID_ARGUMENT,o+e+s)}function df(e,t){return e.some(function(e){return e.isEqual(t)})}var vf=function(){function e(t,n,r,i,a){N(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return C(e,[{key:\"id\",get:function(){return this._key.path.lastSegment()}},{key:\"ref\",get:function(){return new sl(this._firestore,this._converter,this._key)}},{key:\"exists\",value:function(){return null!==this._document}},{key:\"data\",value:function(){if(this._document){if(this._converter){var e=new yf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:\"get\",value:function(e){if(this._document){var t=this._document.data.field(pf(\"DocumentSnapshot.get\",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),yf=function(e){m(n,vf);var t=k(n);function n(){return N(this,n),t.apply(this,arguments)}return C(n,[{key:\"data\",value:function(){return o(I(n.prototype),\"data\",this).call(this)}}]),n}();function pf(e,t){return\"string\"==typeof t?ff(e,t):t instanceof Fl?t._internalPath:t._delegate._internalPath}var mf=function(){function e(t,n){N(this,e),this.hasPendingWrites=t,this.fromCache=n}return C(e,[{key:\"isEqual\",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}();exports.SnapshotMetadata=mf;var gf=function(e){m(n,vf);var t=k(n);function n(e,r,i,a,u,o){var s;return N(this,n),(s=t.call(this,e,r,i,a,o))._firestore=e,s._firestoreImpl=e,s.metadata=u,s}return C(n,[{key:\"exists\",value:function(){return o(I(n.prototype),\"exists\",this).call(this)}},{key:\"data\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new kf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:\"get\",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(pf(\"DocumentSnapshot.get\",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}();exports.DocumentSnapshot=gf;var kf=function(e){m(n,gf);var t=k(n);function n(){return N(this,n),t.apply(this,arguments)}return C(n,[{key:\"data\",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o(I(n.prototype),\"data\",this).call(this,e)}}]),n}();exports.QueryDocumentSnapshot=kf;var wf=function(){function e(t,n,r,i){N(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new mf(i.hasPendingWrites,i.fromCache),this.query=r}return C(e,[{key:\"docs\",get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e}},{key:\"size\",get:function(){return this._snapshot.docs.size}},{key:\"empty\",get:function(){return 0===this.size}},{key:\"forEach\",value:function(e,t){var n=this;this._snapshot.docs.forEach(function(r){e.call(t,new kf(n._firestore,n._userDataWriter,r.key,r,new mf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})}},{key:\"docChanges\",value:function(){var e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new H(W.INVALID_ARGUMENT,\"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().\");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map(function(t){return{type:\"added\",doc:new kf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new mf(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:n++}})}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(function(e){return t||3!==e.type}).map(function(t){var n=new kf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new mf(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:bf(t.type),doc:n,oldIndex:i,newIndex:a}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}]),e}();function bf(e){switch(e){case 0:return\"added\";case 2:case 3:return\"modified\";case 1:return\"removed\";default:return G()}}function xf(e,t){return e instanceof gf&&t instanceof gf?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof wf&&t instanceof wf&&e._firestore===t._firestore&&yl(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function If(e){if(Kt(e)&&0===e.explicitOrderBy.length)throw new H(W.UNIMPLEMENTED,\"limitToLast() queries require specifying at least one orderBy() clause\")}exports.QuerySnapshot=wf;var Ef=C(function e(){N(this,e)});function Tf(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){e=a[i]._apply(e)}return e}exports.QueryConstraint=Ef;var Sf=function(e){m(n,Ef);var t=k(n);function n(e,r,i){var a;return N(this,n),(a=t.call(this)).lc=e,a.fc=r,a.dc=i,a.type=\"where\",a}return C(n,[{key:\"_apply\",value:function(e){var t=Wl(e.firestore),n=function(e,t,n,r,i,a,u){var o;if(i.isKeyField()){if(\"array-contains\"===a||\"array-contains-any\"===a)throw new H(W.INVALID_ARGUMENT,\"Invalid Query. You can't perform '\".concat(a,\"' queries on documentId().\"));if(\"in\"===a||\"not-in\"===a){Bf(u,a);var s,c=[],l=v(u);try{for(l.s();!(s=l.n()).done;){var f=s.value;c.push(Uf(r,e,f))}}catch(d){l.e(d)}finally{l.f()}o={arrayValue:{values:c}}}else o=Uf(r,e,u)}else\"in\"!==a&&\"not-in\"!==a&&\"array-contains-any\"!==a||Bf(u,a),o=rf(n,\"where\",u,\"in\"===a||\"not-in\"===a);var h=Et.create(i,a,o);return function(e,t){if(t.S()){var n=jt(e);if(null!==n&&!n.isEqual(t.field))throw new H(W.INVALID_ARGUMENT,\"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '\".concat(n.toString(),\"' and '\").concat(t.field.toString(),\"'\"));var r=Gt(e);null!==r&&Kf(e,t.field,r)}var i=function(e,t){var n,r=v(e.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(t.indexOf(i.op)>=0)return i.op}}catch(d){r.e(d)}finally{r.f()}return null}(e,function(e){switch(t.op){case\"!=\":return[\"!=\",\"not-in\"];case\"array-contains\":return[\"array-contains\",\"array-contains-any\",\"not-in\"];case\"in\":return[\"array-contains-any\",\"in\",\"not-in\"];case\"array-contains-any\":return[\"array-contains\",\"array-contains-any\",\"in\",\"not-in\"];case\"not-in\":return[\"array-contains\",\"array-contains-any\",\"in\",\"not-in\",\"!=\"];default:return[]}}());if(null!==i)throw i===t.op?new H(W.INVALID_ARGUMENT,\"Invalid query. You cannot use more than one '\".concat(t.op.toString(),\"' filter.\")):new H(W.INVALID_ARGUMENT,\"Invalid query. You cannot use '\".concat(t.op.toString(),\"' filters with '\").concat(i.toString(),\"' filters.\"))}(e,h),h}(e._query,0,t,e.firestore._databaseId,this.lc,this.fc,this.dc);return new cl(e.firestore,e.converter,function(e,t){var n=e.filters.concat([t]);return new Ot(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}]),n}();function _f(e,t,n){var r=t,i=pf(\"where\",e);return new Sf(i,r,n)}var Af=function(e){m(n,Ef);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this)).lc=e,i._c=r,i.type=\"orderBy\",i}return C(n,[{key:\"_apply\",value:function(e){var t=function(e,t,n){if(null!==e.startAt)throw new H(W.INVALID_ARGUMENT,\"Invalid query. You must not call startAt() or startAfter() before calling orderBy().\");if(null!==e.endAt)throw new H(W.INVALID_ARGUMENT,\"Invalid query. You must not call endAt() or endBefore() before calling orderBy().\");var r=new Lt(t,n);return function(e,t){if(null===Gt(e)){var n=jt(e);null!==n&&Kf(e,n,t.field)}}(e,r),r}(e._query,this.lc,this._c);return new cl(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new Ot(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}]),n}();function Df(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"asc\",n=pf(\"orderBy\",e);return new Af(n,t)}var Nf=function(e){m(n,Ef);var t=k(n);function n(e,r,i){var a;return N(this,n),(a=t.call(this)).type=e,a.wc=r,a.mc=i,a}return C(n,[{key:\"_apply\",value:function(e){return new cl(e.firestore,e.converter,Ht(e._query,this.wc,this.mc))}}]),n}();function Rf(e){return il(\"limit\",e),new Nf(\"limit\",e,\"F\")}function Cf(e){return il(\"limitToLast\",e),new Nf(\"limitToLast\",e,\"L\")}var Mf=function(e){m(n,Ef);var t=k(n);function n(e,r,i){var a;return N(this,n),(a=t.call(this)).type=e,a.gc=r,a.yc=i,a}return C(n,[{key:\"_apply\",value:function(e){var t=qf(e,this.type,this.gc,this.yc);return new cl(e.firestore,e.converter,function(e,t){return new Ot(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}]),n}();function Lf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Mf(\"startAt\",t,!0)}function Vf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Mf(\"startAfter\",t,!1)}var Ff=function(e){m(n,Ef);var t=k(n);function n(e,r,i){var a;return N(this,n),(a=t.call(this)).type=e,a.gc=r,a.yc=i,a}return C(n,[{key:\"_apply\",value:function(e){var t=qf(e,this.type,this.gc,this.yc);return new cl(e.firestore,e.converter,function(e,t){return new Ot(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}]),n}();function Pf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Ff(\"endBefore\",t,!1)}function Of(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Ff(\"endAt\",t,!0)}function qf(e,t,n,r){if(n[0]=(0,i.getModularInstance)(n[0]),n[0]instanceof vf)return function(e,t,n,r,i){if(!r)throw new H(W.NOT_FOUND,\"Can't use a DocumentSnapshot that doesn't exist for \".concat(n,\"().\"));var a,u=[],o=v(Qt(e));try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.field.isKeyField())u.push(ze(t,r.key));else{var c=r.data.field(s.field);if(_e(c))throw new H(W.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field \"'+s.field+'\" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var l=s.field.canonicalString();throw new H(W.INVALID_ARGUMENT,\"Invalid query. You are trying to start or end a query using a document for which the field '\".concat(l,\"' (used as the orderBy) does not exist.\"))}u.push(c)}}}catch(f){o.e(f)}finally{o.f()}return new Mt(u,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var a=Wl(e.firestore);return function(e,t,n,r,i,a){var u=e.explicitOrderBy;if(i.length>u.length)throw new H(W.INVALID_ARGUMENT,\"Too many arguments provided to \".concat(r,\"(). The number of arguments must be less than or equal to the number of orderBy() clauses\"));for(var o=[],s=0;s<i.length;s++){var c=i[s];if(u[s].field.isKeyField()){if(\"string\"!=typeof c)throw new H(W.INVALID_ARGUMENT,\"Invalid query. Expected a string for document ID in \".concat(r,\"(), but got a \").concat(d(c)));if(!zt(e)&&-1!==c.indexOf(\"/\"))throw new H(W.INVALID_ARGUMENT,\"Invalid query. When querying a collection and ordering by documentId(), the value passed to \".concat(r,\"() must be a plain document ID, but '\").concat(c,\"' contains a slash.\"));var l=e.path.child(me.fromString(c));if(!Ve.isDocumentKey(l))throw new H(W.INVALID_ARGUMENT,\"Invalid query. When querying a collection group and ordering by documentId(), the value passed to \".concat(r,\"() must result in a valid document path, but '\").concat(l,\"' is not because it contains an odd number of segments.\"));var f=new Ve(l);o.push(ze(t,f))}else{var h=rf(n,r,c);o.push(h)}}return new Mt(o,a)}(e._query,e.firestore._databaseId,a,t,n,r)}function Uf(e,t,n){if(\"string\"==typeof(n=(0,i.getModularInstance)(n))){if(\"\"===n)throw new H(W.INVALID_ARGUMENT,\"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.\");if(!zt(t)&&-1!==n.indexOf(\"/\"))throw new H(W.INVALID_ARGUMENT,\"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '\".concat(n,\"' contains a '/' character.\"));var r=t.path.child(me.fromString(n));if(!Ve.isDocumentKey(r))throw new H(W.INVALID_ARGUMENT,\"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '\".concat(r,\"' is not because it has an odd number of segments (\").concat(r.length,\").\"));return ze(e,new Ve(r))}if(n instanceof sl)return ze(e,n._key);throw new H(W.INVALID_ARGUMENT,\"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: \".concat(nl(n),\".\"))}function Bf(e,t){if(!Array.isArray(e)||0===e.length)throw new H(W.INVALID_ARGUMENT,\"Invalid Query. A non-empty array is required for '\".concat(t.toString(),\"' filters.\"));if(e.length>10)throw new H(W.INVALID_ARGUMENT,\"Invalid Query. '\".concat(t.toString(),\"' filters support a maximum of 10 elements in the value array.\"))}function Kf(e,t,n){if(!n.isEqual(t))throw new H(W.INVALID_ARGUMENT,\"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '\".concat(t.toString(),\"' and so you must also use '\").concat(t.toString(),\"' as your first argument to orderBy(), but your first orderBy() is on field '\").concat(n.toString(),\"' instead.\"))}var Gf=function(){function e(){N(this,e)}return C(e,[{key:\"convertValue\",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"none\";switch(Oe(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Te(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Se(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw G()}}},{key:\"convertObject\",value:function(e,t){var n=this,r={};return ve(e.fields,function(e,i){r[e]=n.convertValue(i,t)}),r}},{key:\"convertGeoPoint\",value:function(e){return new Ul(Te(e.latitude),Te(e.longitude))}},{key:\"convertArray\",value:function(e,t){var n=this;return(e.values||[]).map(function(e){return n.convertValue(e,t)})}},{key:\"convertServerTimestamp\",value:function(e,t){switch(t){case\"previous\":var n=Ae(e);return null==n?null:this.convertValue(n,t);case\"estimate\":return this.convertTimestamp(De(e));default:return null}}},{key:\"convertTimestamp\",value:function(e){var t=Ee(e);return new fe(t.seconds,t.nanos)}},{key:\"convertDocumentKey\",value:function(e,t){var n=me.fromString(e);j(Wr(n));var r=new Re(n.get(1),n.get(3)),i=new Ve(n.popFirst(5));return r.isEqual(t)||U(\"Document \".concat(i,\" contains a document reference within a different database (\").concat(r.projectId,\"/\").concat(r.database,\") which is not supported. It will be treated as a reference in the current database (\").concat(t.projectId,\"/\").concat(t.database,\") instead.\")),i}}]),e}();function jf(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}exports.AbstractUserDataWriter=Gf;var zf=function(e){m(n,Gf);var t=k(n);function n(e){var r;return N(this,n),(r=t.call(this)).firestore=e,r}return C(n,[{key:\"convertBytes\",value:function(e){return new Ol(e)}},{key:\"convertReference\",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new sl(this.firestore,null,t)}}]),n}(),Qf=function(){function e(t,n){N(this,e),this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Wl(t)}return C(e,[{key:\"set\",value:function(e,t,n){this._verifyNotCommitted();var r=Wf(e,this._firestore),i=jf(r.converter,t,n),a=Hl(this._dataReader,\"WriteBatch.set\",r._key,i,null!==r.converter,n);return this._mutations.push(a.toMutation(r._key,bn.none())),this}},{key:\"update\",value:function(e,t,n){this._verifyNotCommitted();for(var r,a=Wf(e,this._firestore),u=arguments.length,o=new Array(u>3?u-3:0),s=3;s<u;s++)o[s-3]=arguments[s];return r=\"string\"==typeof(t=(0,i.getModularInstance)(t))||t instanceof Fl?nf(this._dataReader,\"WriteBatch.update\",a._key,t,n,o):tf(this._dataReader,\"WriteBatch.update\",a._key,t),this._mutations.push(r.toMutation(a._key,bn.exists(!0))),this}},{key:\"delete\",value:function(e){this._verifyNotCommitted();var t=Wf(e,this._firestore);return this._mutations=this._mutations.concat(new Fn(t._key,bn.none())),this}},{key:\"commit\",value:function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}},{key:\"_verifyNotCommitted\",value:function(){if(this._committed)throw new H(W.FAILED_PRECONDITION,\"A write batch can no longer be used after commit() has been called.\")}}]),e}();function Wf(e,t){if((e=(0,i.getModularInstance)(e)).firestore!==t)throw new H(W.INVALID_ARGUMENT,\"Provided document reference is from a different Firestore instance.\");return e}function Hf(e){e=rl(e,sl);var t=rl(e.firestore,wl);return jc(Il(t),e._key).then(function(n){return sh(t,e,n)})}exports.WriteBatch=Qf;var Yf=function(e){m(n,Gf);var t=k(n);function n(e){var r;return N(this,n),(r=t.call(this)).firestore=e,r}return C(n,[{key:\"convertBytes\",value:function(e){return new Ol(e)}},{key:\"convertReference\",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new sl(this.firestore,null,t)}}]),n}();function Xf(e){e=rl(e,sl);var t=rl(e.firestore,wl),n=Il(t),r=new Yf(t);return Gc(n,e._key).then(function(n){return new gf(t,r,e._key,n,new mf(null!==n&&n.hasLocalMutations,!0),e.converter)})}function Jf(e){e=rl(e,sl);var t=rl(e.firestore,wl);return jc(Il(t),e._key,{source:\"server\"}).then(function(n){return sh(t,e,n)})}function $f(e){e=rl(e,cl);var t=rl(e.firestore,wl),n=Il(t),r=new Yf(t);return If(e._query),Qc(n,e._query).then(function(n){return new wf(t,r,e,n)})}function Zf(e){e=rl(e,cl);var t=rl(e.firestore,wl),n=Il(t),r=new Yf(t);return zc(n,e._query).then(function(n){return new wf(t,r,e,n)})}function eh(e){e=rl(e,cl);var t=rl(e.firestore,wl),n=Il(t),r=new Yf(t);return Qc(n,e._query,{source:\"server\"}).then(function(n){return new wf(t,r,e,n)})}function th(e,t,n){e=rl(e,sl);var r=rl(e.firestore,wl),i=jf(e.converter,t,n);return oh(r,[Hl(Wl(r),\"setDoc\",e._key,i,null!==e.converter,n).toMutation(e._key,bn.none())])}function nh(e,t,n){e=rl(e,sl);for(var r=rl(e.firestore,wl),a=Wl(r),u=arguments.length,o=new Array(u>3?u-3:0),s=3;s<u;s++)o[s-3]=arguments[s];return oh(r,[(\"string\"==typeof(t=(0,i.getModularInstance)(t))||t instanceof Fl?nf(a,\"updateDoc\",e._key,t,n,o):tf(a,\"updateDoc\",e._key,t)).toMutation(e._key,bn.exists(!0))])}function rh(e){return oh(rl(e.firestore,wl),[new Fn(e._key,bn.none())])}function ih(e,t){var n=rl(e.firestore,wl),r=dl(e),i=jf(e.converter,t);return oh(n,[Hl(Wl(e.firestore),\"addDoc\",r._key,i,null!==e.converter,{}).toMutation(r._key,bn.exists(!1))]).then(function(){return r})}function ah(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,u,o;e=(0,i.getModularInstance)(e);var s={includeMetadataChanges:!1},c=0;\"object\"!=d(n[c])||ml(n[c])||(s=n[c],c++);var l,f,h,v={includeMetadataChanges:s.includeMetadataChanges};if(ml(n[c])){var y=n[c];n[c]=null===(a=y.next)||void 0===a?void 0:a.bind(y),n[c+1]=null===(u=y.error)||void 0===u?void 0:u.bind(y),n[c+2]=null===(o=y.complete)||void 0===o?void 0:o.bind(y)}if(e instanceof sl)f=rl(e.firestore,wl),h=Ut(e._key.path),l={next:function(t){n[c]&&n[c](sh(f,e,t))},error:n[c+1],complete:n[c+2]};else{var m=rl(e,cl);f=rl(m.firestore,wl),h=m._query;var g=new Yf(f);l={next:function(e){n[c]&&n[c](new wf(f,g,m,e))},error:n[c+1],complete:n[c+2]},If(e._query)}return function(e,t,n,r){var i=new xc(l),a=new ls(t,i,n);return e.asyncQueue.enqueueAndForget(p(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=rs,t.next=3,qc(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt(\"return\",(0,t.t0)(t.t1,t.t2));case 6:case\"end\":return t.stop()}},t)}))),function(){i.Ia(),e.asyncQueue.enqueueAndForget(p(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=as,t.next=3,qc(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt(\"return\",(0,t.t0)(t.t1,t.t2));case 6:case\"end\":return t.stop()}},t)})))}}(Il(f),h,v)}function uh(e,t){return Wc(Il(e=rl(e,wl)),ml(t)?t:{next:t})}function oh(e,t){return function(e,t){var n=new Y;return e.asyncQueue.enqueueAndForget(p(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=_s,r.next=3,Oc(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt(\"return\",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case\"end\":return r.stop()}},r)}))),n.promise}(Il(e),t)}function sh(e,t,n){var r=n.docs.get(t._key),i=new Yf(e);return new gf(e,i,t._key,r,new mf(n.hasPendingWrites,n.fromCache),t.converter)}var ch=function(e){m(n,e);var t=k(n);function n(e,r){var i;return N(this,n),(i=t.call(this,e,r))._firestore=e,i}return C(n,[{key:\"get\",value:function(e){var t=this,r=Wf(e,this._firestore),i=new Yf(this._firestore);return o(I(n.prototype),\"get\",this).call(this,e).then(function(e){return new gf(t._firestore,i,r._key,e._document,new mf(!1,!1),r.converter)})}}]),n}(function(){function e(t,n){N(this,e),this._firestore=t,this._transaction=n,this._dataReader=Wl(t)}return C(e,[{key:\"get\",value:function(e){var t=this,n=Wf(e,this._firestore),r=new zf(this._firestore);return this._transaction.lookup([n._key]).then(function(e){if(!e||1!==e.length)return G();var i=e[0];if(i.isFoundDocument())return new vf(t._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new vf(t._firestore,r,n._key,null,n.converter);throw G()})}},{key:\"set\",value:function(e,t,n){var r=Wf(e,this._firestore),i=jf(r.converter,t,n),a=Hl(this._dataReader,\"Transaction.set\",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,a),this}},{key:\"update\",value:function(e,t,n){for(var r,a=Wf(e,this._firestore),u=arguments.length,o=new Array(u>3?u-3:0),s=3;s<u;s++)o[s-3]=arguments[s];return r=\"string\"==typeof(t=(0,i.getModularInstance)(t))||t instanceof Fl?nf(this._dataReader,\"Transaction.update\",a._key,t,n,o):tf(this._dataReader,\"Transaction.update\",a._key,t),this._transaction.update(a._key,r),this}},{key:\"delete\",value:function(e){var t=Wf(e,this._firestore);return this._transaction.delete(t._key),this}}]),e}());function lh(e,t){return Hc(Il(e=rl(e,wl)),function(n){return t(new ch(e,n))})}function fh(){return new Yl(\"deleteField\")}function hh(){return new Jl(\"serverTimestamp\")}function dh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new $l(\"arrayUnion\",t)}function vh(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Zl(\"arrayRemove\",t)}function yh(e){return new ef(\"increment\",e)}function ph(e){return Il(e=rl(e,wl)),new Qf(e,function(t){return oh(e,t)})}function mh(e,t){Il(e=rl(e,wl));var n=\"string\"==typeof t?function(e){try{return JSON.parse(e)}catch(e){throw new H(W.INVALID_ARGUMENT,\"Failed to parse JSON:\"+e.message)}}(t):t,r=[];if(Array.isArray(n.indexes)){var i,a=v(n.indexes);try{for(a.s();!(i=a.n()).done;){var u=i.value,o=gh(u,\"collectionGroup\"),s=[];if(Array.isArray(u.fields)){var c,l=v(u.fields);try{for(l.s();!(c=l.n()).done;){var f=c.value,h=ff(\"setIndexConfiguration\",gh(f,\"fieldPath\"));\"CONTAINS\"===f.arrayConfig?s.push(new ct(h,2)):\"ASCENDING\"===f.order?s.push(new ct(h,0)):\"DESCENDING\"===f.order&&s.push(new ct(h,1))}}catch(d){l.e(d)}finally{l.f()}}r.push(new ut(ut.UNKNOWN_ID,o,s,lt.empty()))}}catch(d){a.e(d)}finally{a.f()}}return Promise.resolve()}function gh(e,t){if(\"string\"!=typeof e[t])throw new H(W.INVALID_ARGUMENT,\"Missing string value for: \"+t);return e[t]}exports.Transaction=ch,function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){V=e}(t.SDK_VERSION),(0,t._registerComponent)(new n.Component(\"firestore\",function(e,t){var n=t.options,i=e.getProvider(\"app\").getImmediate(),a=new wl(i,new Z(e.getProvider(\"auth-internal\")),new re(e.getProvider(\"app-check-internal\")));return n=Object.assign({useFetchStreams:r},n),a._setSettings(n),a},\"PUBLIC\")),(0,t.registerVersion)(M,\"3.4.8\",e),(0,t.registerVersion)(M,\"3.4.8\",\"esm2017\")}();"},"sourceMaps":null,"error":null,"hash":"6ca30344b9ebeb14eb71dc2f73f042f7","cacheData":{"env":{}}}